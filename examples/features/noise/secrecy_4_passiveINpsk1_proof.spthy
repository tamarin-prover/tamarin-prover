theory secrecy_4_passive_INpsk1 begin

// Function signature and definition of the equational theory E

builtins: diffie-hellman
functions: aead/4, decrypt/3, fst/1[destructor], h/1, kdf1/1, kdf2/1,
           kdf3/1, pair/2, snd/1[destructor], true/0, verify/4
equations:
    decrypt(k, n, aead(k, n, a, p)) = p,
    fst(<x.1, x.2>) = x.1,
    snd(<x.1, x.2>) = x.2,
    verify(k, n, a, aead(k, n, a, p)) = true

tactic: unless
presort: s
prio: {id}
  regex"^My"
  regex"^I_"
  regex"^R_"
  regex"^St_"
  regex"^!Transport_"
  regex"^!SessionId\("
  regex"^Ek"
  regex"^Handshake"
  regex"^Peer"
prio: {id}
  regex"!KU\(*~.*\)" & reasonableNoncesNoise"resN"
prio: {smallest}
  dhreNoise"dh"
prio: {smallest}
  regex"Receivable\(.*'"""""
  regex"Receivable\(.*\("""""
  regex"Recv\(.*\("""""
  regex"Recv\(.*'"""""
prio: {id}
  not regex"^!KU\("
  regex"^(?<!'g'\^)\~[a-zA-Z.0-9]*$" & defaultNoise"(?<!'g'\^)\~[a-zA-Z.0-9]*""def"


tactic: unless_reveal_psk
presort: s
prio: {id}
  regex"^My"
  regex"^I_"
  regex"^R_"
  regex"^St_"
  regex"^!Transport_"
  regex"^!SessionId\("
  regex"^Ek"
  regex"^Handshake"
  regex"^Peer"
prio: {id}
  regex"!KU\(*~.*\)" & reasonableNoncesNoise""
prio: {smallest}
  regex"!KU\(.*~psk.*\)"
prio: {smallest}
  dhreNoise"~n""\(Reveal[a-zA-Z]+\(*'g'^(~[a-zA-Z0-9.]+)*\)*@*#reveal""^(~[a-zA-Z0-9.]+)"
prio: {smallest}
  regex"Receivable\(.*'"""""
  regex"Receivable\(.*\("""""
  regex"Recv\(.*\("""""
  regex"Recv\(.*'"
prio: {smallest}
  not regex"^!KU\("
  regex"^(?<!'g'\^)\~[a-zA-Z.0-9]*$" & defaultNoise"(?<!'g'\^)\~[a-zA-Z.0-9]*""def"









rule (modulo E) Init_Handshake_Initiator:
   [ Init_Handshake_Initiator( id, prologue, ~s, psk ) ]
  -->
   [
   HandshakeState_Initiator_0( id, h(<'INpsk1', prologue>), 'INpsk1', ~s,
                               psk
   )
   ]

  /* has exactly the trivial AC variant */

rule (modulo E) Handshake_Initiator_Snd_1:
   [
   HandshakeState_Initiator_0( id, hash, ck, ~s, psk ),
   Handshake_Snd_1( id, payload ), Ek( ~e0 )
   ]
  --[
  RawSnd( 'Initiator1',
          <'g'^~e0, aead(kdf2(<ck, 'g'^~e0>), '0', h(<hash, 'g'^~e0>), 'g'^~s), 
           aead(kdf3(<kdf1(<ck, 'g'^~e0>), psk>), '0',
                h(<
                   h(<h(<hash, 'g'^~e0>), 
                      aead(kdf2(<ck, 'g'^~e0>), '0', h(<hash, 'g'^~e0>), 'g'^~s)>), 
                   kdf1(<kdf1(<ck, 'g'^~e0>), psk>)>),
                payload)
          >
  )
  ]->
   [
   MyEk_Initiator( id, 'g'^~e0 ),
   HandshakeState_Initiator_1( id,
                               h(<
                                  h(<
                                     h(<h(<hash, 'g'^~e0>), 
                                        aead(kdf2(<ck, 'g'^~e0>), '0', h(<hash, 'g'^~e0>), 'g'^~s)>), 
                                     kdf1(<kdf1(<ck, 'g'^~e0>), psk>)>), 
                                  aead(kdf3(<kdf1(<ck, 'g'^~e0>), psk>), '0',
                                       h(<
                                          h(<h(<hash, 'g'^~e0>), 
                                             aead(kdf2(<ck, 'g'^~e0>), '0', h(<hash, 'g'^~e0>), 'g'^~s)>), 
                                          kdf1(<kdf1(<ck, 'g'^~e0>), psk>)>),
                                       payload)
                                 >),
                               kdf2(<kdf1(<ck, 'g'^~e0>), psk>), kdf3(<kdf1(<ck, 'g'^~e0>), psk>), ~e0,
                               ~s, psk
   ),
   Send( <'g'^~e0, 
          aead(kdf2(<ck, 'g'^~e0>), '0', h(<hash, 'g'^~e0>), 'g'^~s), 
          aead(kdf3(<kdf1(<ck, 'g'^~e0>), psk>), '0',
               h(<
                  h(<h(<hash, 'g'^~e0>), 
                     aead(kdf2(<ck, 'g'^~e0>), '0', h(<hash, 'g'^~e0>), 'g'^~s)>), 
                  kdf1(<kdf1(<ck, 'g'^~e0>), psk>)>),
               payload)
         >
   )
   ]

  /* has exactly the trivial AC variant */

rule (modulo E) Handshake_Initiator_Recv_2:
   [
   HandshakeState_Initiator_1( id, hash, ck, k, ~e, ~s, psk ),
   Recv( <'g'^re0, 
          aead(kdf2(<kdf1(<kdf1(<ck, 'g'^re0>), 'g'^re0^~e>), 'g'^re0^~s>), '0',
               h(<hash, 'g'^re0>), payload)
         >
   )
   ]
  --[
  RawRecv( 'Responder2',
           <'g'^re0, 
            aead(kdf2(<kdf1(<kdf1(<ck, 'g'^re0>), 'g'^re0^~e>), 'g'^re0^~s>), '0',
                 h(<hash, 'g'^re0>), payload)
           >
  )
  ]->
   [
   PeerEk_Initiator( id, 'g'^re0 ),
   HandshakeState_Initiator_2( id,
                               h(<h(<hash, 'g'^re0>), 
                                  aead(kdf2(<kdf1(<kdf1(<ck, 'g'^re0>), 'g'^re0^~e>), 'g'^re0^~s>), '0',
                                       h(<hash, 'g'^re0>), payload)
                                 >),
                               kdf1(<kdf1(<kdf1(<ck, 'g'^re0>), 'g'^re0^~e>), 'g'^re0^~s>),
                               kdf2(<kdf1(<kdf1(<ck, 'g'^re0>), 'g'^re0^~e>), 'g'^re0^~s>), ~e, 'g'^re0,
                               ~s, psk
   ),
   Handshake_Recv_2( id, payload )
   ]

  /*
  rule (modulo AC) Handshake_Initiator_Recv_2:
     [
     HandshakeState_Initiator_1( id, hash, ck, k, ~e, ~s, psk ),
     Recv( <z, 
            aead(kdf2(<kdf1(<kdf1(<ck, z>), z.1>), z.2>), '0', h(<hash, z>), payload)
           >
     )
     ]
    --[
    RawRecv( 'Responder2',
             <z, 
              aead(kdf2(<kdf1(<kdf1(<ck, z>), z.1>), z.2>), '0', h(<hash, z>), payload)
             >
    )
    ]->
     [
     PeerEk_Initiator( id, z ),
     HandshakeState_Initiator_2( id,
                                 h(<h(<hash, z>), 
                                    aead(kdf2(<kdf1(<kdf1(<ck, z>), z.1>), z.2>), '0', h(<hash, z>), payload)
                                   >),
                                 kdf1(<kdf1(<kdf1(<ck, z>), z.1>), z.2>),
                                 kdf2(<kdf1(<kdf1(<ck, z>), z.1>), z.2>), ~e, z, ~s, psk
     ),
     Handshake_Recv_2( id, payload )
     ]
    variants (modulo AC)
     1. ~e    = ~e.14
        ~s    = ~e.14
        z     = 'g'^inv(~e.14)
        z.1   = 'g'
        z.2   = 'g'
    
     2. ~e    = ~e.15
        ~s    = ~s.16
        z     = 'g'
        z.1   = 'g'^~e.15
        z.2   = 'g'^~s.16
    
     3. ~e    = ~e.15
        ~s    = ~s.16
        z     = 'g'^inv(~e.15)
        z.1   = 'g'
        z.2   = 'g'^(~s.16*inv(~e.15))
    
     4. ~e    = ~e.15
        ~s    = ~s.16
        z     = 'g'^inv(~s.16)
        z.1   = 'g'^(~e.15*inv(~s.16))
        z.2   = 'g'
    
     5. ~e    = ~e.15
        ~s    = ~s.16
        z     = 'g'^inv((~e.15*~s.16))
        z.1   = 'g'^inv(~s.16)
        z.2   = 'g'^inv(~e.15)
    
     6. ~e    = ~e.28
        ~s    = ~s.29
        z     = 'g'^re0.54
        z.1   = 'g'^(~e.28*re0.54)
        z.2   = 'g'^(~s.29*re0.54)
    
     7. ~e    = ~e.35
        ~s    = ~e.35
        z     = 'g'^inv((~e.35*x.68))
        z.1   = 'g'^inv(x.68)
        z.2   = 'g'^inv(x.68)
    
     8. ~e    = ~e.35
        ~s    = ~e.35
        z     = 'g'^(x.68*inv(~e.35))
        z.1   = 'g'^x.68
        z.2   = 'g'^x.68
    
     9. ~e    = ~e.35
        ~s    = ~s.36
        z     = 'g'^inv((~s.36*x.68))
        z.1   = 'g'^(~e.35*inv((~s.36*x.68)))
        z.2   = 'g'^inv(x.68)
    
    10. ~e    = ~e.35
        ~s    = ~s.36
        z     = 'g'^(x.68*inv(~s.36))
        z.1   = 'g'^(~e.35*x.68*inv(~s.36))
        z.2   = 'g'^x.68
    
    11. ~e    = ~e.36
        ~s    = ~e.36
        z     = 'g'^(x.69*inv((~e.36*x.70)))
        z.1   = 'g'^(x.69*inv(x.70))
        z.2   = 'g'^(x.69*inv(x.70))
    
    12. ~e    = ~e.36
        ~s    = ~s.37
        z     = 'g'^inv((~e.36*~s.37*x.70))
        z.1   = 'g'^inv((~s.37*x.70))
        z.2   = 'g'^inv((~e.36*x.70))
    
    13. ~e    = ~e.36
        ~s    = ~s.37
        z     = 'g'^inv((~e.36*x.70))
        z.1   = 'g'^inv(x.70)
        z.2   = 'g'^(~s.37*inv((~e.36*x.70)))
    
    14. ~e    = ~e.36
        ~s    = ~s.37
        z     = 'g'^(x.69*inv((~s.37*x.70)))
        z.1   = 'g'^(~e.36*x.69*inv((~s.37*x.70)))
        z.2   = 'g'^(x.69*inv(x.70))
    
    15. ~e    = ~e.36
        ~s    = ~s.37
        z     = 'g'^(x.70*inv(~e.36))
        z.1   = 'g'^x.70
        z.2   = 'g'^(~s.37*x.70*inv(~e.36))
    
    16. ~e    = ~e.36
        ~s    = ~s.37
        z     = 'g'^(x.70*inv((~e.36*~s.37)))
        z.1   = 'g'^(x.70*inv(~s.37))
        z.2   = 'g'^(x.70*inv(~e.36))
    
    17. ~e    = ~e.37
        ~s    = ~s.38
        z     = 'g'^(x.71*inv((~e.37*~s.38*x.72)))
        z.1   = 'g'^(x.71*inv((~s.38*x.72)))
        z.2   = 'g'^(x.71*inv((~e.37*x.72)))
    
    18. ~e    = ~e.37
        ~s    = ~s.38
        z     = 'g'^(x.71*inv((~e.37*x.72)))
        z.1   = 'g'^(x.71*inv(x.72))
        z.2   = 'g'^(~s.38*x.71*inv((~e.37*x.72)))
  */

rule (modulo E) Initiator_to_transport_mode:
   [ HandshakeState_Initiator_2( id, hash, ck, k, ~e, 'g'^re, ~s, psk ) ]
  -->
   [ !Transport_Initiator( id, kdf1(ck), kdf2(ck) ), !SessionId( id, hash )
   ]

  /*
  rule (modulo AC) Initiator_to_transport_mode:
     [ HandshakeState_Initiator_2( id, hash, ck, k, ~e, z, ~s, psk ) ]
    -->
     [ !Transport_Initiator( id, kdf1(ck), kdf2(ck) ), !SessionId( id, hash )
     ]
    variants (modulo AC)
    1. z     = 'g'
    
    2. z     = 'g'^re.10
  */

rule (modulo E) Init_Handshake_Responder:
   [ Init_Handshake_Responder( id, prologue, psk ) ]
  -->
   [
   HandshakeState_Responder_0( id, h(<'INpsk1', prologue>), 'INpsk1', psk )
   ]

  /* has exactly the trivial AC variant */

rule (modulo E) Handshake_Responder_Recv_1:
   [
   HandshakeState_Responder_0( id, hash, ck, psk ),
   Recv( <'g'^re0, 
          aead(kdf2(<ck, 'g'^re0>), '0', h(<hash, 'g'^re0>), 'g'^rs4), 
          aead(kdf3(<kdf1(<ck, 'g'^re0>), psk>), '0',
               h(<
                  h(<h(<hash, 'g'^re0>), 
                     aead(kdf2(<ck, 'g'^re0>), '0', h(<hash, 'g'^re0>), 'g'^rs4)>), 
                  kdf1(<kdf1(<ck, 'g'^re0>), psk>)>),
               payload)
         >
   )
   ]
  --[
  RawRecv( 'Initiator1',
           <'g'^re0, aead(kdf2(<ck, 'g'^re0>), '0', h(<hash, 'g'^re0>), 'g'^rs4), 
            aead(kdf3(<kdf1(<ck, 'g'^re0>), psk>), '0',
                 h(<
                    h(<h(<hash, 'g'^re0>), 
                       aead(kdf2(<ck, 'g'^re0>), '0', h(<hash, 'g'^re0>), 'g'^rs4)>), 
                    kdf1(<kdf1(<ck, 'g'^re0>), psk>)>),
                 payload)
           >
  )
  ]->
   [
   PeerEk_Responder( id, 'g'^re0 ), PeerLtk_Responder( id, 'g'^rs4 ),
   HandshakeState_Responder_1( id,
                               h(<
                                  h(<
                                     h(<h(<hash, 'g'^re0>), 
                                        aead(kdf2(<ck, 'g'^re0>), '0', h(<hash, 'g'^re0>), 'g'^rs4)>), 
                                     kdf1(<kdf1(<ck, 'g'^re0>), psk>)>), 
                                  aead(kdf3(<kdf1(<ck, 'g'^re0>), psk>), '0',
                                       h(<
                                          h(<h(<hash, 'g'^re0>), 
                                             aead(kdf2(<ck, 'g'^re0>), '0', h(<hash, 'g'^re0>), 'g'^rs4)>), 
                                          kdf1(<kdf1(<ck, 'g'^re0>), psk>)>),
                                       payload)
                                 >),
                               kdf2(<kdf1(<ck, 'g'^re0>), psk>), kdf3(<kdf1(<ck, 'g'^re0>), psk>),
                               'g'^re0, 'g'^rs4, psk
   ),
   Handshake_Recv_1( id, payload )
   ]

  /*
  rule (modulo AC) Handshake_Responder_Recv_1:
     [
     HandshakeState_Responder_0( id, hash, ck, psk ),
     Recv( <z, aead(kdf2(<ck, z>), '0', h(<hash, z>), z.1), 
            aead(kdf3(<kdf1(<ck, z>), psk>), '0',
                 h(<h(<h(<hash, z>), aead(kdf2(<ck, z>), '0', h(<hash, z>), z.1)>), 
                    kdf1(<kdf1(<ck, z>), psk>)>),
                 payload)
           >
     )
     ]
    --[
    RawRecv( 'Initiator1',
             <z, aead(kdf2(<ck, z>), '0', h(<hash, z>), z.1), 
              aead(kdf3(<kdf1(<ck, z>), psk>), '0',
                   h(<h(<h(<hash, z>), aead(kdf2(<ck, z>), '0', h(<hash, z>), z.1)>), 
                      kdf1(<kdf1(<ck, z>), psk>)>),
                   payload)
             >
    )
    ]->
     [
     PeerEk_Responder( id, z ), PeerLtk_Responder( id, z.1 ),
     HandshakeState_Responder_1( id,
                                 h(<
                                    h(<h(<h(<hash, z>), aead(kdf2(<ck, z>), '0', h(<hash, z>), z.1)>), 
                                       kdf1(<kdf1(<ck, z>), psk>)>), 
                                    aead(kdf3(<kdf1(<ck, z>), psk>), '0',
                                         h(<h(<h(<hash, z>), aead(kdf2(<ck, z>), '0', h(<hash, z>), z.1)>), 
                                            kdf1(<kdf1(<ck, z>), psk>)>),
                                         payload)
                                   >),
                                 kdf2(<kdf1(<ck, z>), psk>), kdf3(<kdf1(<ck, z>), psk>), z, z.1, psk
     ),
     Handshake_Recv_1( id, payload )
     ]
    variants (modulo AC)
    1. z     = 'g'
       z.1   = 'g'
    
    2. z     = 'g'
       z.1   = 'g'^rs4.12
    
    3. z     = 'g'^re0.12
       z.1   = 'g'
    
    4. z     = 'g'^re0.12
       z.1   = 'g'^rs4.12
  */

rule (modulo E) Handshake_Responder_Snd_2:
   [
   HandshakeState_Responder_1( id, hash, ck, k, 'g'^re, 'g'^rs, psk ),
   Handshake_Snd_2( id, payload ), Ek( ~e0 )
   ]
  --[
  RawSnd( 'Responder2',
          <'g'^~e0, 
           aead(kdf2(<kdf1(<kdf1(<ck, 'g'^~e0>), 'g'^re^~e0>), 'g'^rs^~e0>), '0',
                h(<hash, 'g'^~e0>), payload)
          >
  )
  ]->
   [
   MyEk_Responder( id, 'g'^~e0 ),
   HandshakeState_Responder_2( id,
                               h(<h(<hash, 'g'^~e0>), 
                                  aead(kdf2(<kdf1(<kdf1(<ck, 'g'^~e0>), 'g'^re^~e0>), 'g'^rs^~e0>), '0',
                                       h(<hash, 'g'^~e0>), payload)
                                 >),
                               kdf1(<kdf1(<kdf1(<ck, 'g'^~e0>), 'g'^re^~e0>), 'g'^rs^~e0>),
                               kdf2(<kdf1(<kdf1(<ck, 'g'^~e0>), 'g'^re^~e0>), 'g'^rs^~e0>), ~e0, 'g'^re,
                               'g'^rs, psk
   ),
   Send( <'g'^~e0, 
          aead(kdf2(<kdf1(<kdf1(<ck, 'g'^~e0>), 'g'^re^~e0>), 'g'^rs^~e0>), '0',
               h(<hash, 'g'^~e0>), payload)
         >
   )
   ]

  /*
  rule (modulo AC) Handshake_Responder_Snd_2:
     [
     HandshakeState_Responder_1( id, hash, ck, k, z, z.1, psk ),
     Handshake_Snd_2( id, payload ), Ek( ~e0 )
     ]
    --[
    RawSnd( 'Responder2',
            <'g'^~e0, 
             aead(kdf2(<kdf1(<kdf1(<ck, 'g'^~e0>), z.2>), z.3>), '0',
                  h(<hash, 'g'^~e0>), payload)
            >
    )
    ]->
     [
     MyEk_Responder( id, 'g'^~e0 ),
     HandshakeState_Responder_2( id,
                                 h(<h(<hash, 'g'^~e0>), 
                                    aead(kdf2(<kdf1(<kdf1(<ck, 'g'^~e0>), z.2>), z.3>), '0',
                                         h(<hash, 'g'^~e0>), payload)
                                   >),
                                 kdf1(<kdf1(<kdf1(<ck, 'g'^~e0>), z.2>), z.3>),
                                 kdf2(<kdf1(<kdf1(<ck, 'g'^~e0>), z.2>), z.3>), ~e0, z, z.1, psk
     ),
     Send( <'g'^~e0, 
            aead(kdf2(<kdf1(<kdf1(<ck, 'g'^~e0>), z.2>), z.3>), '0',
                 h(<hash, 'g'^~e0>), payload)
           >
     )
     ]
    variants (modulo AC)
     1. ~e0   = ~e0.16
        z     = 'g'
        z.1   = 'g'
        z.2   = 'g'^~e0.16
        z.3   = 'g'^~e0.16
    
     2. ~e0   = ~e0.16
        z     = 'g'
        z.1   = 'g'^inv(~e0.16)
        z.2   = 'g'^~e0.16
        z.3   = 'g'
    
     3. ~e0   = ~e0.16
        z     = 'g'^inv(~e0.16)
        z.1   = 'g'
        z.2   = 'g'
        z.3   = 'g'^~e0.16
    
     4. ~e0   = ~e0.16
        z     = 'g'^inv(~e0.16)
        z.1   = 'g'^inv(~e0.16)
        z.2   = 'g'
        z.3   = 'g'
    
     5. ~e0   = ~e0.107
        z     = 'g'
        z.1   = 'g'^rs.212
        z.2   = 'g'^~e0.107
        z.3   = 'g'^(~e0.107*rs.212)
    
     6. ~e0   = ~e0.107
        z     = 'g'^re.212
        z.1   = 'g'
        z.2   = 'g'^(~e0.107*re.212)
        z.3   = 'g'^~e0.107
    
     7. ~e0   = ~e0.107
        z     = 'g'^re.212
        z.1   = 'g'^rs.212
        z.2   = 'g'^(~e0.107*re.212)
        z.3   = 'g'^(~e0.107*rs.212)
    
     8. ~e0   = ~e0.108
        z     = 'g'^re.214
        z.1   = 'g'^inv(~e0.108)
        z.2   = 'g'^(~e0.108*re.214)
        z.3   = 'g'
    
     9. ~e0   = ~e0.108
        z     = 'g'^inv(~e0.108)
        z.1   = 'g'^rs.214
        z.2   = 'g'
        z.3   = 'g'^(~e0.108*rs.214)
    
    10. ~e0   = ~e0.114
        z     = 'g'
        z.1   = 'g'^inv((~e0.114*x.226))
        z.2   = 'g'^~e0.114
        z.3   = 'g'^inv(x.226)
    
    11. ~e0   = ~e0.114
        z     = 'g'
        z.1   = 'g'^(x.226*inv(~e0.114))
        z.2   = 'g'^~e0.114
        z.3   = 'g'^x.226
    
    12. ~e0   = ~e0.114
        z     = 'g'^inv(~e0.114)
        z.1   = 'g'^inv((~e0.114*x.226))
        z.2   = 'g'
        z.3   = 'g'^inv(x.226)
    
    13. ~e0   = ~e0.114
        z     = 'g'^inv(~e0.114)
        z.1   = 'g'^(x.226*inv(~e0.114))
        z.2   = 'g'
        z.3   = 'g'^x.226
    
    14. ~e0   = ~e0.114
        z     = 'g'^inv((~e0.114*x.226))
        z.1   = 'g'
        z.2   = 'g'^inv(x.226)
        z.3   = 'g'^~e0.114
    
    15. ~e0   = ~e0.114
        z     = 'g'^inv((~e0.114*x.226))
        z.1   = 'g'^inv(~e0.114)
        z.2   = 'g'^inv(x.226)
        z.3   = 'g'
    
    16. ~e0   = ~e0.114
        z     = 'g'^(x.226*inv(~e0.114))
        z.1   = 'g'
        z.2   = 'g'^x.226
        z.3   = 'g'^~e0.114
    
    17. ~e0   = ~e0.114
        z     = 'g'^(x.226*inv(~e0.114))
        z.1   = 'g'^inv(~e0.114)
        z.2   = 'g'^x.226
        z.3   = 'g'
    
    18. ~e0   = ~e0.115
        z     = 'g'
        z.1   = 'g'^(x.227*inv((~e0.115*x.228)))
        z.2   = 'g'^~e0.115
        z.3   = 'g'^(x.227*inv(x.228))
    
    19. ~e0   = ~e0.115
        z     = 'g'^inv(~e0.115)
        z.1   = 'g'^(x.227*inv((~e0.115*x.228)))
        z.2   = 'g'
        z.3   = 'g'^(x.227*inv(x.228))
    
    20. ~e0   = ~e0.115
        z     = 'g'^inv((~e0.115*x.227))
        z.1   = 'g'^rs.228
        z.2   = 'g'^inv(x.227)
        z.3   = 'g'^(~e0.115*rs.228)
    
    21. ~e0   = ~e0.115
        z     = 'g'^inv((~e0.115*x.227))
        z.1   = 'g'^inv((~e0.115*x.228))
        z.2   = 'g'^inv(x.227)
        z.3   = 'g'^inv(x.228)
    
    22. ~e0   = ~e0.115
        z     = 'g'^inv((~e0.115*x.227))
        z.1   = 'g'^(x.228*inv(~e0.115))
        z.2   = 'g'^inv(x.227)
        z.3   = 'g'^x.228
    
    23. ~e0   = ~e0.115
        z     = 'g'^(x.227*inv(~e0.115))
        z.1   = 'g'^rs.228
        z.2   = 'g'^x.227
        z.3   = 'g'^(~e0.115*rs.228)
    
    24. ~e0   = ~e0.115
        z     = 'g'^(x.227*inv(~e0.115))
        z.1   = 'g'^inv((~e0.115*x.228))
        z.2   = 'g'^x.227
        z.3   = 'g'^inv(x.228)
    
    25. ~e0   = ~e0.115
        z     = 'g'^(x.227*inv(~e0.115))
        z.1   = 'g'^(x.228*inv(~e0.115))
        z.2   = 'g'^x.227
        z.3   = 'g'^x.228
    
    26. ~e0   = ~e0.115
        z     = 'g'^(x.227*inv((~e0.115*x.228)))
        z.1   = 'g'
        z.2   = 'g'^(x.227*inv(x.228))
        z.3   = 'g'^~e0.115
    
    27. ~e0   = ~e0.115
        z     = 'g'^(x.227*inv((~e0.115*x.228)))
        z.1   = 'g'^inv(~e0.115)
        z.2   = 'g'^(x.227*inv(x.228))
        z.3   = 'g'
    
    28. ~e0   = ~e0.116
        z     = 'g'^re.230
        z.1   = 'g'^inv((~e0.116*x.229))
        z.2   = 'g'^(~e0.116*re.230)
        z.3   = 'g'^inv(x.229)
    
    29. ~e0   = ~e0.116
        z     = 'g'^re.230
        z.1   = 'g'^(x.229*inv(~e0.116))
        z.2   = 'g'^(~e0.116*re.230)
        z.3   = 'g'^x.229
    
    30. ~e0   = ~e0.116
        z     = 'g'^inv((~e0.116*x.228))
        z.1   = 'g'^(x.229*inv((~e0.116*x.230)))
        z.2   = 'g'^inv(x.228)
        z.3   = 'g'^(x.229*inv(x.230))
    
    31. ~e0   = ~e0.116
        z     = 'g'^(x.228*inv(~e0.116))
        z.1   = 'g'^(x.229*inv((~e0.116*x.230)))
        z.2   = 'g'^x.228
        z.3   = 'g'^(x.229*inv(x.230))
    
    32. ~e0   = ~e0.116
        z     = 'g'^(x.228*inv((~e0.116*x.229)))
        z.1   = 'g'^rs.230
        z.2   = 'g'^(x.228*inv(x.229))
        z.3   = 'g'^(~e0.116*rs.230)
    
    33. ~e0   = ~e0.116
        z     = 'g'^(x.228*inv((~e0.116*x.229)))
        z.1   = 'g'^inv((~e0.116*x.230))
        z.2   = 'g'^(x.228*inv(x.229))
        z.3   = 'g'^inv(x.230)
    
    34. ~e0   = ~e0.116
        z     = 'g'^(x.228*inv((~e0.116*x.229)))
        z.1   = 'g'^(x.230*inv(~e0.116))
        z.2   = 'g'^(x.228*inv(x.229))
        z.3   = 'g'^x.230
    
    35. ~e0   = ~e0.117
        z     = 'g'^re.232
        z.1   = 'g'^(x.230*inv((~e0.117*x.231)))
        z.2   = 'g'^(~e0.117*re.232)
        z.3   = 'g'^(x.230*inv(x.231))
    
    36. ~e0   = ~e0.117
        z     = 'g'^(x.229*inv((~e0.117*x.230)))
        z.1   = 'g'^(x.231*inv((~e0.117*x.232)))
        z.2   = 'g'^(x.229*inv(x.230))
        z.3   = 'g'^(x.231*inv(x.232))
  */

rule (modulo E) Responder_to_transport_mode:
   [ HandshakeState_Responder_2( id, hash, ck, k, ~e, 'g'^re, 'g'^rs, psk )
   ]
  -->
   [ !Transport_Responder( id, kdf1(ck), kdf2(ck) ), !SessionId( id, hash )
   ]

  /*
  rule (modulo AC) Responder_to_transport_mode:
     [ HandshakeState_Responder_2( id, hash, ck, k, ~e, z, z.1, psk ) ]
    -->
     [ !Transport_Responder( id, kdf1(ck), kdf2(ck) ), !SessionId( id, hash )
     ]
    variants (modulo AC)
    1. z     = 'g'
       z.1   = 'g'
    
    2. z     = 'g'
       z.1   = 'g'^rs.11
    
    3. z     = 'g'^re.11
       z.1   = 'g'
    
    4. z     = 'g'^re.11
       z.1   = 'g'^rs.11
  */

rule (modulo E) I_Recv_from_R:
   [
   Recv( <n, aead(kr2i, n, '0', msg)> ),
   !Transport_Initiator( id, ki2r, kr2i )
   ]
  --[ RawRecv( <'R', n>, <n, aead(kr2i, n, '0', msg)> ) ]->
   [ I_Recv( id, n, msg ) ]

  /* has exactly the trivial AC variant */

rule (modulo E) R_Recv_from_I:
   [
   Recv( <n, aead(ki2r, n, '0', msg)> ),
   !Transport_Responder( id, ki2r, kr2i )
   ]
  --[ RawRecv( <'I', n>, <n, aead(ki2r, n, '0', msg)> ) ]->
   [ R_Recv( id, n, msg ) ]

  /* has exactly the trivial AC variant */

rule (modulo E) I_Snd_to_R:
   [ I_Snd( id, n, msg ), !Transport_Initiator( id, ki2r, kr2i ) ]
  --[ RawSnd( <'I', n>, <n, aead(ki2r, n, '0', msg)> ) ]->
   [ Send( <n, aead(ki2r, n, '0', msg)> ) ]

  /* has exactly the trivial AC variant */

rule (modulo E) R_Snd_to_I:
   [ R_Snd( id, n, msg ), !Transport_Responder( id, ki2r, kr2i ) ]
  --[ RawSnd( <'R', n>, <n, aead(kr2i, n, '0', msg)> ) ]->
   [ Send( <n, aead(kr2i, n, '0', msg)> ) ]

  /* has exactly the trivial AC variant */

rule (modulo E) channel_send:
   [ Send( m ) ] --> [ Receivable( m ), Out( m ) ]

  /* has exactly the trivial AC variant */

rule (modulo E) channel_receive:
   [ Receivable( m ) ] --> [ Recv( m ) ]

  // loop breaker: [0]
  /* has exactly the trivial AC variant */

rule (modulo E) disclose_sid:
   [ !SessionId( ~id, h ) ] --> [ Out( h ) ]

  /* has exactly the trivial AC variant */

rule (modulo E) static_keygen:
   [ Fr( ~key ) ]
  --[ HonestPk( 'g'^~key ) ]->
   [ !Pk( ~key, 'g'^~key ), Out( 'g'^~key ) ]

  /* has exactly the trivial AC variant */

rule (modulo E) static_reveal:
   [ !Pk( ~s, 'g'^~s ) ] --[ RevealLtk( 'g'^~s ) ]-> [ Out( ~s ) ]

  /* has exactly the trivial AC variant */

rule (modulo E) ephemeral_keygen:
   [ Fr( ~e ) ]
  --[ HonestEk( 'g'^~e ) ]->
   [ Ek( ~e ), Out( 'g'^~e ), RevealableEk( ~e ) ]

  /* has exactly the trivial AC variant */

rule (modulo E) ephemeral_reveal:
   [ RevealableEk( ~e ) ] --[ RevealEk( 'g'^~e ) ]-> [ Out( ~e ) ]

  /* has exactly the trivial AC variant */

rule (modulo E) psk_keygen:
   [ Fr( ~psk ) ] --> [ !Psk( ~psk ) ]

  /* has exactly the trivial AC variant */

rule (modulo E) psk_reveal:
   [ !Psk( ~psk ) ] --[ RevealPsk( ~psk ) ]-> [ Out( ~psk ) ]

  /* has exactly the trivial AC variant */

rule (modulo E) Create_Initiator:
   [ Fr( ~id ), !Pk( ~ltk, me ), !Psk( psk ) ]
  --[ Create_Initiator( ) ]->
   [
   St_Initiator_0( ~id, me, psk ),
   Init_Handshake_Initiator( ~id, 'prologue', ~ltk, psk )
   ]

  /* has exactly the trivial AC variant */

rule (modulo E) Instrumentation_Initiator_1:
   [ St_Initiator_0( ~id, me, psk ) ]
  -->
   [ St_Initiator_1( ~id, me, psk ), Handshake_Snd_1( ~id, $msg ) ]

  /* has exactly the trivial AC variant */

rule (modulo E) Instrumentation_Initiator_2:
   [
   St_Initiator_1( ~id, me, psk ), MyEk_Initiator( ~id, e ),
   Handshake_Recv_2( ~id, msg )
   ]
  -->
   [ St_Initiator_2( ~id, e, me, psk ) ]

  /* has exactly the trivial AC variant */

rule (modulo E) Instrumentation_Initiator_3:
   [ St_Initiator_2( ~id, e, me, psk ), PeerEk_Initiator( ~id, re ) ]
  -->
   [ St_Initiator_3( ~id, e, me, re, psk ), I_Snd( ~id, '0', $msg ) ]

  /* has exactly the trivial AC variant */

lemma Secrecy_INpsk1_4_for_Initiator_unless_active_or_reveal_psk_AnyTime_end:
  all-traces
  "∀ msg e me re psk #claim.
    (Secret_INpsk1_4_Initiator( e, me, re, psk, msg ) @ #claim) ⇒
    ((¬(∃ #attack. K( msg ) @ #attack)) ∨
     (∃ #reveal. RevealPsk( psk ) @ #reveal))"
/*
guarded formula characterizing all counter-examples:
"∃ msg e me re psk #claim.
  (Secret_INpsk1_4_Initiator( e, me, re, psk, msg ) @ #claim)
 ∧
  (∃ #attack. (K( msg ) @ #attack)) ∧
  (∀ #reveal. (RevealPsk( psk ) @ #reveal) ⇒ ⊥)"
*/
simplify
solve( St_Initiator_3( ~id, e, me, re, psk ) ▶₀ #claim )
  case Instrumentation_Initiator_3
  solve( I_Recv( ~id, '1', msg ) ▶₁ #claim )
    case I_Recv_from_R
    solve( splitEqs(4) )
      case split_case_1
      by solve( Receivable( <'g', 
                             aead(kdf2(<
                                        kdf1(<kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 'g'>), 'g'^~e>), 
                                        'g'^~s>),
                                  '0',
                                  h(<
                                     h(<
                                        h(<
                                           h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                              aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                   h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                             >), 
                                           kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                        aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                             h(<
                                                h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                   aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                        h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                  >), 
                                                kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                             $msg.3)
                                       >), 
                                     'g'>),
                                  msg.2)
                            >
                ) ▶₀ #vr.5 )
    next
      case split_case_2
      solve( splitEqs(1) )
        case split_case_01
        by solve( Receivable( <'g'^inv(~e), 
                               aead(kdf2(<
                                          kdf1(<kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 'g'^inv(~e)>), 
                                                'g'>), 
                                          'g'^(~s*inv(~e))>),
                                    '0',
                                    h(<
                                       h(<
                                          h(<
                                             h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                     h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                               >), 
                                             kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                          aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                               h(<
                                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                    >), 
                                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                               $msg.3)
                                         >), 
                                       'g'^inv(~e)>),
                                    msg.2)
                              >
                  ) ▶₀ #vr.5 )
      next
        case split_case_02
        by solve( Receivable( <'g'^inv(~s), 
                               aead(kdf2(<
                                          kdf1(<kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 'g'^inv(~s)>), 
                                                'g'^(~e*inv(~s))>), 
                                          'g'>),
                                    '0',
                                    h(<
                                       h(<
                                          h(<
                                             h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                     h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                               >), 
                                             kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                          aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                               h(<
                                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                    >), 
                                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                               $msg.3)
                                         >), 
                                       'g'^inv(~s)>),
                                    msg.2)
                              >
                  ) ▶₀ #vr.5 )
      next
        case split_case_03
        by solve( Receivable( <'g'^inv((~e*~s)), 
                               aead(kdf2(<
                                          kdf1(<
                                                kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 'g'^inv((~e*~s))
                                                     >), 
                                                'g'^inv(~s)>), 
                                          'g'^inv(~e)>),
                                    '0',
                                    h(<
                                       h(<
                                          h(<
                                             h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                     h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                               >), 
                                             kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                          aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                               h(<
                                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                    >), 
                                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                               $msg.3)
                                         >), 
                                       'g'^inv((~e*~s))>),
                                    msg.2)
                              >
                  ) ▶₀ #vr.5 )
      next
        case split_case_04
        solve( Receivable( <'g'^re, 
                            aead(kdf2(<
                                       kdf1(<kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 'g'^re>), 
                                             'g'^(~e*re)>), 
                                       'g'^(~s*re)>),
                                 '0',
                                 h(<
                                    h(<
                                       h(<
                                          h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                             aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                  h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                            >), 
                                          kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                       aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                            h(<
                                               h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                  aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                       h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                 >), 
                                               kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                            $msg.3)
                                      >), 
                                    'g'^re>),
                                 msg.2)
                           >
               ) ▶₀ #vr.5 )
          case channel_send
          solve( Receivable( <'1', 
                              aead(kdf2(kdf1(<
                                              kdf1(<kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 'g'^~e0>), 
                                                    'g'^(~e*~e0)>), 
                                              'g'^(~e0*~s)>)),
                                   '1', '0', msg)
                             >
                 ) ▶₀ #vr.12 )
            case channel_send
            solve( !KU( ~n ) @ #vk )
              case channel_send
              solve( !KU( ~psk ) @ #vk.15 )
                case psk_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        qed
      next
        case split_case_05
        by solve( Receivable( <'g'^inv((~s*x)), 
                               aead(kdf2(<
                                          kdf1(<
                                                kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 'g'^inv((~s*x))
                                                     >), 
                                                'g'^(~e*inv((~s*x)))>), 
                                          'g'^inv(x)>),
                                    '0',
                                    h(<
                                       h(<
                                          h(<
                                             h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                     h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                               >), 
                                             kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                          aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                               h(<
                                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                    >), 
                                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                               $msg.3)
                                         >), 
                                       'g'^inv((~s*x))>),
                                    msg.2)
                              >
                  ) ▶₀ #vr.5 )
      next
        case split_case_06
        by solve( Receivable( <'g'^(x*inv(~s)), 
                               aead(kdf2(<
                                          kdf1(<
                                                kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 'g'^(x*inv(~s))
                                                     >), 
                                                'g'^(~e*x*inv(~s))>), 
                                          'g'^x>),
                                    '0',
                                    h(<
                                       h(<
                                          h(<
                                             h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                     h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                               >), 
                                             kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                          aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                               h(<
                                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                    >), 
                                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                               $msg.3)
                                         >), 
                                       'g'^(x*inv(~s))>),
                                    msg.2)
                              >
                  ) ▶₀ #vr.5 )
      next
        case split_case_07
        by solve( Receivable( <'g'^inv((~e*~s*x)), 
                               aead(kdf2(<
                                          kdf1(<
                                                kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 
                                                      'g'^inv((~e*~s*x))>), 
                                                'g'^inv((~s*x))>), 
                                          'g'^inv((~e*x))>),
                                    '0',
                                    h(<
                                       h(<
                                          h(<
                                             h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                     h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                               >), 
                                             kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                          aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                               h(<
                                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                    >), 
                                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                               $msg.3)
                                         >), 
                                       'g'^inv((~e*~s*x))>),
                                    msg.2)
                              >
                  ) ▶₀ #vr.5 )
      next
        case split_case_08
        by solve( Receivable( <'g'^inv((~e*x)), 
                               aead(kdf2(<
                                          kdf1(<
                                                kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 'g'^inv((~e*x))
                                                     >), 
                                                'g'^inv(x)>), 
                                          'g'^(~s*inv((~e*x)))>),
                                    '0',
                                    h(<
                                       h(<
                                          h(<
                                             h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                     h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                               >), 
                                             kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                          aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                               h(<
                                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                    >), 
                                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                               $msg.3)
                                         >), 
                                       'g'^inv((~e*x))>),
                                    msg.2)
                              >
                  ) ▶₀ #vr.5 )
      next
        case split_case_09
        by solve( Receivable( <'g'^(x*inv((~s*x.1))), 
                               aead(kdf2(<
                                          kdf1(<
                                                kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 
                                                      'g'^(x*inv((~s*x.1)))>), 
                                                'g'^(~e*x*inv((~s*x.1)))>), 
                                          'g'^(x*inv(x.1))>),
                                    '0',
                                    h(<
                                       h(<
                                          h(<
                                             h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                     h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                               >), 
                                             kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                          aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                               h(<
                                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                    >), 
                                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                               $msg.3)
                                         >), 
                                       'g'^(x*inv((~s*x.1)))>),
                                    msg.2)
                              >
                  ) ▶₀ #vr.5 )
      next
        case split_case_10
        by solve( Receivable( <'g'^(x*inv(~e)), 
                               aead(kdf2(<
                                          kdf1(<
                                                kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 'g'^(x*inv(~e))
                                                     >), 
                                                'g'^x>), 
                                          'g'^(~s*x*inv(~e))>),
                                    '0',
                                    h(<
                                       h(<
                                          h(<
                                             h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                     h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                               >), 
                                             kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                          aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                               h(<
                                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                    >), 
                                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                               $msg.3)
                                         >), 
                                       'g'^(x*inv(~e))>),
                                    msg.2)
                              >
                  ) ▶₀ #vr.5 )
      next
        case split_case_11
        by solve( Receivable( <'g'^(x*inv((~e*~s))), 
                               aead(kdf2(<
                                          kdf1(<
                                                kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 
                                                      'g'^(x*inv((~e*~s)))>), 
                                                'g'^(x*inv(~s))>), 
                                          'g'^(x*inv(~e))>),
                                    '0',
                                    h(<
                                       h(<
                                          h(<
                                             h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                     h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                               >), 
                                             kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                          aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                               h(<
                                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                    >), 
                                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                               $msg.3)
                                         >), 
                                       'g'^(x*inv((~e*~s)))>),
                                    msg.2)
                              >
                  ) ▶₀ #vr.5 )
      next
        case split_case_12
        by solve( Receivable( <'g'^(x*inv((~e*~s*x.1))), 
                               aead(kdf2(<
                                          kdf1(<
                                                kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 
                                                      'g'^(x*inv((~e*~s*x.1)))>), 
                                                'g'^(x*inv((~s*x.1)))>), 
                                          'g'^(x*inv((~e*x.1)))>),
                                    '0',
                                    h(<
                                       h(<
                                          h(<
                                             h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                     h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                               >), 
                                             kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                          aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                               h(<
                                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                    >), 
                                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                               $msg.3)
                                         >), 
                                       'g'^(x*inv((~e*~s*x.1)))>),
                                    msg.2)
                              >
                  ) ▶₀ #vr.5 )
      next
        case split_case_13
        by solve( Receivable( <'g'^(x*inv((~e*x.1))), 
                               aead(kdf2(<
                                          kdf1(<
                                                kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 
                                                      'g'^(x*inv((~e*x.1)))>), 
                                                'g'^(x*inv(x.1))>), 
                                          'g'^(~s*x*inv((~e*x.1)))>),
                                    '0',
                                    h(<
                                       h(<
                                          h(<
                                             h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                     h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                               >), 
                                             kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                          aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                               h(<
                                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                    >), 
                                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                               $msg.3)
                                         >), 
                                       'g'^(x*inv((~e*x.1)))>),
                                    msg.2)
                              >
                  ) ▶₀ #vr.5 )
      qed
    qed
  qed
qed

lemma Secrecy_INpsk1_4_for_Initiator_unless_active_or_reveal_re_AnyTime_or_reveal_psk_AnyTime_end:
  all-traces
  "∀ msg e me re psk #claim.
    (Secret_INpsk1_4_Initiator( e, me, re, psk, msg ) @ #claim) ⇒
    ((¬(∃ #attack. K( msg ) @ #attack)) ∨
     ((∃ #reveal. RevealEk( re ) @ #reveal) ∨
      (∃ #reveal. RevealPsk( psk ) @ #reveal)))"
/*
guarded formula characterizing all counter-examples:
"∃ msg e me re psk #claim.
  (Secret_INpsk1_4_Initiator( e, me, re, psk, msg ) @ #claim)
 ∧
  (∃ #attack. (K( msg ) @ #attack)) ∧
  (∀ #reveal. (RevealEk( re ) @ #reveal) ⇒ ⊥) ∧
  (∀ #reveal. (RevealPsk( psk ) @ #reveal) ⇒ ⊥)"
*/
simplify
solve( St_Initiator_3( ~id, e, me, re, psk ) ▶₀ #claim )
  case Instrumentation_Initiator_3
  solve( I_Recv( ~id, '1', msg ) ▶₁ #claim )
    case I_Recv_from_R
    solve( splitEqs(4) )
      case split_case_1
      by solve( Receivable( <'g', 
                             aead(kdf2(<
                                        kdf1(<kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 'g'>), 'g'^~e>), 
                                        'g'^~s>),
                                  '0',
                                  h(<
                                     h(<
                                        h(<
                                           h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                              aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                   h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                             >), 
                                           kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                        aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                             h(<
                                                h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                   aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                        h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                  >), 
                                                kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                             $msg.3)
                                       >), 
                                     'g'>),
                                  msg.2)
                            >
                ) ▶₀ #vr.5 )
    next
      case split_case_2
      solve( splitEqs(1) )
        case split_case_01
        by solve( Receivable( <'g'^inv(~e), 
                               aead(kdf2(<
                                          kdf1(<kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 'g'^inv(~e)>), 
                                                'g'>), 
                                          'g'^(~s*inv(~e))>),
                                    '0',
                                    h(<
                                       h(<
                                          h(<
                                             h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                     h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                               >), 
                                             kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                          aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                               h(<
                                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                    >), 
                                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                               $msg.3)
                                         >), 
                                       'g'^inv(~e)>),
                                    msg.2)
                              >
                  ) ▶₀ #vr.5 )
      next
        case split_case_02
        by solve( Receivable( <'g'^inv(~s), 
                               aead(kdf2(<
                                          kdf1(<kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 'g'^inv(~s)>), 
                                                'g'^(~e*inv(~s))>), 
                                          'g'>),
                                    '0',
                                    h(<
                                       h(<
                                          h(<
                                             h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                     h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                               >), 
                                             kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                          aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                               h(<
                                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                    >), 
                                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                               $msg.3)
                                         >), 
                                       'g'^inv(~s)>),
                                    msg.2)
                              >
                  ) ▶₀ #vr.5 )
      next
        case split_case_03
        by solve( Receivable( <'g'^inv((~e*~s)), 
                               aead(kdf2(<
                                          kdf1(<
                                                kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 'g'^inv((~e*~s))
                                                     >), 
                                                'g'^inv(~s)>), 
                                          'g'^inv(~e)>),
                                    '0',
                                    h(<
                                       h(<
                                          h(<
                                             h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                     h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                               >), 
                                             kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                          aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                               h(<
                                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                    >), 
                                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                               $msg.3)
                                         >), 
                                       'g'^inv((~e*~s))>),
                                    msg.2)
                              >
                  ) ▶₀ #vr.5 )
      next
        case split_case_04
        solve( Receivable( <'g'^re, 
                            aead(kdf2(<
                                       kdf1(<kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 'g'^re>), 
                                             'g'^(~e*re)>), 
                                       'g'^(~s*re)>),
                                 '0',
                                 h(<
                                    h(<
                                       h(<
                                          h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                             aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                  h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                            >), 
                                          kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                       aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                            h(<
                                               h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                  aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                       h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                 >), 
                                               kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                            $msg.3)
                                      >), 
                                    'g'^re>),
                                 msg.2)
                           >
               ) ▶₀ #vr.5 )
          case channel_send
          solve( Receivable( <'1', 
                              aead(kdf2(kdf1(<
                                              kdf1(<kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 'g'^~e0>), 
                                                    'g'^(~e*~e0)>), 
                                              'g'^(~e0*~s)>)),
                                   '1', '0', msg)
                             >
                 ) ▶₀ #vr.12 )
            case channel_send
            solve( !KU( ~n ) @ #vk )
              case channel_send
              solve( !KU( ~psk ) @ #vk.15 )
                case psk_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        qed
      next
        case split_case_05
        by solve( Receivable( <'g'^inv((~s*x)), 
                               aead(kdf2(<
                                          kdf1(<
                                                kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 'g'^inv((~s*x))
                                                     >), 
                                                'g'^(~e*inv((~s*x)))>), 
                                          'g'^inv(x)>),
                                    '0',
                                    h(<
                                       h(<
                                          h(<
                                             h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                     h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                               >), 
                                             kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                          aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                               h(<
                                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                    >), 
                                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                               $msg.3)
                                         >), 
                                       'g'^inv((~s*x))>),
                                    msg.2)
                              >
                  ) ▶₀ #vr.5 )
      next
        case split_case_06
        by solve( Receivable( <'g'^(x*inv(~s)), 
                               aead(kdf2(<
                                          kdf1(<
                                                kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 'g'^(x*inv(~s))
                                                     >), 
                                                'g'^(~e*x*inv(~s))>), 
                                          'g'^x>),
                                    '0',
                                    h(<
                                       h(<
                                          h(<
                                             h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                     h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                               >), 
                                             kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                          aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                               h(<
                                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                    >), 
                                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                               $msg.3)
                                         >), 
                                       'g'^(x*inv(~s))>),
                                    msg.2)
                              >
                  ) ▶₀ #vr.5 )
      next
        case split_case_07
        by solve( Receivable( <'g'^inv((~e*~s*x)), 
                               aead(kdf2(<
                                          kdf1(<
                                                kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 
                                                      'g'^inv((~e*~s*x))>), 
                                                'g'^inv((~s*x))>), 
                                          'g'^inv((~e*x))>),
                                    '0',
                                    h(<
                                       h(<
                                          h(<
                                             h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                     h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                               >), 
                                             kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                          aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                               h(<
                                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                    >), 
                                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                               $msg.3)
                                         >), 
                                       'g'^inv((~e*~s*x))>),
                                    msg.2)
                              >
                  ) ▶₀ #vr.5 )
      next
        case split_case_08
        by solve( Receivable( <'g'^inv((~e*x)), 
                               aead(kdf2(<
                                          kdf1(<
                                                kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 'g'^inv((~e*x))
                                                     >), 
                                                'g'^inv(x)>), 
                                          'g'^(~s*inv((~e*x)))>),
                                    '0',
                                    h(<
                                       h(<
                                          h(<
                                             h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                     h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                               >), 
                                             kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                          aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                               h(<
                                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                    >), 
                                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                               $msg.3)
                                         >), 
                                       'g'^inv((~e*x))>),
                                    msg.2)
                              >
                  ) ▶₀ #vr.5 )
      next
        case split_case_09
        by solve( Receivable( <'g'^(x*inv((~s*x.1))), 
                               aead(kdf2(<
                                          kdf1(<
                                                kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 
                                                      'g'^(x*inv((~s*x.1)))>), 
                                                'g'^(~e*x*inv((~s*x.1)))>), 
                                          'g'^(x*inv(x.1))>),
                                    '0',
                                    h(<
                                       h(<
                                          h(<
                                             h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                     h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                               >), 
                                             kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                          aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                               h(<
                                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                    >), 
                                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                               $msg.3)
                                         >), 
                                       'g'^(x*inv((~s*x.1)))>),
                                    msg.2)
                              >
                  ) ▶₀ #vr.5 )
      next
        case split_case_10
        by solve( Receivable( <'g'^(x*inv(~e)), 
                               aead(kdf2(<
                                          kdf1(<
                                                kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 'g'^(x*inv(~e))
                                                     >), 
                                                'g'^x>), 
                                          'g'^(~s*x*inv(~e))>),
                                    '0',
                                    h(<
                                       h(<
                                          h(<
                                             h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                     h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                               >), 
                                             kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                          aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                               h(<
                                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                    >), 
                                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                               $msg.3)
                                         >), 
                                       'g'^(x*inv(~e))>),
                                    msg.2)
                              >
                  ) ▶₀ #vr.5 )
      next
        case split_case_11
        by solve( Receivable( <'g'^(x*inv((~e*~s))), 
                               aead(kdf2(<
                                          kdf1(<
                                                kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 
                                                      'g'^(x*inv((~e*~s)))>), 
                                                'g'^(x*inv(~s))>), 
                                          'g'^(x*inv(~e))>),
                                    '0',
                                    h(<
                                       h(<
                                          h(<
                                             h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                     h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                               >), 
                                             kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                          aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                               h(<
                                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                    >), 
                                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                               $msg.3)
                                         >), 
                                       'g'^(x*inv((~e*~s)))>),
                                    msg.2)
                              >
                  ) ▶₀ #vr.5 )
      next
        case split_case_12
        by solve( Receivable( <'g'^(x*inv((~e*~s*x.1))), 
                               aead(kdf2(<
                                          kdf1(<
                                                kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 
                                                      'g'^(x*inv((~e*~s*x.1)))>), 
                                                'g'^(x*inv((~s*x.1)))>), 
                                          'g'^(x*inv((~e*x.1)))>),
                                    '0',
                                    h(<
                                       h(<
                                          h(<
                                             h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                     h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                               >), 
                                             kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                          aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                               h(<
                                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                    >), 
                                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                               $msg.3)
                                         >), 
                                       'g'^(x*inv((~e*~s*x.1)))>),
                                    msg.2)
                              >
                  ) ▶₀ #vr.5 )
      next
        case split_case_13
        by solve( Receivable( <'g'^(x*inv((~e*x.1))), 
                               aead(kdf2(<
                                          kdf1(<
                                                kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 
                                                      'g'^(x*inv((~e*x.1)))>), 
                                                'g'^(x*inv(x.1))>), 
                                          'g'^(~s*x*inv((~e*x.1)))>),
                                    '0',
                                    h(<
                                       h(<
                                          h(<
                                             h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                     h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                               >), 
                                             kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                          aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                               h(<
                                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                    >), 
                                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                               $msg.3)
                                         >), 
                                       'g'^(x*inv((~e*x.1)))>),
                                    msg.2)
                              >
                  ) ▶₀ #vr.5 )
      qed
    qed
  qed
qed

lemma Secrecy_INpsk1_4_for_Initiator_unless_active_or_reveal_s_AnyTime_or_reveal_psk_AnyTime_end [heuristic={unless_reveal_psk}]:
  all-traces
  "∀ msg e me re psk #claim.
    (Secret_INpsk1_4_Initiator( e, me, re, psk, msg ) @ #claim) ⇒
    ((¬(∃ #attack. K( msg ) @ #attack)) ∨
     ((∃ #reveal. RevealLtk( me ) @ #reveal) ∨
      (∃ #reveal. RevealPsk( psk ) @ #reveal)))"
/*
guarded formula characterizing all counter-examples:
"∃ msg e me re psk #claim.
  (Secret_INpsk1_4_Initiator( e, me, re, psk, msg ) @ #claim)
 ∧
  (∃ #attack. (K( msg ) @ #attack)) ∧
  (∀ #reveal. (RevealLtk( me ) @ #reveal) ⇒ ⊥) ∧
  (∀ #reveal. (RevealPsk( psk ) @ #reveal) ⇒ ⊥)"
*/
simplify
solve( St_Initiator_3( ~id, e, me, re, psk ) ▶₀ #claim )
  case Instrumentation_Initiator_3
  solve( I_Recv( ~id, '1', msg ) ▶₁ #claim )
    case I_Recv_from_R
    solve( Receivable( <'1', 
                        aead(kdf2(kdf1(<
                                        kdf1(<kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), re>), z>), z.1>)),
                             '1', '0', msg)
                       >
           ) ▶₀ #vr.12 )
      case channel_send
      solve( !KU( ~n ) @ #vk )
        case channel_send
        solve( !KU( ~psk ) @ #vk.15 )
          case psk_reveal
          by contradiction /* from formulas */
        qed
      qed
    qed
  qed
qed

lemma Secrecy_INpsk1_4_for_Initiator_unless_active_or_reveal_s_AnyTime_or_reveal_re_AnyTime_end:
  all-traces
  "∀ msg e me re psk #claim.
    (Secret_INpsk1_4_Initiator( e, me, re, psk, msg ) @ #claim) ⇒
    ((¬(∃ #attack. K( msg ) @ #attack)) ∨
     ((∃ #reveal. RevealLtk( me ) @ #reveal) ∨
      (∃ #reveal. RevealEk( re ) @ #reveal)))"
/*
guarded formula characterizing all counter-examples:
"∃ msg e me re psk #claim.
  (Secret_INpsk1_4_Initiator( e, me, re, psk, msg ) @ #claim)
 ∧
  (∃ #attack. (K( msg ) @ #attack)) ∧
  (∀ #reveal. (RevealLtk( me ) @ #reveal) ⇒ ⊥) ∧
  (∀ #reveal. (RevealEk( re ) @ #reveal) ⇒ ⊥)"
*/
simplify
solve( St_Initiator_3( ~id, e, me, re, psk ) ▶₀ #claim )
  case Instrumentation_Initiator_3
  solve( I_Recv( ~id, '1', msg ) ▶₁ #claim )
    case I_Recv_from_R
    solve( splitEqs(4) )
      case split_case_1
      by solve( Receivable( <'g', 
                             aead(kdf2(<
                                        kdf1(<kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 'g'>), 'g'^~e>), 
                                        'g'^~s>),
                                  '0',
                                  h(<
                                     h(<
                                        h(<
                                           h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                              aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                   h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                             >), 
                                           kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                        aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                             h(<
                                                h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                   aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                        h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                  >), 
                                                kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                             $msg.3)
                                       >), 
                                     'g'>),
                                  msg.2)
                            >
                ) ▶₀ #vr.5 )
    next
      case split_case_2
      solve( splitEqs(1) )
        case split_case_01
        by solve( Receivable( <'g'^inv(~e), 
                               aead(kdf2(<
                                          kdf1(<kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 'g'^inv(~e)>), 
                                                'g'>), 
                                          'g'^(~s*inv(~e))>),
                                    '0',
                                    h(<
                                       h(<
                                          h(<
                                             h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                     h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                               >), 
                                             kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                          aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                               h(<
                                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                    >), 
                                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                               $msg.3)
                                         >), 
                                       'g'^inv(~e)>),
                                    msg.2)
                              >
                  ) ▶₀ #vr.5 )
      next
        case split_case_02
        by solve( Receivable( <'g'^inv(~s), 
                               aead(kdf2(<
                                          kdf1(<kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 'g'^inv(~s)>), 
                                                'g'^(~e*inv(~s))>), 
                                          'g'>),
                                    '0',
                                    h(<
                                       h(<
                                          h(<
                                             h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                     h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                               >), 
                                             kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                          aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                               h(<
                                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                    >), 
                                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                               $msg.3)
                                         >), 
                                       'g'^inv(~s)>),
                                    msg.2)
                              >
                  ) ▶₀ #vr.5 )
      next
        case split_case_03
        by solve( Receivable( <'g'^inv((~e*~s)), 
                               aead(kdf2(<
                                          kdf1(<
                                                kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 'g'^inv((~e*~s))
                                                     >), 
                                                'g'^inv(~s)>), 
                                          'g'^inv(~e)>),
                                    '0',
                                    h(<
                                       h(<
                                          h(<
                                             h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                     h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                               >), 
                                             kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                          aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                               h(<
                                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                    >), 
                                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                               $msg.3)
                                         >), 
                                       'g'^inv((~e*~s))>),
                                    msg.2)
                              >
                  ) ▶₀ #vr.5 )
      next
        case split_case_04
        solve( Receivable( <'g'^re, 
                            aead(kdf2(<
                                       kdf1(<kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 'g'^re>), 
                                             'g'^(~e*re)>), 
                                       'g'^(~s*re)>),
                                 '0',
                                 h(<
                                    h(<
                                       h(<
                                          h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                             aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                  h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                            >), 
                                          kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                       aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                            h(<
                                               h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                  aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                       h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                 >), 
                                               kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                            $msg.3)
                                      >), 
                                    'g'^re>),
                                 msg.2)
                           >
               ) ▶₀ #vr.5 )
          case channel_send
          solve( Receivable( <'1', 
                              aead(kdf2(kdf1(<
                                              kdf1(<kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 'g'^~e0>), 
                                                    'g'^(~e*~e0)>), 
                                              'g'^(~e0*~s)>)),
                                   '1', '0', msg)
                             >
                 ) ▶₀ #vr.12 )
            case channel_send
            solve( !KU( ~n ) @ #vk )
              case channel_send
              solve( !KU( ~psk ) @ #vk.15 )
                case psk_reveal
                solve( !KU( kdf1(<'INpsk1', 'g'^~e>) ) @ #vk.15 )
                  case c_kdf1
                  solve( !KU( 'g'^(~e0*~s) ) @ #vk.13 )
                    case c_exp
                    solve( !KU( ~e0 ) @ #vk.21 )
                      case ephemeral_reveal
                      by contradiction /* from formulas */
                    qed
                  next
                    case channel_send_case_1
                    solve( !KU( ~e0 ) @ #vk.22 )
                      case ephemeral_reveal
                      by contradiction /* from formulas */
                    qed
                  next
                    case channel_send_case_2
                    solve( !KU( ~s ) @ #vk.19 )
                      case static_reveal
                      by contradiction /* from formulas */
                    qed
                  next
                    case ephemeral_keygen
                    solve( !KU( ~s ) @ #vk.19 )
                      case static_reveal
                      by contradiction /* from formulas */
                    qed
                  next
                    case static_keygen
                    solve( !KU( ~e0 ) @ #vk.19 )
                      case ephemeral_reveal
                      by contradiction /* from formulas */
                    qed
                  qed
                qed
              qed
            qed
          qed
        qed
      next
        case split_case_05
        by solve( Receivable( <'g'^inv((~s*x)), 
                               aead(kdf2(<
                                          kdf1(<
                                                kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 'g'^inv((~s*x))
                                                     >), 
                                                'g'^(~e*inv((~s*x)))>), 
                                          'g'^inv(x)>),
                                    '0',
                                    h(<
                                       h(<
                                          h(<
                                             h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                     h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                               >), 
                                             kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                          aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                               h(<
                                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                    >), 
                                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                               $msg.3)
                                         >), 
                                       'g'^inv((~s*x))>),
                                    msg.2)
                              >
                  ) ▶₀ #vr.5 )
      next
        case split_case_06
        by solve( Receivable( <'g'^(x*inv(~s)), 
                               aead(kdf2(<
                                          kdf1(<
                                                kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 'g'^(x*inv(~s))
                                                     >), 
                                                'g'^(~e*x*inv(~s))>), 
                                          'g'^x>),
                                    '0',
                                    h(<
                                       h(<
                                          h(<
                                             h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                     h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                               >), 
                                             kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                          aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                               h(<
                                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                    >), 
                                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                               $msg.3)
                                         >), 
                                       'g'^(x*inv(~s))>),
                                    msg.2)
                              >
                  ) ▶₀ #vr.5 )
      next
        case split_case_07
        by solve( Receivable( <'g'^inv((~e*~s*x)), 
                               aead(kdf2(<
                                          kdf1(<
                                                kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 
                                                      'g'^inv((~e*~s*x))>), 
                                                'g'^inv((~s*x))>), 
                                          'g'^inv((~e*x))>),
                                    '0',
                                    h(<
                                       h(<
                                          h(<
                                             h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                     h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                               >), 
                                             kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                          aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                               h(<
                                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                    >), 
                                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                               $msg.3)
                                         >), 
                                       'g'^inv((~e*~s*x))>),
                                    msg.2)
                              >
                  ) ▶₀ #vr.5 )
      next
        case split_case_08
        by solve( Receivable( <'g'^inv((~e*x)), 
                               aead(kdf2(<
                                          kdf1(<
                                                kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 'g'^inv((~e*x))
                                                     >), 
                                                'g'^inv(x)>), 
                                          'g'^(~s*inv((~e*x)))>),
                                    '0',
                                    h(<
                                       h(<
                                          h(<
                                             h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                     h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                               >), 
                                             kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                          aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                               h(<
                                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                    >), 
                                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                               $msg.3)
                                         >), 
                                       'g'^inv((~e*x))>),
                                    msg.2)
                              >
                  ) ▶₀ #vr.5 )
      next
        case split_case_09
        by solve( Receivable( <'g'^(x*inv((~s*x.1))), 
                               aead(kdf2(<
                                          kdf1(<
                                                kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 
                                                      'g'^(x*inv((~s*x.1)))>), 
                                                'g'^(~e*x*inv((~s*x.1)))>), 
                                          'g'^(x*inv(x.1))>),
                                    '0',
                                    h(<
                                       h(<
                                          h(<
                                             h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                     h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                               >), 
                                             kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                          aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                               h(<
                                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                    >), 
                                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                               $msg.3)
                                         >), 
                                       'g'^(x*inv((~s*x.1)))>),
                                    msg.2)
                              >
                  ) ▶₀ #vr.5 )
      next
        case split_case_10
        by solve( Receivable( <'g'^(x*inv(~e)), 
                               aead(kdf2(<
                                          kdf1(<
                                                kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 'g'^(x*inv(~e))
                                                     >), 
                                                'g'^x>), 
                                          'g'^(~s*x*inv(~e))>),
                                    '0',
                                    h(<
                                       h(<
                                          h(<
                                             h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                     h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                               >), 
                                             kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                          aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                               h(<
                                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                    >), 
                                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                               $msg.3)
                                         >), 
                                       'g'^(x*inv(~e))>),
                                    msg.2)
                              >
                  ) ▶₀ #vr.5 )
      next
        case split_case_11
        by solve( Receivable( <'g'^(x*inv((~e*~s))), 
                               aead(kdf2(<
                                          kdf1(<
                                                kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 
                                                      'g'^(x*inv((~e*~s)))>), 
                                                'g'^(x*inv(~s))>), 
                                          'g'^(x*inv(~e))>),
                                    '0',
                                    h(<
                                       h(<
                                          h(<
                                             h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                     h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                               >), 
                                             kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                          aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                               h(<
                                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                    >), 
                                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                               $msg.3)
                                         >), 
                                       'g'^(x*inv((~e*~s)))>),
                                    msg.2)
                              >
                  ) ▶₀ #vr.5 )
      next
        case split_case_12
        by solve( Receivable( <'g'^(x*inv((~e*~s*x.1))), 
                               aead(kdf2(<
                                          kdf1(<
                                                kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 
                                                      'g'^(x*inv((~e*~s*x.1)))>), 
                                                'g'^(x*inv((~s*x.1)))>), 
                                          'g'^(x*inv((~e*x.1)))>),
                                    '0',
                                    h(<
                                       h(<
                                          h(<
                                             h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                     h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                               >), 
                                             kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                          aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                               h(<
                                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                    >), 
                                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                               $msg.3)
                                         >), 
                                       'g'^(x*inv((~e*~s*x.1)))>),
                                    msg.2)
                              >
                  ) ▶₀ #vr.5 )
      next
        case split_case_13
        by solve( Receivable( <'g'^(x*inv((~e*x.1))), 
                               aead(kdf2(<
                                          kdf1(<
                                                kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 
                                                      'g'^(x*inv((~e*x.1)))>), 
                                                'g'^(x*inv(x.1))>), 
                                          'g'^(~s*x*inv((~e*x.1)))>),
                                    '0',
                                    h(<
                                       h(<
                                          h(<
                                             h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                     h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                               >), 
                                             kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                          aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                               h(<
                                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                    >), 
                                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                               $msg.3)
                                         >), 
                                       'g'^(x*inv((~e*x.1)))>),
                                    msg.2)
                              >
                  ) ▶₀ #vr.5 )
      qed
    qed
  qed
qed

lemma Secrecy_INpsk1_4_for_Initiator_unless_active_or_reveal_s_AnyTime_or_reveal_re_AnyTime_or_reveal_psk_AnyTime_end:
  all-traces
  "∀ msg e me re psk #claim.
    (Secret_INpsk1_4_Initiator( e, me, re, psk, msg ) @ #claim) ⇒
    ((¬(∃ #attack. K( msg ) @ #attack)) ∨
     (((∃ #reveal. RevealLtk( me ) @ #reveal) ∨
       (∃ #reveal. RevealEk( re ) @ #reveal)) ∨
      (∃ #reveal. RevealPsk( psk ) @ #reveal)))"
/*
guarded formula characterizing all counter-examples:
"∃ msg e me re psk #claim.
  (Secret_INpsk1_4_Initiator( e, me, re, psk, msg ) @ #claim)
 ∧
  (∃ #attack. (K( msg ) @ #attack)) ∧
  (∀ #reveal. (RevealLtk( me ) @ #reveal) ⇒ ⊥) ∧
  (∀ #reveal. (RevealEk( re ) @ #reveal) ⇒ ⊥) ∧
  (∀ #reveal. (RevealPsk( psk ) @ #reveal) ⇒ ⊥)"
*/
simplify
solve( St_Initiator_3( ~id, e, me, re, psk ) ▶₀ #claim )
  case Instrumentation_Initiator_3
  solve( I_Recv( ~id, '1', msg ) ▶₁ #claim )
    case I_Recv_from_R
    solve( splitEqs(4) )
      case split_case_1
      by solve( Receivable( <'g', 
                             aead(kdf2(<
                                        kdf1(<kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 'g'>), 'g'^~e>), 
                                        'g'^~s>),
                                  '0',
                                  h(<
                                     h(<
                                        h(<
                                           h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                              aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                   h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                             >), 
                                           kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                        aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                             h(<
                                                h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                   aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                        h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                  >), 
                                                kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                             $msg.3)
                                       >), 
                                     'g'>),
                                  msg.2)
                            >
                ) ▶₀ #vr.5 )
    next
      case split_case_2
      solve( splitEqs(1) )
        case split_case_01
        by solve( Receivable( <'g'^inv(~e), 
                               aead(kdf2(<
                                          kdf1(<kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 'g'^inv(~e)>), 
                                                'g'>), 
                                          'g'^(~s*inv(~e))>),
                                    '0',
                                    h(<
                                       h(<
                                          h(<
                                             h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                     h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                               >), 
                                             kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                          aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                               h(<
                                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                    >), 
                                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                               $msg.3)
                                         >), 
                                       'g'^inv(~e)>),
                                    msg.2)
                              >
                  ) ▶₀ #vr.5 )
      next
        case split_case_02
        by solve( Receivable( <'g'^inv(~s), 
                               aead(kdf2(<
                                          kdf1(<kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 'g'^inv(~s)>), 
                                                'g'^(~e*inv(~s))>), 
                                          'g'>),
                                    '0',
                                    h(<
                                       h(<
                                          h(<
                                             h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                     h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                               >), 
                                             kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                          aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                               h(<
                                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                    >), 
                                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                               $msg.3)
                                         >), 
                                       'g'^inv(~s)>),
                                    msg.2)
                              >
                  ) ▶₀ #vr.5 )
      next
        case split_case_03
        by solve( Receivable( <'g'^inv((~e*~s)), 
                               aead(kdf2(<
                                          kdf1(<
                                                kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 'g'^inv((~e*~s))
                                                     >), 
                                                'g'^inv(~s)>), 
                                          'g'^inv(~e)>),
                                    '0',
                                    h(<
                                       h(<
                                          h(<
                                             h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                     h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                               >), 
                                             kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                          aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                               h(<
                                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                    >), 
                                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                               $msg.3)
                                         >), 
                                       'g'^inv((~e*~s))>),
                                    msg.2)
                              >
                  ) ▶₀ #vr.5 )
      next
        case split_case_04
        solve( Receivable( <'g'^re, 
                            aead(kdf2(<
                                       kdf1(<kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 'g'^re>), 
                                             'g'^(~e*re)>), 
                                       'g'^(~s*re)>),
                                 '0',
                                 h(<
                                    h(<
                                       h(<
                                          h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                             aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                  h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                            >), 
                                          kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                       aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                            h(<
                                               h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                  aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                       h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                 >), 
                                               kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                            $msg.3)
                                      >), 
                                    'g'^re>),
                                 msg.2)
                           >
               ) ▶₀ #vr.5 )
          case channel_send
          solve( Receivable( <'1', 
                              aead(kdf2(kdf1(<
                                              kdf1(<kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 'g'^~e0>), 
                                                    'g'^(~e*~e0)>), 
                                              'g'^(~e0*~s)>)),
                                   '1', '0', msg)
                             >
                 ) ▶₀ #vr.12 )
            case channel_send
            solve( !KU( ~n ) @ #vk )
              case channel_send
              solve( !KU( ~psk ) @ #vk.15 )
                case psk_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        qed
      next
        case split_case_05
        by solve( Receivable( <'g'^inv((~s*x)), 
                               aead(kdf2(<
                                          kdf1(<
                                                kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 'g'^inv((~s*x))
                                                     >), 
                                                'g'^(~e*inv((~s*x)))>), 
                                          'g'^inv(x)>),
                                    '0',
                                    h(<
                                       h(<
                                          h(<
                                             h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                     h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                               >), 
                                             kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                          aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                               h(<
                                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                    >), 
                                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                               $msg.3)
                                         >), 
                                       'g'^inv((~s*x))>),
                                    msg.2)
                              >
                  ) ▶₀ #vr.5 )
      next
        case split_case_06
        by solve( Receivable( <'g'^(x*inv(~s)), 
                               aead(kdf2(<
                                          kdf1(<
                                                kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 'g'^(x*inv(~s))
                                                     >), 
                                                'g'^(~e*x*inv(~s))>), 
                                          'g'^x>),
                                    '0',
                                    h(<
                                       h(<
                                          h(<
                                             h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                     h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                               >), 
                                             kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                          aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                               h(<
                                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                    >), 
                                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                               $msg.3)
                                         >), 
                                       'g'^(x*inv(~s))>),
                                    msg.2)
                              >
                  ) ▶₀ #vr.5 )
      next
        case split_case_07
        by solve( Receivable( <'g'^inv((~e*~s*x)), 
                               aead(kdf2(<
                                          kdf1(<
                                                kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 
                                                      'g'^inv((~e*~s*x))>), 
                                                'g'^inv((~s*x))>), 
                                          'g'^inv((~e*x))>),
                                    '0',
                                    h(<
                                       h(<
                                          h(<
                                             h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                     h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                               >), 
                                             kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                          aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                               h(<
                                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                    >), 
                                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                               $msg.3)
                                         >), 
                                       'g'^inv((~e*~s*x))>),
                                    msg.2)
                              >
                  ) ▶₀ #vr.5 )
      next
        case split_case_08
        by solve( Receivable( <'g'^inv((~e*x)), 
                               aead(kdf2(<
                                          kdf1(<
                                                kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 'g'^inv((~e*x))
                                                     >), 
                                                'g'^inv(x)>), 
                                          'g'^(~s*inv((~e*x)))>),
                                    '0',
                                    h(<
                                       h(<
                                          h(<
                                             h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                     h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                               >), 
                                             kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                          aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                               h(<
                                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                    >), 
                                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                               $msg.3)
                                         >), 
                                       'g'^inv((~e*x))>),
                                    msg.2)
                              >
                  ) ▶₀ #vr.5 )
      next
        case split_case_09
        by solve( Receivable( <'g'^(x*inv((~s*x.1))), 
                               aead(kdf2(<
                                          kdf1(<
                                                kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 
                                                      'g'^(x*inv((~s*x.1)))>), 
                                                'g'^(~e*x*inv((~s*x.1)))>), 
                                          'g'^(x*inv(x.1))>),
                                    '0',
                                    h(<
                                       h(<
                                          h(<
                                             h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                     h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                               >), 
                                             kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                          aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                               h(<
                                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                    >), 
                                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                               $msg.3)
                                         >), 
                                       'g'^(x*inv((~s*x.1)))>),
                                    msg.2)
                              >
                  ) ▶₀ #vr.5 )
      next
        case split_case_10
        by solve( Receivable( <'g'^(x*inv(~e)), 
                               aead(kdf2(<
                                          kdf1(<
                                                kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 'g'^(x*inv(~e))
                                                     >), 
                                                'g'^x>), 
                                          'g'^(~s*x*inv(~e))>),
                                    '0',
                                    h(<
                                       h(<
                                          h(<
                                             h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                     h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                               >), 
                                             kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                          aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                               h(<
                                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                    >), 
                                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                               $msg.3)
                                         >), 
                                       'g'^(x*inv(~e))>),
                                    msg.2)
                              >
                  ) ▶₀ #vr.5 )
      next
        case split_case_11
        by solve( Receivable( <'g'^(x*inv((~e*~s))), 
                               aead(kdf2(<
                                          kdf1(<
                                                kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 
                                                      'g'^(x*inv((~e*~s)))>), 
                                                'g'^(x*inv(~s))>), 
                                          'g'^(x*inv(~e))>),
                                    '0',
                                    h(<
                                       h(<
                                          h(<
                                             h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                     h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                               >), 
                                             kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                          aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                               h(<
                                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                    >), 
                                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                               $msg.3)
                                         >), 
                                       'g'^(x*inv((~e*~s)))>),
                                    msg.2)
                              >
                  ) ▶₀ #vr.5 )
      next
        case split_case_12
        by solve( Receivable( <'g'^(x*inv((~e*~s*x.1))), 
                               aead(kdf2(<
                                          kdf1(<
                                                kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 
                                                      'g'^(x*inv((~e*~s*x.1)))>), 
                                                'g'^(x*inv((~s*x.1)))>), 
                                          'g'^(x*inv((~e*x.1)))>),
                                    '0',
                                    h(<
                                       h(<
                                          h(<
                                             h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                     h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                               >), 
                                             kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                          aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                               h(<
                                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                    >), 
                                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                               $msg.3)
                                         >), 
                                       'g'^(x*inv((~e*~s*x.1)))>),
                                    msg.2)
                              >
                  ) ▶₀ #vr.5 )
      next
        case split_case_13
        by solve( Receivable( <'g'^(x*inv((~e*x.1))), 
                               aead(kdf2(<
                                          kdf1(<
                                                kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 
                                                      'g'^(x*inv((~e*x.1)))>), 
                                                'g'^(x*inv(x.1))>), 
                                          'g'^(~s*x*inv((~e*x.1)))>),
                                    '0',
                                    h(<
                                       h(<
                                          h(<
                                             h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                     h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                               >), 
                                             kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                          aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                               h(<
                                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                    >), 
                                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                               $msg.3)
                                         >), 
                                       'g'^(x*inv((~e*x.1)))>),
                                    msg.2)
                              >
                  ) ▶₀ #vr.5 )
      qed
    qed
  qed
qed

lemma Secrecy_INpsk1_4_for_Initiator_unless_active_or_reveal_e_AnyTime_or_reveal_re_AnyTime_end:
  all-traces
  "∀ msg e me re psk #claim.
    (Secret_INpsk1_4_Initiator( e, me, re, psk, msg ) @ #claim) ⇒
    ((¬(∃ #attack. K( msg ) @ #attack)) ∨
     ((∃ #reveal. RevealEk( e ) @ #reveal) ∨
      (∃ #reveal. RevealEk( re ) @ #reveal)))"
/*
guarded formula characterizing all counter-examples:
"∃ msg e me re psk #claim.
  (Secret_INpsk1_4_Initiator( e, me, re, psk, msg ) @ #claim)
 ∧
  (∃ #attack. (K( msg ) @ #attack)) ∧
  (∀ #reveal. (RevealEk( e ) @ #reveal) ⇒ ⊥) ∧
  (∀ #reveal. (RevealEk( re ) @ #reveal) ⇒ ⊥)"
*/
simplify
solve( St_Initiator_3( ~id, e, me, re, psk ) ▶₀ #claim )
  case Instrumentation_Initiator_3
  solve( I_Recv( ~id, '1', msg ) ▶₁ #claim )
    case I_Recv_from_R
    solve( splitEqs(4) )
      case split_case_1
      by solve( Receivable( <'g', 
                             aead(kdf2(<
                                        kdf1(<kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 'g'>), 'g'^~e>), 
                                        'g'^~s>),
                                  '0',
                                  h(<
                                     h(<
                                        h(<
                                           h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                              aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                   h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                             >), 
                                           kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                        aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                             h(<
                                                h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                   aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                        h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                  >), 
                                                kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                             $msg.3)
                                       >), 
                                     'g'>),
                                  msg.2)
                            >
                ) ▶₀ #vr.5 )
    next
      case split_case_2
      solve( splitEqs(1) )
        case split_case_01
        by solve( Receivable( <'g'^inv(~e), 
                               aead(kdf2(<
                                          kdf1(<kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 'g'^inv(~e)>), 
                                                'g'>), 
                                          'g'^(~s*inv(~e))>),
                                    '0',
                                    h(<
                                       h(<
                                          h(<
                                             h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                     h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                               >), 
                                             kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                          aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                               h(<
                                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                    >), 
                                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                               $msg.3)
                                         >), 
                                       'g'^inv(~e)>),
                                    msg.2)
                              >
                  ) ▶₀ #vr.5 )
      next
        case split_case_02
        by solve( Receivable( <'g'^inv(~s), 
                               aead(kdf2(<
                                          kdf1(<kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 'g'^inv(~s)>), 
                                                'g'^(~e*inv(~s))>), 
                                          'g'>),
                                    '0',
                                    h(<
                                       h(<
                                          h(<
                                             h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                     h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                               >), 
                                             kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                          aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                               h(<
                                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                    >), 
                                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                               $msg.3)
                                         >), 
                                       'g'^inv(~s)>),
                                    msg.2)
                              >
                  ) ▶₀ #vr.5 )
      next
        case split_case_03
        by solve( Receivable( <'g'^inv((~e*~s)), 
                               aead(kdf2(<
                                          kdf1(<
                                                kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 'g'^inv((~e*~s))
                                                     >), 
                                                'g'^inv(~s)>), 
                                          'g'^inv(~e)>),
                                    '0',
                                    h(<
                                       h(<
                                          h(<
                                             h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                     h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                               >), 
                                             kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                          aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                               h(<
                                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                    >), 
                                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                               $msg.3)
                                         >), 
                                       'g'^inv((~e*~s))>),
                                    msg.2)
                              >
                  ) ▶₀ #vr.5 )
      next
        case split_case_04
        solve( Receivable( <'g'^re, 
                            aead(kdf2(<
                                       kdf1(<kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 'g'^re>), 
                                             'g'^(~e*re)>), 
                                       'g'^(~s*re)>),
                                 '0',
                                 h(<
                                    h(<
                                       h(<
                                          h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                             aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                  h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                            >), 
                                          kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                       aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                            h(<
                                               h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                  aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                       h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                 >), 
                                               kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                            $msg.3)
                                      >), 
                                    'g'^re>),
                                 msg.2)
                           >
               ) ▶₀ #vr.5 )
          case channel_send
          solve( Receivable( <'1', 
                              aead(kdf2(kdf1(<
                                              kdf1(<kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 'g'^~e0>), 
                                                    'g'^(~e*~e0)>), 
                                              'g'^(~e0*~s)>)),
                                   '1', '0', msg)
                             >
                 ) ▶₀ #vr.12 )
            case channel_send
            solve( !KU( ~n ) @ #vk )
              case channel_send
              solve( !KU( ~psk ) @ #vk.15 )
                case psk_reveal
                solve( !KU( kdf1(<'INpsk1', 'g'^~e>) ) @ #vk.15 )
                  case c_kdf1
                  solve( !KU( 'g'^(~e0*~s) ) @ #vk.13 )
                    case c_exp
                    solve( !KU( ~e0 ) @ #vk.21 )
                      case ephemeral_reveal
                      by contradiction /* from formulas */
                    qed
                  next
                    case channel_send_case_1
                    solve( !KU( ~e0 ) @ #vk.22 )
                      case ephemeral_reveal
                      by contradiction /* from formulas */
                    qed
                  next
                    case channel_send_case_2
                    solve( !KU( ~s ) @ #vk.19 )
                      case static_reveal
                      solve( !KU( 'g'^(~e*~e0) ) @ #vk.15 )
                        case c_exp
                        solve( !KU( ~e ) @ #vk.22 )
                          case ephemeral_reveal
                          by contradiction /* from formulas */
                        qed
                      next
                        case channel_send_case_1
                        solve( !KU( ~e0 ) @ #vk.20 )
                          case ephemeral_reveal
                          by contradiction /* from formulas */
                        qed
                      next
                        case channel_send_case_2
                        solve( !KU( ~e ) @ #vk.20 )
                          case ephemeral_reveal
                          by contradiction /* from formulas */
                        qed
                      next
                        case ephemeral_keygen
                        solve( !KU( ~e0 ) @ #vk.20 )
                          case ephemeral_reveal
                          by contradiction /* from formulas */
                        qed
                      qed
                    qed
                  next
                    case ephemeral_keygen
                    solve( !KU( ~s ) @ #vk.19 )
                      case static_reveal
                      solve( !KU( 'g'^(~e*~e0) ) @ #vk.16 )
                        case c_exp
                        solve( !KU( ~e ) @ #vk.22 )
                          case ephemeral_reveal
                          by contradiction /* from formulas */
                        qed
                      next
                        case channel_send
                        solve( !KU( ~e0 ) @ #vk.20 )
                          case ephemeral_reveal
                          by contradiction /* from formulas */
                        qed
                      next
                        case ephemeral_keygen_case_1
                        solve( !KU( ~e ) @ #vk.20 )
                          case ephemeral_reveal
                          by contradiction /* from formulas */
                        qed
                      next
                        case ephemeral_keygen_case_2
                        solve( !KU( ~e0 ) @ #vk.20 )
                          case ephemeral_reveal
                          by contradiction /* from formulas */
                        qed
                      qed
                    qed
                  next
                    case static_keygen
                    solve( !KU( ~e0 ) @ #vk.19 )
                      case ephemeral_reveal
                      by contradiction /* from formulas */
                    qed
                  qed
                qed
              qed
            qed
          qed
        qed
      next
        case split_case_05
        by solve( Receivable( <'g'^inv((~s*x)), 
                               aead(kdf2(<
                                          kdf1(<
                                                kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 'g'^inv((~s*x))
                                                     >), 
                                                'g'^(~e*inv((~s*x)))>), 
                                          'g'^inv(x)>),
                                    '0',
                                    h(<
                                       h(<
                                          h(<
                                             h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                     h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                               >), 
                                             kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                          aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                               h(<
                                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                    >), 
                                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                               $msg.3)
                                         >), 
                                       'g'^inv((~s*x))>),
                                    msg.2)
                              >
                  ) ▶₀ #vr.5 )
      next
        case split_case_06
        by solve( Receivable( <'g'^(x*inv(~s)), 
                               aead(kdf2(<
                                          kdf1(<
                                                kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 'g'^(x*inv(~s))
                                                     >), 
                                                'g'^(~e*x*inv(~s))>), 
                                          'g'^x>),
                                    '0',
                                    h(<
                                       h(<
                                          h(<
                                             h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                     h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                               >), 
                                             kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                          aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                               h(<
                                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                    >), 
                                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                               $msg.3)
                                         >), 
                                       'g'^(x*inv(~s))>),
                                    msg.2)
                              >
                  ) ▶₀ #vr.5 )
      next
        case split_case_07
        by solve( Receivable( <'g'^inv((~e*~s*x)), 
                               aead(kdf2(<
                                          kdf1(<
                                                kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 
                                                      'g'^inv((~e*~s*x))>), 
                                                'g'^inv((~s*x))>), 
                                          'g'^inv((~e*x))>),
                                    '0',
                                    h(<
                                       h(<
                                          h(<
                                             h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                     h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                               >), 
                                             kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                          aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                               h(<
                                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                    >), 
                                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                               $msg.3)
                                         >), 
                                       'g'^inv((~e*~s*x))>),
                                    msg.2)
                              >
                  ) ▶₀ #vr.5 )
      next
        case split_case_08
        by solve( Receivable( <'g'^inv((~e*x)), 
                               aead(kdf2(<
                                          kdf1(<
                                                kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 'g'^inv((~e*x))
                                                     >), 
                                                'g'^inv(x)>), 
                                          'g'^(~s*inv((~e*x)))>),
                                    '0',
                                    h(<
                                       h(<
                                          h(<
                                             h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                     h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                               >), 
                                             kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                          aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                               h(<
                                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                    >), 
                                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                               $msg.3)
                                         >), 
                                       'g'^inv((~e*x))>),
                                    msg.2)
                              >
                  ) ▶₀ #vr.5 )
      next
        case split_case_09
        by solve( Receivable( <'g'^(x*inv((~s*x.1))), 
                               aead(kdf2(<
                                          kdf1(<
                                                kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 
                                                      'g'^(x*inv((~s*x.1)))>), 
                                                'g'^(~e*x*inv((~s*x.1)))>), 
                                          'g'^(x*inv(x.1))>),
                                    '0',
                                    h(<
                                       h(<
                                          h(<
                                             h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                     h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                               >), 
                                             kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                          aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                               h(<
                                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                    >), 
                                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                               $msg.3)
                                         >), 
                                       'g'^(x*inv((~s*x.1)))>),
                                    msg.2)
                              >
                  ) ▶₀ #vr.5 )
      next
        case split_case_10
        by solve( Receivable( <'g'^(x*inv(~e)), 
                               aead(kdf2(<
                                          kdf1(<
                                                kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 'g'^(x*inv(~e))
                                                     >), 
                                                'g'^x>), 
                                          'g'^(~s*x*inv(~e))>),
                                    '0',
                                    h(<
                                       h(<
                                          h(<
                                             h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                     h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                               >), 
                                             kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                          aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                               h(<
                                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                    >), 
                                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                               $msg.3)
                                         >), 
                                       'g'^(x*inv(~e))>),
                                    msg.2)
                              >
                  ) ▶₀ #vr.5 )
      next
        case split_case_11
        by solve( Receivable( <'g'^(x*inv((~e*~s))), 
                               aead(kdf2(<
                                          kdf1(<
                                                kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 
                                                      'g'^(x*inv((~e*~s)))>), 
                                                'g'^(x*inv(~s))>), 
                                          'g'^(x*inv(~e))>),
                                    '0',
                                    h(<
                                       h(<
                                          h(<
                                             h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                     h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                               >), 
                                             kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                          aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                               h(<
                                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                    >), 
                                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                               $msg.3)
                                         >), 
                                       'g'^(x*inv((~e*~s)))>),
                                    msg.2)
                              >
                  ) ▶₀ #vr.5 )
      next
        case split_case_12
        by solve( Receivable( <'g'^(x*inv((~e*~s*x.1))), 
                               aead(kdf2(<
                                          kdf1(<
                                                kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 
                                                      'g'^(x*inv((~e*~s*x.1)))>), 
                                                'g'^(x*inv((~s*x.1)))>), 
                                          'g'^(x*inv((~e*x.1)))>),
                                    '0',
                                    h(<
                                       h(<
                                          h(<
                                             h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                     h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                               >), 
                                             kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                          aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                               h(<
                                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                    >), 
                                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                               $msg.3)
                                         >), 
                                       'g'^(x*inv((~e*~s*x.1)))>),
                                    msg.2)
                              >
                  ) ▶₀ #vr.5 )
      next
        case split_case_13
        by solve( Receivable( <'g'^(x*inv((~e*x.1))), 
                               aead(kdf2(<
                                          kdf1(<
                                                kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 
                                                      'g'^(x*inv((~e*x.1)))>), 
                                                'g'^(x*inv(x.1))>), 
                                          'g'^(~s*x*inv((~e*x.1)))>),
                                    '0',
                                    h(<
                                       h(<
                                          h(<
                                             h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                     h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                               >), 
                                             kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                          aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                               h(<
                                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                    >), 
                                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                               $msg.3)
                                         >), 
                                       'g'^(x*inv((~e*x.1)))>),
                                    msg.2)
                              >
                  ) ▶₀ #vr.5 )
      qed
    qed
  qed
qed

lemma Secrecy_INpsk1_4_for_Initiator_unless_active_or_reveal_e_AnyTime_or_reveal_s_AnyTime_or_reveal_re_AnyTime_end:
  all-traces
  "∀ msg e me re psk #claim.
    (Secret_INpsk1_4_Initiator( e, me, re, psk, msg ) @ #claim) ⇒
    ((¬(∃ #attack. K( msg ) @ #attack)) ∨
     (((∃ #reveal. RevealEk( e ) @ #reveal) ∨
       (∃ #reveal. RevealLtk( me ) @ #reveal)) ∨
      (∃ #reveal. RevealEk( re ) @ #reveal)))"
/*
guarded formula characterizing all counter-examples:
"∃ msg e me re psk #claim.
  (Secret_INpsk1_4_Initiator( e, me, re, psk, msg ) @ #claim)
 ∧
  (∃ #attack. (K( msg ) @ #attack)) ∧
  (∀ #reveal. (RevealEk( e ) @ #reveal) ⇒ ⊥) ∧
  (∀ #reveal. (RevealLtk( me ) @ #reveal) ⇒ ⊥) ∧
  (∀ #reveal. (RevealEk( re ) @ #reveal) ⇒ ⊥)"
*/
simplify
solve( St_Initiator_3( ~id, e, me, re, psk ) ▶₀ #claim )
  case Instrumentation_Initiator_3
  solve( I_Recv( ~id, '1', msg ) ▶₁ #claim )
    case I_Recv_from_R
    solve( splitEqs(4) )
      case split_case_1
      by solve( Receivable( <'g', 
                             aead(kdf2(<
                                        kdf1(<kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 'g'>), 'g'^~e>), 
                                        'g'^~s>),
                                  '0',
                                  h(<
                                     h(<
                                        h(<
                                           h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                              aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                   h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                             >), 
                                           kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                        aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                             h(<
                                                h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                   aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                        h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                  >), 
                                                kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                             $msg.3)
                                       >), 
                                     'g'>),
                                  msg.2)
                            >
                ) ▶₀ #vr.5 )
    next
      case split_case_2
      solve( splitEqs(1) )
        case split_case_01
        by solve( Receivable( <'g'^inv(~e), 
                               aead(kdf2(<
                                          kdf1(<kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 'g'^inv(~e)>), 
                                                'g'>), 
                                          'g'^(~s*inv(~e))>),
                                    '0',
                                    h(<
                                       h(<
                                          h(<
                                             h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                     h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                               >), 
                                             kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                          aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                               h(<
                                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                    >), 
                                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                               $msg.3)
                                         >), 
                                       'g'^inv(~e)>),
                                    msg.2)
                              >
                  ) ▶₀ #vr.5 )
      next
        case split_case_02
        by solve( Receivable( <'g'^inv(~s), 
                               aead(kdf2(<
                                          kdf1(<kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 'g'^inv(~s)>), 
                                                'g'^(~e*inv(~s))>), 
                                          'g'>),
                                    '0',
                                    h(<
                                       h(<
                                          h(<
                                             h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                     h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                               >), 
                                             kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                          aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                               h(<
                                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                    >), 
                                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                               $msg.3)
                                         >), 
                                       'g'^inv(~s)>),
                                    msg.2)
                              >
                  ) ▶₀ #vr.5 )
      next
        case split_case_03
        by solve( Receivable( <'g'^inv((~e*~s)), 
                               aead(kdf2(<
                                          kdf1(<
                                                kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 'g'^inv((~e*~s))
                                                     >), 
                                                'g'^inv(~s)>), 
                                          'g'^inv(~e)>),
                                    '0',
                                    h(<
                                       h(<
                                          h(<
                                             h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                     h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                               >), 
                                             kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                          aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                               h(<
                                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                    >), 
                                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                               $msg.3)
                                         >), 
                                       'g'^inv((~e*~s))>),
                                    msg.2)
                              >
                  ) ▶₀ #vr.5 )
      next
        case split_case_04
        solve( Receivable( <'g'^re, 
                            aead(kdf2(<
                                       kdf1(<kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 'g'^re>), 
                                             'g'^(~e*re)>), 
                                       'g'^(~s*re)>),
                                 '0',
                                 h(<
                                    h(<
                                       h(<
                                          h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                             aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                  h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                            >), 
                                          kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                       aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                            h(<
                                               h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                  aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                       h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                 >), 
                                               kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                            $msg.3)
                                      >), 
                                    'g'^re>),
                                 msg.2)
                           >
               ) ▶₀ #vr.5 )
          case channel_send
          solve( Receivable( <'1', 
                              aead(kdf2(kdf1(<
                                              kdf1(<kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 'g'^~e0>), 
                                                    'g'^(~e*~e0)>), 
                                              'g'^(~e0*~s)>)),
                                   '1', '0', msg)
                             >
                 ) ▶₀ #vr.12 )
            case channel_send
            solve( !KU( ~n ) @ #vk )
              case channel_send
              solve( !KU( ~psk ) @ #vk.15 )
                case psk_reveal
                solve( !KU( kdf1(<'INpsk1', 'g'^~e>) ) @ #vk.15 )
                  case c_kdf1
                  solve( !KU( 'g'^(~e0*~s) ) @ #vk.13 )
                    case c_exp
                    solve( !KU( ~e0 ) @ #vk.21 )
                      case ephemeral_reveal
                      by contradiction /* from formulas */
                    qed
                  next
                    case channel_send_case_1
                    solve( !KU( ~e0 ) @ #vk.22 )
                      case ephemeral_reveal
                      by contradiction /* from formulas */
                    qed
                  next
                    case channel_send_case_2
                    solve( !KU( ~s ) @ #vk.19 )
                      case static_reveal
                      by contradiction /* from formulas */
                    qed
                  next
                    case ephemeral_keygen
                    solve( !KU( ~s ) @ #vk.19 )
                      case static_reveal
                      by contradiction /* from formulas */
                    qed
                  next
                    case static_keygen
                    solve( !KU( ~e0 ) @ #vk.19 )
                      case ephemeral_reveal
                      by contradiction /* from formulas */
                    qed
                  qed
                qed
              qed
            qed
          qed
        qed
      next
        case split_case_05
        by solve( Receivable( <'g'^inv((~s*x)), 
                               aead(kdf2(<
                                          kdf1(<
                                                kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 'g'^inv((~s*x))
                                                     >), 
                                                'g'^(~e*inv((~s*x)))>), 
                                          'g'^inv(x)>),
                                    '0',
                                    h(<
                                       h(<
                                          h(<
                                             h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                     h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                               >), 
                                             kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                          aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                               h(<
                                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                    >), 
                                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                               $msg.3)
                                         >), 
                                       'g'^inv((~s*x))>),
                                    msg.2)
                              >
                  ) ▶₀ #vr.5 )
      next
        case split_case_06
        by solve( Receivable( <'g'^(x*inv(~s)), 
                               aead(kdf2(<
                                          kdf1(<
                                                kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 'g'^(x*inv(~s))
                                                     >), 
                                                'g'^(~e*x*inv(~s))>), 
                                          'g'^x>),
                                    '0',
                                    h(<
                                       h(<
                                          h(<
                                             h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                     h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                               >), 
                                             kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                          aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                               h(<
                                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                    >), 
                                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                               $msg.3)
                                         >), 
                                       'g'^(x*inv(~s))>),
                                    msg.2)
                              >
                  ) ▶₀ #vr.5 )
      next
        case split_case_07
        by solve( Receivable( <'g'^inv((~e*~s*x)), 
                               aead(kdf2(<
                                          kdf1(<
                                                kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 
                                                      'g'^inv((~e*~s*x))>), 
                                                'g'^inv((~s*x))>), 
                                          'g'^inv((~e*x))>),
                                    '0',
                                    h(<
                                       h(<
                                          h(<
                                             h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                     h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                               >), 
                                             kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                          aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                               h(<
                                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                    >), 
                                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                               $msg.3)
                                         >), 
                                       'g'^inv((~e*~s*x))>),
                                    msg.2)
                              >
                  ) ▶₀ #vr.5 )
      next
        case split_case_08
        by solve( Receivable( <'g'^inv((~e*x)), 
                               aead(kdf2(<
                                          kdf1(<
                                                kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 'g'^inv((~e*x))
                                                     >), 
                                                'g'^inv(x)>), 
                                          'g'^(~s*inv((~e*x)))>),
                                    '0',
                                    h(<
                                       h(<
                                          h(<
                                             h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                     h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                               >), 
                                             kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                          aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                               h(<
                                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                    >), 
                                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                               $msg.3)
                                         >), 
                                       'g'^inv((~e*x))>),
                                    msg.2)
                              >
                  ) ▶₀ #vr.5 )
      next
        case split_case_09
        by solve( Receivable( <'g'^(x*inv((~s*x.1))), 
                               aead(kdf2(<
                                          kdf1(<
                                                kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 
                                                      'g'^(x*inv((~s*x.1)))>), 
                                                'g'^(~e*x*inv((~s*x.1)))>), 
                                          'g'^(x*inv(x.1))>),
                                    '0',
                                    h(<
                                       h(<
                                          h(<
                                             h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                     h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                               >), 
                                             kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                          aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                               h(<
                                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                    >), 
                                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                               $msg.3)
                                         >), 
                                       'g'^(x*inv((~s*x.1)))>),
                                    msg.2)
                              >
                  ) ▶₀ #vr.5 )
      next
        case split_case_10
        by solve( Receivable( <'g'^(x*inv(~e)), 
                               aead(kdf2(<
                                          kdf1(<
                                                kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 'g'^(x*inv(~e))
                                                     >), 
                                                'g'^x>), 
                                          'g'^(~s*x*inv(~e))>),
                                    '0',
                                    h(<
                                       h(<
                                          h(<
                                             h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                     h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                               >), 
                                             kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                          aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                               h(<
                                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                    >), 
                                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                               $msg.3)
                                         >), 
                                       'g'^(x*inv(~e))>),
                                    msg.2)
                              >
                  ) ▶₀ #vr.5 )
      next
        case split_case_11
        by solve( Receivable( <'g'^(x*inv((~e*~s))), 
                               aead(kdf2(<
                                          kdf1(<
                                                kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 
                                                      'g'^(x*inv((~e*~s)))>), 
                                                'g'^(x*inv(~s))>), 
                                          'g'^(x*inv(~e))>),
                                    '0',
                                    h(<
                                       h(<
                                          h(<
                                             h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                     h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                               >), 
                                             kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                          aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                               h(<
                                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                    >), 
                                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                               $msg.3)
                                         >), 
                                       'g'^(x*inv((~e*~s)))>),
                                    msg.2)
                              >
                  ) ▶₀ #vr.5 )
      next
        case split_case_12
        by solve( Receivable( <'g'^(x*inv((~e*~s*x.1))), 
                               aead(kdf2(<
                                          kdf1(<
                                                kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 
                                                      'g'^(x*inv((~e*~s*x.1)))>), 
                                                'g'^(x*inv((~s*x.1)))>), 
                                          'g'^(x*inv((~e*x.1)))>),
                                    '0',
                                    h(<
                                       h(<
                                          h(<
                                             h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                     h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                               >), 
                                             kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                          aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                               h(<
                                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                    >), 
                                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                               $msg.3)
                                         >), 
                                       'g'^(x*inv((~e*~s*x.1)))>),
                                    msg.2)
                              >
                  ) ▶₀ #vr.5 )
      next
        case split_case_13
        by solve( Receivable( <'g'^(x*inv((~e*x.1))), 
                               aead(kdf2(<
                                          kdf1(<
                                                kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 
                                                      'g'^(x*inv((~e*x.1)))>), 
                                                'g'^(x*inv(x.1))>), 
                                          'g'^(~s*x*inv((~e*x.1)))>),
                                    '0',
                                    h(<
                                       h(<
                                          h(<
                                             h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                     h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                               >), 
                                             kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                          aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                               h(<
                                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                    >), 
                                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                               $msg.3)
                                         >), 
                                       'g'^(x*inv((~e*x.1)))>),
                                    msg.2)
                              >
                  ) ▶₀ #vr.5 )
      qed
    qed
  qed
qed

rule (modulo E) Instrumentation_Initiator_4:
   [ St_Initiator_3( ~id, e, me, re, psk ), I_Recv( ~id, '1', msg ) ]
  --[ Secret_INpsk1_4_Initiator( e, me, re, psk, msg ), Finish( ) ]->
   [ St_Initiator_4( ~id, e, me, re, psk ) ]

  /* has exactly the trivial AC variant */

rule (modulo E) Create_Responder:
   [ Fr( ~id ), !Pk( ~ltk, me ), !Psk( psk ) ]
  --[ Create_Responder( ) ]->
   [
   St_Responder_0( ~id, psk ),
   Init_Handshake_Responder( ~id, 'prologue', psk )
   ]

  /* has exactly the trivial AC variant */

rule (modulo E) Instrumentation_Responder_1:
   [ St_Responder_0( ~id, psk ), Handshake_Recv_1( ~id, msg ) ]
  -->
   [ St_Responder_1( ~id, psk ) ]

  /* has exactly the trivial AC variant */

rule (modulo E) Instrumentation_Responder_2:
   [
   St_Responder_1( ~id, psk ), PeerEk_Responder( ~id, re ),
   PeerLtk_Responder( ~id, peer )
   ]
  -->
   [ St_Responder_2( ~id, re, peer, psk ), Handshake_Snd_2( ~id, $msg ) ]

  /* has exactly the trivial AC variant */

rule (modulo E) Instrumentation_Responder_3:
   [
   St_Responder_2( ~id, re, peer, psk ), MyEk_Responder( ~id, e ),
   R_Recv( ~id, '0', msg )
   ]
  -->
   [ St_Responder_3( ~id, e, re, peer, psk ) ]

  /* has exactly the trivial AC variant */

lemma Secrecy_INpsk1_4_for_Responder_unless_active_or_reveal_psk_AnyTime_end:
  all-traces
  "∀ msg e re peer psk #claim.
    (Secret_INpsk1_4_Responder( e, re, peer, psk, msg ) @ #claim) ⇒
    ((¬(∃ #attack. K( msg ) @ #attack)) ∨
     (∃ #reveal. RevealPsk( psk ) @ #reveal))"
/*
guarded formula characterizing all counter-examples:
"∃ msg e re peer psk #claim.
  (Secret_INpsk1_4_Responder( e, re, peer, psk, msg ) @ #claim)
 ∧
  (∃ #attack. (K( msg ) @ #attack)) ∧
  (∀ #reveal. (RevealPsk( psk ) @ #reveal) ⇒ ⊥)"
*/
simplify
solve( St_Responder_3( ~id, e, re, peer, psk ) ▶₀ #claim )
  case Instrumentation_Responder_3
  solve( !KU( ~n ) @ #vk )
    case channel_send
    solve( !KU( ~psk ) @ #vk.15 )
      case psk_reveal
      by contradiction /* from formulas */
    qed
  qed
qed

lemma Secrecy_INpsk1_4_for_Responder_unless_active_or_reveal_rs_AnyTime_or_reveal_psk_AnyTime_end:
  all-traces
  "∀ msg e re peer psk #claim.
    (Secret_INpsk1_4_Responder( e, re, peer, psk, msg ) @ #claim) ⇒
    ((¬(∃ #attack. K( msg ) @ #attack)) ∨
     ((∃ #reveal. RevealLtk( peer ) @ #reveal) ∨
      (∃ #reveal. RevealPsk( psk ) @ #reveal)))"
/*
guarded formula characterizing all counter-examples:
"∃ msg e re peer psk #claim.
  (Secret_INpsk1_4_Responder( e, re, peer, psk, msg ) @ #claim)
 ∧
  (∃ #attack. (K( msg ) @ #attack)) ∧
  (∀ #reveal. (RevealLtk( peer ) @ #reveal) ⇒ ⊥) ∧
  (∀ #reveal. (RevealPsk( psk ) @ #reveal) ⇒ ⊥)"
*/
simplify
solve( St_Responder_3( ~id, e, re, peer, psk ) ▶₀ #claim )
  case Instrumentation_Responder_3
  solve( !KU( ~n ) @ #vk )
    case channel_send
    solve( !KU( ~psk ) @ #vk.15 )
      case psk_reveal
      by contradiction /* from formulas */
    qed
  qed
qed

lemma Secrecy_INpsk1_4_for_Responder_unless_active_or_reveal_re_AnyTime_or_reveal_psk_AnyTime_end:
  all-traces
  "∀ msg e re peer psk #claim.
    (Secret_INpsk1_4_Responder( e, re, peer, psk, msg ) @ #claim) ⇒
    ((¬(∃ #attack. K( msg ) @ #attack)) ∨
     ((∃ #reveal. RevealEk( re ) @ #reveal) ∨
      (∃ #reveal. RevealPsk( psk ) @ #reveal)))"
/*
guarded formula characterizing all counter-examples:
"∃ msg e re peer psk #claim.
  (Secret_INpsk1_4_Responder( e, re, peer, psk, msg ) @ #claim)
 ∧
  (∃ #attack. (K( msg ) @ #attack)) ∧
  (∀ #reveal. (RevealEk( re ) @ #reveal) ⇒ ⊥) ∧
  (∀ #reveal. (RevealPsk( psk ) @ #reveal) ⇒ ⊥)"
*/
simplify
solve( St_Responder_3( ~id, e, re, peer, psk ) ▶₀ #claim )
  case Instrumentation_Responder_3
  solve( !KU( ~n ) @ #vk )
    case channel_send
    solve( !KU( ~psk ) @ #vk.15 )
      case psk_reveal
      by contradiction /* from formulas */
    qed
  qed
qed

lemma Secrecy_INpsk1_4_for_Responder_unless_active_or_reveal_re_AnyTime_or_reveal_rs_AnyTime_or_reveal_psk_AnyTime_end:
  all-traces
  "∀ msg e re peer psk #claim.
    (Secret_INpsk1_4_Responder( e, re, peer, psk, msg ) @ #claim) ⇒
    ((¬(∃ #attack. K( msg ) @ #attack)) ∨
     (((∃ #reveal. RevealEk( re ) @ #reveal) ∨
       (∃ #reveal. RevealLtk( peer ) @ #reveal)) ∨
      (∃ #reveal. RevealPsk( psk ) @ #reveal)))"
/*
guarded formula characterizing all counter-examples:
"∃ msg e re peer psk #claim.
  (Secret_INpsk1_4_Responder( e, re, peer, psk, msg ) @ #claim)
 ∧
  (∃ #attack. (K( msg ) @ #attack)) ∧
  (∀ #reveal. (RevealEk( re ) @ #reveal) ⇒ ⊥) ∧
  (∀ #reveal. (RevealLtk( peer ) @ #reveal) ⇒ ⊥) ∧
  (∀ #reveal. (RevealPsk( psk ) @ #reveal) ⇒ ⊥)"
*/
simplify
solve( St_Responder_3( ~id, e, re, peer, psk ) ▶₀ #claim )
  case Instrumentation_Responder_3
  solve( !KU( ~n ) @ #vk )
    case channel_send
    solve( !KU( ~psk ) @ #vk.15 )
      case psk_reveal
      by contradiction /* from formulas */
    qed
  qed
qed

lemma Secrecy_INpsk1_4_for_Responder_unless_active_or_reveal_e_AnyTime_or_reveal_rs_AnyTime_end:
  all-traces
  "∀ msg e re peer psk #claim.
    (Secret_INpsk1_4_Responder( e, re, peer, psk, msg ) @ #claim) ⇒
    ((¬(∃ #attack. K( msg ) @ #attack)) ∨
     ((∃ #reveal. RevealEk( e ) @ #reveal) ∨
      (∃ #reveal. RevealLtk( peer ) @ #reveal)))"
/*
guarded formula characterizing all counter-examples:
"∃ msg e re peer psk #claim.
  (Secret_INpsk1_4_Responder( e, re, peer, psk, msg ) @ #claim)
 ∧
  (∃ #attack. (K( msg ) @ #attack)) ∧
  (∀ #reveal. (RevealEk( e ) @ #reveal) ⇒ ⊥) ∧
  (∀ #reveal. (RevealLtk( peer ) @ #reveal) ⇒ ⊥)"
*/
simplify
solve( St_Responder_3( ~id, e, re, peer, psk ) ▶₀ #claim )
  case Instrumentation_Responder_3
  solve( !KU( ~n ) @ #vk )
    case channel_send
    solve( !KU( ~psk ) @ #vk.15 )
      case psk_reveal
      solve( splitEqs(1) )
        case split_case_1
        by solve( Receivable( <'0', 
                               aead(kdf1(kdf1(<
                                               kdf1(<kdf1(<kdf2(<kdf1(<'INpsk1', 'g'>), ~psk>), 'g'^~e0>), 
                                                     'g'^~e0>), 
                                               'g'^~e0>)),
                                    '0', '0', msg)
                              >
                  ) ▶₀ #vr.7 )
      next
        case split_case_2
        solve( splitEqs(4) )
          case split_case_1
          solve( !KU( kdf1(<'INpsk1', 'g'^inv(~e0)>) ) @ #vk.14 )
            case c_kdf1
            solve( !KU( 'g'^inv(~e0) ) @ #vk.17 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        next
          case split_case_2
          solve( !KU( 'g'^(~e0*re0) ) @ #vk.13 )
            case c_exp
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_1
            solve( !KU( ~e0 ) @ #vk.15 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_2
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_3
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_4
            solve( !KU( ~e0 ) @ #vk.21 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_5
            solve( !KU( ~e0 ) @ #vk.15 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_6
            by solve( Receivable( <'0', 
                                   aead(kdf1(kdf1(<
                                                   kdf1(<
                                                         kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^re0>), ~psk>), 
                                                               'g'^~e0>), 
                                                         'g'^(~e0*re0)>), 
                                                   'g'^~e0>)),
                                        '0', '0', msg)
                                  >
                      ) ▶₀ #vr.7 )
          next
            case channel_send_case_7
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case ephemeral_keygen_case_1
            solve( !KU( ~e0 ) @ #vk.15 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case ephemeral_keygen_case_2
            by solve( Receivable( <'0', 
                                   aead(kdf1(kdf1(<
                                                   kdf1(<
                                                         kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^re0>), ~psk>), 
                                                               'g'^~e0>), 
                                                         'g'^(~e0*re0)>), 
                                                   'g'^~e0>)),
                                        '0', '0', msg)
                                  >
                      ) ▶₀ #vr.7 )
          next
            case ephemeral_keygen_case_3
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case static_keygen_case_1
            solve( !KU( ~e0 ) @ #vk.15 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case static_keygen_case_2
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          qed
        next
          case split_case_3
          solve( !KU( kdf1(<'INpsk1', 'g'^inv((~e0*x))>) ) @ #vk.14 )
            case c_kdf1
            solve( !KU( 'g'^inv((~e0*x)) ) @ #vk.17 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        next
          case split_case_4
          solve( !KU( kdf1(<'INpsk1', 'g'^(x*inv(~e0))>) ) @ #vk.14 )
            case c_kdf1
            solve( !KU( 'g'^(x*inv(~e0)) ) @ #vk.17 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_1
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_2
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_3
              solve( !KU( ~e0 ) @ #vk.23 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_4
              solve( !KU( ~e0 ) @ #vk.25 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_5
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_6
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        next
          case split_case_5
          solve( !KU( kdf1(<'INpsk1', 'g'^(x*inv((~e0*x.1)))>) ) @ #vk.14 )
            case c_kdf1
            solve( !KU( 'g'^(x*inv((~e0*x.1))) ) @ #vk.17 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.23 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_1
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_2
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_3
              solve( !KU( ~e0 ) @ #vk.24 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_4
              solve( !KU( ~e0 ) @ #vk.26 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_5
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_6
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        qed
      next
        case split_case_3
        solve( splitEqs(4) )
          case split_case_1
          by solve( Receivable( <'0', 
                                 aead(kdf1(kdf1(<
                                                 kdf1(<kdf1(<kdf2(<kdf1(<'INpsk1', 'g'>), ~psk>), 'g'^~e0>), 
                                                       'g'^~e0>), 
                                                 'g'>)),
                                      '0', '0', msg)
                                >
                    ) ▶₀ #vr.7 )
        next
          case split_case_2
          solve( !KU( 'g'^(~e0*rs4) ) @ #vk.12 )
            case c_exp
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_1
            solve( !KU( ~e0 ) @ #vk.15 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_2
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_3
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_4
            solve( !KU( ~e0 ) @ #vk.21 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_5
            solve( !KU( ~e0 ) @ #vk.15 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_6
            by solve( Receivable( <'0', 
                                   aead(kdf1(kdf1(<
                                                   kdf1(<
                                                         kdf1(<kdf2(<kdf1(<'INpsk1', 'g'>), ~psk>), 'g'^~e0
                                                              >), 
                                                         'g'^~e0>), 
                                                   'g'^(~e0*rs4)>)),
                                        '0', '0', msg)
                                  >
                      ) ▶₀ #vr.7 )
          next
            case channel_send_case_7
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case ephemeral_keygen_case_1
            solve( !KU( ~e0 ) @ #vk.15 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case ephemeral_keygen_case_2
            by solve( Receivable( <'0', 
                                   aead(kdf1(kdf1(<
                                                   kdf1(<
                                                         kdf1(<kdf2(<kdf1(<'INpsk1', 'g'>), ~psk>), 'g'^~e0
                                                              >), 
                                                         'g'^~e0>), 
                                                   'g'^(~e0*rs4)>)),
                                        '0', '0', msg)
                                  >
                      ) ▶₀ #vr.7 )
          next
            case ephemeral_keygen_case_3
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case static_keygen_case_1
            solve( !KU( ~e0 ) @ #vk.15 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case static_keygen_case_2
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          qed
        next
          case split_case_3
          by solve( Receivable( <'0', 
                                 aead(kdf1(kdf1(<
                                                 kdf1(<kdf1(<kdf2(<kdf1(<'INpsk1', 'g'>), ~psk>), 'g'^~e0>), 
                                                       'g'^~e0>), 
                                                 'g'^inv(x)>)),
                                      '0', '0', msg)
                                >
                    ) ▶₀ #vr.7 )
        next
          case split_case_4
          by solve( Receivable( <'0', 
                                 aead(kdf1(kdf1(<
                                                 kdf1(<kdf1(<kdf2(<kdf1(<'INpsk1', 'g'>), ~psk>), 'g'^~e0>), 
                                                       'g'^~e0>), 
                                                 'g'^x>)),
                                      '0', '0', msg)
                                >
                    ) ▶₀ #vr.7 )
        next
          case split_case_5
          by solve( Receivable( <'0', 
                                 aead(kdf1(kdf1(<
                                                 kdf1(<kdf1(<kdf2(<kdf1(<'INpsk1', 'g'>), ~psk>), 'g'^~e0>), 
                                                       'g'^~e0>), 
                                                 'g'^(x*inv(x.1))>)),
                                      '0', '0', msg)
                                >
                    ) ▶₀ #vr.7 )
        qed
      next
        case split_case_4
        solve( splitEqs(4) )
          case split_case_01
          solve( !KU( kdf1(<'INpsk1', 'g'^inv(~e0)>) ) @ #vk.14 )
            case c_kdf1
            solve( !KU( 'g'^inv(~e0) ) @ #vk.17 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        next
          case split_case_02
          solve( !KU( kdf1(<'INpsk1', 'g'^inv(~e0)>) ) @ #vk.15 )
            case c_kdf1
            solve( !KU( 'g'^(~e0*rs4) ) @ #vk.13 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_1
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_2
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_3
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_4
              solve( !KU( ~e0 ) @ #vk.24 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_5
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_6
              solve( !KU( 'g'^inv(~e0) ) @ #vk.18 )
                case c_exp
                solve( !KU( ~e0 ) @ #vk.21 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              qed
            next
              case channel_send_case_7
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_2
              solve( !KU( 'g'^inv(~e0) ) @ #vk.18 )
                case c_exp
                solve( !KU( ~e0 ) @ #vk.21 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              qed
            next
              case ephemeral_keygen_case_3
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        next
          case split_case_03
          solve( !KU( 'g'^(~e0*rs4) ) @ #vk.12 )
            case c_exp
            solve( !KU( ~e0 ) @ #vk.18 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_1
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_2
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_3
            solve( !KU( ~e0 ) @ #vk.18 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_4
            solve( !KU( ~e0 ) @ #vk.22 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_5
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_6
            solve( !KU( 'g'^(~e0*re0) ) @ #vk.13 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_1
              solve( !KU( ~e0 ) @ #vk.17 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_2
              solve( !KU( ~e0 ) @ #vk.18 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_3
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_4
              solve( !KU( ~e0 ) @ #vk.23 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_5
              solve( !KU( ~e0 ) @ #vk.17 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_6
              solve( Receivable( <'0', 
                                  aead(kdf1(kdf1(<
                                                  kdf1(<
                                                        kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^re0>), ~psk>), 'g'^~e0
                                                             >), 
                                                        'g'^(~e0*re0)>), 
                                                  'g'^(~e0*rs4)>)),
                                       '0', '0', msg)
                                 >
                     ) ▶₀ #vr.7 )
                case channel_send
                solve( !KU( ~rs4 ) @ #vk.16 )
                  case static_reveal
                  by contradiction /* from formulas */
                qed
              qed
            next
              case channel_send_case_7
              solve( !KU( ~e0 ) @ #vk.18 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.17 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.18 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.17 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.18 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          next
            case channel_send_case_7
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case ephemeral_keygen_case_1
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case ephemeral_keygen_case_2
            solve( !KU( 'g'^(~e0*re0) ) @ #vk.13 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_1
              solve( !KU( ~e0 ) @ #vk.17 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_2
              solve( !KU( ~e0 ) @ #vk.18 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_3
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_4
              solve( !KU( ~e0 ) @ #vk.23 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_5
              solve( !KU( ~e0 ) @ #vk.17 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_6
              solve( !KU( ~e0 ) @ #vk.18 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.17 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_2
              solve( Receivable( <'0', 
                                  aead(kdf1(kdf1(<
                                                  kdf1(<
                                                        kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^re0>), ~psk>), 'g'^~e0
                                                             >), 
                                                        'g'^(~e0*re0)>), 
                                                  'g'^(~e0*rs4)>)),
                                       '0', '0', msg)
                                 >
                     ) ▶₀ #vr.7 )
                case channel_send
                solve( !KU( ~rs4 ) @ #vk.16 )
                  case static_reveal
                  by contradiction /* from formulas */
                qed
              qed
            next
              case ephemeral_keygen_case_3
              solve( !KU( ~e0 ) @ #vk.18 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.17 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.18 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          next
            case ephemeral_keygen_case_3
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case static_keygen_case_1
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case static_keygen_case_2
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          qed
        next
          case split_case_04
          solve( !KU( 'g'^(~e0*re0) ) @ #vk.13 )
            case c_exp
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_1
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_2
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_3
            solve( !KU( ~e0 ) @ #vk.18 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_4
            solve( !KU( ~e0 ) @ #vk.22 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_5
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_6
            by solve( Receivable( <'0', 
                                   aead(kdf1(kdf1(<
                                                   kdf1(<
                                                         kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^re0>), ~psk>), 
                                                               'g'^~e0>), 
                                                         'g'^(~e0*re0)>), 
                                                   'g'>)),
                                        '0', '0', msg)
                                  >
                      ) ▶₀ #vr.7 )
          next
            case channel_send_case_7
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case ephemeral_keygen_case_1
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case ephemeral_keygen_case_2
            by solve( Receivable( <'0', 
                                   aead(kdf1(kdf1(<
                                                   kdf1(<
                                                         kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^re0>), ~psk>), 
                                                               'g'^~e0>), 
                                                         'g'^(~e0*re0)>), 
                                                   'g'>)),
                                        '0', '0', msg)
                                  >
                      ) ▶₀ #vr.7 )
          next
            case ephemeral_keygen_case_3
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case static_keygen_case_1
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case static_keygen_case_2
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          qed
        next
          case split_case_05
          solve( !KU( kdf1(<'INpsk1', 'g'^inv(~e0)>) ) @ #vk.15 )
            case c_kdf1
            solve( !KU( 'g'^inv(~e0) ) @ #vk.18 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        next
          case split_case_06
          solve( !KU( kdf1(<'INpsk1', 'g'^inv(~e0)>) ) @ #vk.15 )
            case c_kdf1
            solve( !KU( 'g'^inv(~e0) ) @ #vk.18 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        next
          case split_case_07
          solve( !KU( kdf1(<'INpsk1', 'g'^inv((~e0*x))>) ) @ #vk.15 )
            case c_kdf1
            solve( !KU( 'g'^(~e0*rs4) ) @ #vk.13 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_1
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_2
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_3
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_4
              solve( !KU( ~e0 ) @ #vk.24 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_5
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_6
              solve( !KU( 'g'^inv((~e0*x)) ) @ #vk.18 )
                case c_exp
                solve( !KU( ~e0 ) @ #vk.23 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              qed
            next
              case channel_send_case_7
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_2
              solve( !KU( 'g'^inv((~e0*x)) ) @ #vk.18 )
                case c_exp
                solve( !KU( ~e0 ) @ #vk.23 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              qed
            next
              case ephemeral_keygen_case_3
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        next
          case split_case_08
          solve( !KU( kdf1(<'INpsk1', 'g'^inv((~e0*x))>) ) @ #vk.15 )
            case c_kdf1
            solve( !KU( 'g'^inv((~e0*x)) ) @ #vk.18 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        next
          case split_case_09
          solve( !KU( kdf1(<'INpsk1', 'g'^(x*inv(~e0))>) ) @ #vk.15 )
            case c_kdf1
            solve( !KU( 'g'^(~e0*rs4) ) @ #vk.13 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_1
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_2
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_3
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_4
              solve( !KU( ~e0 ) @ #vk.24 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_5
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_6
              solve( !KU( 'g'^(x*inv(~e0)) ) @ #vk.18 )
                case c_exp
                solve( !KU( ~e0 ) @ #vk.24 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case channel_send_case_1
                solve( !KU( ~e0 ) @ #vk.21 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case channel_send_case_2
                solve( !KU( ~e0 ) @ #vk.23 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case channel_send_case_3
                solve( !KU( ~e0 ) @ #vk.25 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case channel_send_case_4
                solve( !KU( ~e0 ) @ #vk.27 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case channel_send_case_5
                solve( !KU( ~e0 ) @ #vk.21 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case channel_send_case_6
                solve( !KU( ~e0 ) @ #vk.23 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case ephemeral_keygen_case_1
                solve( !KU( ~e0 ) @ #vk.21 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case ephemeral_keygen_case_2
                solve( !KU( ~e0 ) @ #vk.23 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case static_keygen_case_1
                solve( !KU( ~e0 ) @ #vk.21 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case static_keygen_case_2
                solve( !KU( ~e0 ) @ #vk.23 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              qed
            next
              case channel_send_case_7
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_2
              solve( !KU( 'g'^(x*inv(~e0)) ) @ #vk.18 )
                case c_exp
                solve( !KU( ~e0 ) @ #vk.24 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case channel_send_case_1
                solve( !KU( ~e0 ) @ #vk.21 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case channel_send_case_2
                solve( !KU( ~e0 ) @ #vk.23 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case channel_send_case_3
                solve( !KU( ~e0 ) @ #vk.25 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case channel_send_case_4
                solve( !KU( ~e0 ) @ #vk.27 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case channel_send_case_5
                solve( !KU( ~e0 ) @ #vk.21 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case channel_send_case_6
                solve( !KU( ~e0 ) @ #vk.23 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case ephemeral_keygen_case_1
                solve( !KU( ~e0 ) @ #vk.21 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case ephemeral_keygen_case_2
                solve( !KU( ~e0 ) @ #vk.23 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case static_keygen_case_1
                solve( !KU( ~e0 ) @ #vk.21 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case static_keygen_case_2
                solve( !KU( ~e0 ) @ #vk.23 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              qed
            next
              case ephemeral_keygen_case_3
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        next
          case split_case_10
          solve( !KU( kdf1(<'INpsk1', 'g'^(x*inv(~e0))>) ) @ #vk.15 )
            case c_kdf1
            solve( !KU( 'g'^(x*inv(~e0)) ) @ #vk.18 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_1
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_2
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_3
              solve( !KU( ~e0 ) @ #vk.24 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_4
              solve( !KU( ~e0 ) @ #vk.26 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_5
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_6
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        next
          case split_case_11
          solve( !KU( 'g'^(~e0*re0) ) @ #vk.13 )
            case c_exp
            solve( !KU( ~e0 ) @ #vk.18 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_1
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_2
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_3
            solve( !KU( ~e0 ) @ #vk.18 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_4
            solve( !KU( ~e0 ) @ #vk.22 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_5
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_6
            by solve( Receivable( <'0', 
                                   aead(kdf1(kdf1(<
                                                   kdf1(<
                                                         kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^re0>), ~psk>), 
                                                               'g'^~e0>), 
                                                         'g'^(~e0*re0)>), 
                                                   'g'^inv(x)>)),
                                        '0', '0', msg)
                                  >
                      ) ▶₀ #vr.7 )
          next
            case channel_send_case_7
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case ephemeral_keygen_case_1
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case ephemeral_keygen_case_2
            by solve( Receivable( <'0', 
                                   aead(kdf1(kdf1(<
                                                   kdf1(<
                                                         kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^re0>), ~psk>), 
                                                               'g'^~e0>), 
                                                         'g'^(~e0*re0)>), 
                                                   'g'^inv(x)>)),
                                        '0', '0', msg)
                                  >
                      ) ▶₀ #vr.7 )
          next
            case ephemeral_keygen_case_3
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case static_keygen_case_1
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case static_keygen_case_2
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          qed
        next
          case split_case_12
          solve( !KU( 'g'^(~e0*re0) ) @ #vk.13 )
            case c_exp
            solve( !KU( ~e0 ) @ #vk.18 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_1
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_2
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_3
            solve( !KU( ~e0 ) @ #vk.18 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_4
            solve( !KU( ~e0 ) @ #vk.22 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_5
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_6
            solve( Receivable( <'0', 
                                aead(kdf1(kdf1(<
                                                kdf1(<
                                                      kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^re0>), ~psk>), 'g'^~e0
                                                           >), 
                                                      'g'^(~e0*re0)>), 
                                                'g'^x>)),
                                     '0', '0', msg)
                               >
                   ) ▶₀ #vr.7 )
              case channel_send
              by contradiction /* non-normal terms */
            qed
          next
            case channel_send_case_7
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case ephemeral_keygen_case_1
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case ephemeral_keygen_case_2
            solve( Receivable( <'0', 
                                aead(kdf1(kdf1(<
                                                kdf1(<
                                                      kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^re0>), ~psk>), 'g'^~e0
                                                           >), 
                                                      'g'^(~e0*re0)>), 
                                                'g'^x>)),
                                     '0', '0', msg)
                               >
                   ) ▶₀ #vr.7 )
              case channel_send
              by contradiction /* non-normal terms */
            qed
          next
            case ephemeral_keygen_case_3
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case static_keygen_case_1
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case static_keygen_case_2
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          qed
        next
          case split_case_13
          solve( !KU( kdf1(<'INpsk1', 'g'^inv(~e0)>) ) @ #vk.15 )
            case c_kdf1
            solve( !KU( 'g'^inv(~e0) ) @ #vk.18 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        next
          case split_case_14
          solve( !KU( kdf1(<'INpsk1', 'g'^inv((~e0*x))>) ) @ #vk.15 )
            case c_kdf1
            solve( !KU( 'g'^inv((~e0*x)) ) @ #vk.18 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        next
          case split_case_15
          solve( !KU( kdf1(<'INpsk1', 'g'^inv((~e0*x))>) ) @ #vk.15 )
            case c_kdf1
            solve( !KU( 'g'^inv((~e0*x)) ) @ #vk.18 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        next
          case split_case_16
          solve( !KU( kdf1(<'INpsk1', 'g'^(x*inv(~e0))>) ) @ #vk.15 )
            case c_kdf1
            solve( !KU( 'g'^(x*inv(~e0)) ) @ #vk.18 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.23 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_1
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_2
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_3
              solve( !KU( ~e0 ) @ #vk.24 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_4
              solve( !KU( ~e0 ) @ #vk.26 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_5
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_6
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        next
          case split_case_17
          solve( !KU( kdf1(<'INpsk1', 'g'^(x*inv(~e0))>) ) @ #vk.15 )
            case c_kdf1
            solve( !KU( 'g'^(x*inv(~e0)) ) @ #vk.18 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.23 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_1
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_2
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_3
              solve( !KU( ~e0 ) @ #vk.24 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_4
              solve( !KU( ~e0 ) @ #vk.26 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_5
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_6
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        next
          case split_case_18
          solve( !KU( kdf1(<'INpsk1', 'g'^(x*inv((~e0*x.1)))>) ) @ #vk.15 )
            case c_kdf1
            solve( !KU( 'g'^(~e0*rs4) ) @ #vk.13 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_1
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_2
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_3
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_4
              solve( !KU( ~e0 ) @ #vk.24 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_5
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_6
              solve( !KU( 'g'^(x*inv((~e0*x.1))) ) @ #vk.18 )
                case c_exp
                solve( !KU( ~e0 ) @ #vk.25 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case channel_send_case_1
                solve( !KU( ~e0 ) @ #vk.22 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case channel_send_case_2
                solve( !KU( ~e0 ) @ #vk.24 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case channel_send_case_3
                solve( !KU( ~e0 ) @ #vk.26 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case channel_send_case_4
                solve( !KU( ~e0 ) @ #vk.28 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case channel_send_case_5
                solve( !KU( ~e0 ) @ #vk.22 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case channel_send_case_6
                solve( !KU( ~e0 ) @ #vk.24 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case ephemeral_keygen_case_1
                solve( !KU( ~e0 ) @ #vk.22 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case ephemeral_keygen_case_2
                solve( !KU( ~e0 ) @ #vk.24 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case static_keygen_case_1
                solve( !KU( ~e0 ) @ #vk.22 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case static_keygen_case_2
                solve( !KU( ~e0 ) @ #vk.24 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              qed
            next
              case channel_send_case_7
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_2
              solve( !KU( 'g'^(x*inv((~e0*x.1))) ) @ #vk.18 )
                case c_exp
                solve( !KU( ~e0 ) @ #vk.25 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case channel_send_case_1
                solve( !KU( ~e0 ) @ #vk.22 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case channel_send_case_2
                solve( !KU( ~e0 ) @ #vk.24 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case channel_send_case_3
                solve( !KU( ~e0 ) @ #vk.26 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case channel_send_case_4
                solve( !KU( ~e0 ) @ #vk.28 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case channel_send_case_5
                solve( !KU( ~e0 ) @ #vk.22 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case channel_send_case_6
                solve( !KU( ~e0 ) @ #vk.24 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case ephemeral_keygen_case_1
                solve( !KU( ~e0 ) @ #vk.22 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case ephemeral_keygen_case_2
                solve( !KU( ~e0 ) @ #vk.24 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case static_keygen_case_1
                solve( !KU( ~e0 ) @ #vk.22 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case static_keygen_case_2
                solve( !KU( ~e0 ) @ #vk.24 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              qed
            next
              case ephemeral_keygen_case_3
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        next
          case split_case_19
          solve( !KU( kdf1(<'INpsk1', 'g'^(x*inv((~e0*x.1)))>) ) @ #vk.15 )
            case c_kdf1
            solve( !KU( 'g'^(x*inv((~e0*x.1))) ) @ #vk.18 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.23 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_1
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_2
              solve( !KU( ~e0 ) @ #vk.23 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_3
              solve( !KU( ~e0 ) @ #vk.25 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_4
              solve( !KU( ~e0 ) @ #vk.27 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_5
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_6
              solve( !KU( ~e0 ) @ #vk.23 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.23 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.23 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        next
          case split_case_20
          solve( !KU( 'g'^(~e0*re0) ) @ #vk.13 )
            case c_exp
            solve( !KU( ~e0 ) @ #vk.18 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_1
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_2
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_3
            solve( !KU( ~e0 ) @ #vk.18 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_4
            solve( !KU( ~e0 ) @ #vk.22 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_5
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_6
            by solve( Receivable( <'0', 
                                   aead(kdf1(kdf1(<
                                                   kdf1(<
                                                         kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^re0>), ~psk>), 
                                                               'g'^~e0>), 
                                                         'g'^(~e0*re0)>), 
                                                   'g'^(x*inv(x.1))>)),
                                        '0', '0', msg)
                                  >
                      ) ▶₀ #vr.7 )
          next
            case channel_send_case_7
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case ephemeral_keygen_case_1
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case ephemeral_keygen_case_2
            by solve( Receivable( <'0', 
                                   aead(kdf1(kdf1(<
                                                   kdf1(<
                                                         kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^re0>), ~psk>), 
                                                               'g'^~e0>), 
                                                         'g'^(~e0*re0)>), 
                                                   'g'^(x*inv(x.1))>)),
                                        '0', '0', msg)
                                  >
                      ) ▶₀ #vr.7 )
          next
            case ephemeral_keygen_case_3
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case static_keygen_case_1
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case static_keygen_case_2
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          qed
        next
          case split_case_21
          solve( !KU( kdf1(<'INpsk1', 'g'^inv((~e0*x))>) ) @ #vk.15 )
            case c_kdf1
            solve( !KU( 'g'^inv((~e0*x)) ) @ #vk.18 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        next
          case split_case_22
          solve( !KU( kdf1(<'INpsk1', 'g'^(x*inv(~e0))>) ) @ #vk.15 )
            case c_kdf1
            solve( !KU( 'g'^(x*inv(~e0)) ) @ #vk.18 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.23 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_1
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_2
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_3
              solve( !KU( ~e0 ) @ #vk.24 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_4
              solve( !KU( ~e0 ) @ #vk.26 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_5
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_6
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        next
          case split_case_23
          solve( !KU( kdf1(<'INpsk1', 'g'^(x*inv((~e0*x.1)))>) ) @ #vk.15 )
            case c_kdf1
            solve( !KU( 'g'^(x*inv((~e0*x.1))) ) @ #vk.18 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.24 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_1
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_2
              solve( !KU( ~e0 ) @ #vk.23 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_3
              solve( !KU( ~e0 ) @ #vk.25 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_4
              solve( !KU( ~e0 ) @ #vk.27 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_5
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_6
              solve( !KU( ~e0 ) @ #vk.23 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.23 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.23 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        next
          case split_case_24
          solve( !KU( kdf1(<'INpsk1', 'g'^(x*inv((~e0*x.1)))>) ) @ #vk.15 )
            case c_kdf1
            solve( !KU( 'g'^(x*inv((~e0*x.1))) ) @ #vk.18 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.24 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_1
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_2
              solve( !KU( ~e0 ) @ #vk.23 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_3
              solve( !KU( ~e0 ) @ #vk.25 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_4
              solve( !KU( ~e0 ) @ #vk.27 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_5
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_6
              solve( !KU( ~e0 ) @ #vk.23 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.23 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.23 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        next
          case split_case_25
          solve( !KU( kdf1(<'INpsk1', 'g'^(x*inv((~e0*x.1)))>) ) @ #vk.15 )
            case c_kdf1
            solve( !KU( 'g'^(x*inv((~e0*x.1))) ) @ #vk.18 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.24 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_1
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_2
              solve( !KU( ~e0 ) @ #vk.23 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_3
              solve( !KU( ~e0 ) @ #vk.25 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_4
              solve( !KU( ~e0 ) @ #vk.27 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_5
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_6
              solve( !KU( ~e0 ) @ #vk.23 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.23 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.23 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        qed
      qed
    qed
  qed
qed

lemma Secrecy_INpsk1_4_for_Responder_unless_active_or_reveal_e_AnyTime_or_reveal_re_AnyTime_end:
  all-traces
  "∀ msg e re peer psk #claim.
    (Secret_INpsk1_4_Responder( e, re, peer, psk, msg ) @ #claim) ⇒
    ((¬(∃ #attack. K( msg ) @ #attack)) ∨
     ((∃ #reveal. RevealEk( e ) @ #reveal) ∨
      (∃ #reveal. RevealEk( re ) @ #reveal)))"
/*
guarded formula characterizing all counter-examples:
"∃ msg e re peer psk #claim.
  (Secret_INpsk1_4_Responder( e, re, peer, psk, msg ) @ #claim)
 ∧
  (∃ #attack. (K( msg ) @ #attack)) ∧
  (∀ #reveal. (RevealEk( e ) @ #reveal) ⇒ ⊥) ∧
  (∀ #reveal. (RevealEk( re ) @ #reveal) ⇒ ⊥)"
*/
simplify
solve( St_Responder_3( ~id, e, re, peer, psk ) ▶₀ #claim )
  case Instrumentation_Responder_3
  solve( !KU( ~n ) @ #vk )
    case channel_send
    solve( !KU( ~psk ) @ #vk.15 )
      case psk_reveal
      solve( splitEqs(1) )
        case split_case_1
        by solve( Receivable( <'0', 
                               aead(kdf1(kdf1(<
                                               kdf1(<kdf1(<kdf2(<kdf1(<'INpsk1', 'g'>), ~psk>), 'g'^~e0>), 
                                                     'g'^~e0>), 
                                               'g'^~e0>)),
                                    '0', '0', msg)
                              >
                  ) ▶₀ #vr.7 )
      next
        case split_case_2
        solve( splitEqs(4) )
          case split_case_1
          solve( !KU( kdf1(<'INpsk1', 'g'^inv(~e0)>) ) @ #vk.14 )
            case c_kdf1
            solve( !KU( 'g'^inv(~e0) ) @ #vk.17 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        next
          case split_case_2
          solve( !KU( 'g'^(~e0*re0) ) @ #vk.13 )
            case c_exp
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_1
            solve( !KU( ~e0 ) @ #vk.15 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_2
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_3
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_4
            solve( !KU( ~e0 ) @ #vk.21 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_5
            solve( !KU( ~e0 ) @ #vk.15 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_6
            by solve( Receivable( <'0', 
                                   aead(kdf1(kdf1(<
                                                   kdf1(<
                                                         kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^re0>), ~psk>), 
                                                               'g'^~e0>), 
                                                         'g'^(~e0*re0)>), 
                                                   'g'^~e0>)),
                                        '0', '0', msg)
                                  >
                      ) ▶₀ #vr.7 )
          next
            case channel_send_case_7
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case ephemeral_keygen_case_1
            solve( !KU( ~e0 ) @ #vk.15 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case ephemeral_keygen_case_2
            by solve( Receivable( <'0', 
                                   aead(kdf1(kdf1(<
                                                   kdf1(<
                                                         kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^re0>), ~psk>), 
                                                               'g'^~e0>), 
                                                         'g'^(~e0*re0)>), 
                                                   'g'^~e0>)),
                                        '0', '0', msg)
                                  >
                      ) ▶₀ #vr.7 )
          next
            case ephemeral_keygen_case_3
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case static_keygen_case_1
            solve( !KU( ~e0 ) @ #vk.15 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case static_keygen_case_2
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          qed
        next
          case split_case_3
          solve( !KU( kdf1(<'INpsk1', 'g'^inv((~e0*x))>) ) @ #vk.14 )
            case c_kdf1
            solve( !KU( 'g'^inv((~e0*x)) ) @ #vk.17 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        next
          case split_case_4
          solve( !KU( kdf1(<'INpsk1', 'g'^(x*inv(~e0))>) ) @ #vk.14 )
            case c_kdf1
            solve( !KU( 'g'^(x*inv(~e0)) ) @ #vk.17 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_1
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_2
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_3
              solve( !KU( ~e0 ) @ #vk.23 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_4
              solve( !KU( ~e0 ) @ #vk.25 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_5
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_6
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        next
          case split_case_5
          solve( !KU( kdf1(<'INpsk1', 'g'^(x*inv((~e0*x.1)))>) ) @ #vk.14 )
            case c_kdf1
            solve( !KU( 'g'^(x*inv((~e0*x.1))) ) @ #vk.17 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.23 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_1
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_2
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_3
              solve( !KU( ~e0 ) @ #vk.24 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_4
              solve( !KU( ~e0 ) @ #vk.26 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_5
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_6
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        qed
      next
        case split_case_3
        solve( splitEqs(4) )
          case split_case_1
          by solve( Receivable( <'0', 
                                 aead(kdf1(kdf1(<
                                                 kdf1(<kdf1(<kdf2(<kdf1(<'INpsk1', 'g'>), ~psk>), 'g'^~e0>), 
                                                       'g'^~e0>), 
                                                 'g'>)),
                                      '0', '0', msg)
                                >
                    ) ▶₀ #vr.7 )
        next
          case split_case_2
          solve( !KU( 'g'^(~e0*rs4) ) @ #vk.12 )
            case c_exp
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_1
            solve( !KU( ~e0 ) @ #vk.15 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_2
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_3
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_4
            solve( !KU( ~e0 ) @ #vk.21 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_5
            solve( !KU( ~e0 ) @ #vk.15 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_6
            by solve( Receivable( <'0', 
                                   aead(kdf1(kdf1(<
                                                   kdf1(<
                                                         kdf1(<kdf2(<kdf1(<'INpsk1', 'g'>), ~psk>), 'g'^~e0
                                                              >), 
                                                         'g'^~e0>), 
                                                   'g'^(~e0*rs4)>)),
                                        '0', '0', msg)
                                  >
                      ) ▶₀ #vr.7 )
          next
            case channel_send_case_7
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case ephemeral_keygen_case_1
            solve( !KU( ~e0 ) @ #vk.15 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case ephemeral_keygen_case_2
            by solve( Receivable( <'0', 
                                   aead(kdf1(kdf1(<
                                                   kdf1(<
                                                         kdf1(<kdf2(<kdf1(<'INpsk1', 'g'>), ~psk>), 'g'^~e0
                                                              >), 
                                                         'g'^~e0>), 
                                                   'g'^(~e0*rs4)>)),
                                        '0', '0', msg)
                                  >
                      ) ▶₀ #vr.7 )
          next
            case ephemeral_keygen_case_3
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case static_keygen_case_1
            solve( !KU( ~e0 ) @ #vk.15 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case static_keygen_case_2
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          qed
        next
          case split_case_3
          by solve( Receivable( <'0', 
                                 aead(kdf1(kdf1(<
                                                 kdf1(<kdf1(<kdf2(<kdf1(<'INpsk1', 'g'>), ~psk>), 'g'^~e0>), 
                                                       'g'^~e0>), 
                                                 'g'^inv(x)>)),
                                      '0', '0', msg)
                                >
                    ) ▶₀ #vr.7 )
        next
          case split_case_4
          by solve( Receivable( <'0', 
                                 aead(kdf1(kdf1(<
                                                 kdf1(<kdf1(<kdf2(<kdf1(<'INpsk1', 'g'>), ~psk>), 'g'^~e0>), 
                                                       'g'^~e0>), 
                                                 'g'^x>)),
                                      '0', '0', msg)
                                >
                    ) ▶₀ #vr.7 )
        next
          case split_case_5
          by solve( Receivable( <'0', 
                                 aead(kdf1(kdf1(<
                                                 kdf1(<kdf1(<kdf2(<kdf1(<'INpsk1', 'g'>), ~psk>), 'g'^~e0>), 
                                                       'g'^~e0>), 
                                                 'g'^(x*inv(x.1))>)),
                                      '0', '0', msg)
                                >
                    ) ▶₀ #vr.7 )
        qed
      next
        case split_case_4
        solve( splitEqs(4) )
          case split_case_01
          solve( !KU( kdf1(<'INpsk1', 'g'^inv(~e0)>) ) @ #vk.14 )
            case c_kdf1
            solve( !KU( 'g'^inv(~e0) ) @ #vk.17 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        next
          case split_case_02
          solve( !KU( kdf1(<'INpsk1', 'g'^inv(~e0)>) ) @ #vk.15 )
            case c_kdf1
            solve( !KU( 'g'^(~e0*rs4) ) @ #vk.13 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_1
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_2
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_3
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_4
              solve( !KU( ~e0 ) @ #vk.24 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_5
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_6
              solve( !KU( 'g'^inv(~e0) ) @ #vk.18 )
                case c_exp
                solve( !KU( ~e0 ) @ #vk.21 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              qed
            next
              case channel_send_case_7
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_2
              solve( !KU( 'g'^inv(~e0) ) @ #vk.18 )
                case c_exp
                solve( !KU( ~e0 ) @ #vk.21 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              qed
            next
              case ephemeral_keygen_case_3
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        next
          case split_case_03
          solve( !KU( 'g'^(~e0*rs4) ) @ #vk.12 )
            case c_exp
            solve( !KU( ~e0 ) @ #vk.18 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_1
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_2
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_3
            solve( !KU( ~e0 ) @ #vk.18 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_4
            solve( !KU( ~e0 ) @ #vk.22 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_5
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_6
            solve( !KU( 'g'^(~e0*re0) ) @ #vk.13 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_1
              solve( !KU( ~e0 ) @ #vk.17 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_2
              solve( !KU( ~e0 ) @ #vk.18 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_3
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_4
              solve( !KU( ~e0 ) @ #vk.23 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_5
              solve( !KU( ~e0 ) @ #vk.17 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_6
              solve( Receivable( <'0', 
                                  aead(kdf1(kdf1(<
                                                  kdf1(<
                                                        kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^re0>), ~psk>), 'g'^~e0
                                                             >), 
                                                        'g'^(~e0*re0)>), 
                                                  'g'^(~e0*rs4)>)),
                                       '0', '0', msg)
                                 >
                     ) ▶₀ #vr.7 )
                case channel_send
                solve( !KU( ~rs4 ) @ #vk.16 )
                  case static_reveal
                  solve( !KU( ~e ) @ #vk.17 )
                    case ephemeral_reveal
                    by contradiction /* from formulas */
                  qed
                qed
              qed
            next
              case channel_send_case_7
              solve( !KU( ~e0 ) @ #vk.18 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.17 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.18 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.17 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.18 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          next
            case channel_send_case_7
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case ephemeral_keygen_case_1
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case ephemeral_keygen_case_2
            solve( !KU( 'g'^(~e0*re0) ) @ #vk.13 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_1
              solve( !KU( ~e0 ) @ #vk.17 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_2
              solve( !KU( ~e0 ) @ #vk.18 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_3
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_4
              solve( !KU( ~e0 ) @ #vk.23 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_5
              solve( !KU( ~e0 ) @ #vk.17 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_6
              solve( !KU( ~e0 ) @ #vk.18 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.17 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_2
              solve( Receivable( <'0', 
                                  aead(kdf1(kdf1(<
                                                  kdf1(<
                                                        kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^re0>), ~psk>), 'g'^~e0
                                                             >), 
                                                        'g'^(~e0*re0)>), 
                                                  'g'^(~e0*rs4)>)),
                                       '0', '0', msg)
                                 >
                     ) ▶₀ #vr.7 )
                case channel_send
                solve( !KU( ~rs4 ) @ #vk.16 )
                  case static_reveal
                  solve( !KU( ~e ) @ #vk.17 )
                    case ephemeral_reveal
                    by contradiction /* from formulas */
                  qed
                qed
              qed
            next
              case ephemeral_keygen_case_3
              solve( !KU( ~e0 ) @ #vk.18 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.17 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.18 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          next
            case ephemeral_keygen_case_3
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case static_keygen_case_1
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case static_keygen_case_2
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          qed
        next
          case split_case_04
          solve( !KU( 'g'^(~e0*re0) ) @ #vk.13 )
            case c_exp
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_1
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_2
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_3
            solve( !KU( ~e0 ) @ #vk.18 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_4
            solve( !KU( ~e0 ) @ #vk.22 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_5
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_6
            by solve( Receivable( <'0', 
                                   aead(kdf1(kdf1(<
                                                   kdf1(<
                                                         kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^re0>), ~psk>), 
                                                               'g'^~e0>), 
                                                         'g'^(~e0*re0)>), 
                                                   'g'>)),
                                        '0', '0', msg)
                                  >
                      ) ▶₀ #vr.7 )
          next
            case channel_send_case_7
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case ephemeral_keygen_case_1
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case ephemeral_keygen_case_2
            by solve( Receivable( <'0', 
                                   aead(kdf1(kdf1(<
                                                   kdf1(<
                                                         kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^re0>), ~psk>), 
                                                               'g'^~e0>), 
                                                         'g'^(~e0*re0)>), 
                                                   'g'>)),
                                        '0', '0', msg)
                                  >
                      ) ▶₀ #vr.7 )
          next
            case ephemeral_keygen_case_3
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case static_keygen_case_1
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case static_keygen_case_2
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          qed
        next
          case split_case_05
          solve( !KU( kdf1(<'INpsk1', 'g'^inv(~e0)>) ) @ #vk.15 )
            case c_kdf1
            solve( !KU( 'g'^inv(~e0) ) @ #vk.18 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        next
          case split_case_06
          solve( !KU( kdf1(<'INpsk1', 'g'^inv(~e0)>) ) @ #vk.15 )
            case c_kdf1
            solve( !KU( 'g'^inv(~e0) ) @ #vk.18 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        next
          case split_case_07
          solve( !KU( kdf1(<'INpsk1', 'g'^inv((~e0*x))>) ) @ #vk.15 )
            case c_kdf1
            solve( !KU( 'g'^(~e0*rs4) ) @ #vk.13 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_1
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_2
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_3
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_4
              solve( !KU( ~e0 ) @ #vk.24 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_5
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_6
              solve( !KU( 'g'^inv((~e0*x)) ) @ #vk.18 )
                case c_exp
                solve( !KU( ~e0 ) @ #vk.23 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              qed
            next
              case channel_send_case_7
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_2
              solve( !KU( 'g'^inv((~e0*x)) ) @ #vk.18 )
                case c_exp
                solve( !KU( ~e0 ) @ #vk.23 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              qed
            next
              case ephemeral_keygen_case_3
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        next
          case split_case_08
          solve( !KU( kdf1(<'INpsk1', 'g'^inv((~e0*x))>) ) @ #vk.15 )
            case c_kdf1
            solve( !KU( 'g'^inv((~e0*x)) ) @ #vk.18 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        next
          case split_case_09
          solve( !KU( kdf1(<'INpsk1', 'g'^(x*inv(~e0))>) ) @ #vk.15 )
            case c_kdf1
            solve( !KU( 'g'^(~e0*rs4) ) @ #vk.13 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_1
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_2
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_3
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_4
              solve( !KU( ~e0 ) @ #vk.24 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_5
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_6
              solve( !KU( 'g'^(x*inv(~e0)) ) @ #vk.18 )
                case c_exp
                solve( !KU( ~e0 ) @ #vk.24 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case channel_send_case_1
                solve( !KU( ~e0 ) @ #vk.21 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case channel_send_case_2
                solve( !KU( ~e0 ) @ #vk.23 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case channel_send_case_3
                solve( !KU( ~e0 ) @ #vk.25 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case channel_send_case_4
                solve( !KU( ~e0 ) @ #vk.27 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case channel_send_case_5
                solve( !KU( ~e0 ) @ #vk.21 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case channel_send_case_6
                solve( !KU( ~e0 ) @ #vk.23 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case ephemeral_keygen_case_1
                solve( !KU( ~e0 ) @ #vk.21 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case ephemeral_keygen_case_2
                solve( !KU( ~e0 ) @ #vk.23 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case static_keygen_case_1
                solve( !KU( ~e0 ) @ #vk.21 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case static_keygen_case_2
                solve( !KU( ~e0 ) @ #vk.23 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              qed
            next
              case channel_send_case_7
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_2
              solve( !KU( 'g'^(x*inv(~e0)) ) @ #vk.18 )
                case c_exp
                solve( !KU( ~e0 ) @ #vk.24 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case channel_send_case_1
                solve( !KU( ~e0 ) @ #vk.21 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case channel_send_case_2
                solve( !KU( ~e0 ) @ #vk.23 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case channel_send_case_3
                solve( !KU( ~e0 ) @ #vk.25 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case channel_send_case_4
                solve( !KU( ~e0 ) @ #vk.27 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case channel_send_case_5
                solve( !KU( ~e0 ) @ #vk.21 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case channel_send_case_6
                solve( !KU( ~e0 ) @ #vk.23 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case ephemeral_keygen_case_1
                solve( !KU( ~e0 ) @ #vk.21 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case ephemeral_keygen_case_2
                solve( !KU( ~e0 ) @ #vk.23 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case static_keygen_case_1
                solve( !KU( ~e0 ) @ #vk.21 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case static_keygen_case_2
                solve( !KU( ~e0 ) @ #vk.23 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              qed
            next
              case ephemeral_keygen_case_3
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        next
          case split_case_10
          solve( !KU( kdf1(<'INpsk1', 'g'^(x*inv(~e0))>) ) @ #vk.15 )
            case c_kdf1
            solve( !KU( 'g'^(x*inv(~e0)) ) @ #vk.18 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_1
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_2
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_3
              solve( !KU( ~e0 ) @ #vk.24 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_4
              solve( !KU( ~e0 ) @ #vk.26 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_5
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_6
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        next
          case split_case_11
          solve( !KU( 'g'^(~e0*re0) ) @ #vk.13 )
            case c_exp
            solve( !KU( ~e0 ) @ #vk.18 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_1
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_2
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_3
            solve( !KU( ~e0 ) @ #vk.18 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_4
            solve( !KU( ~e0 ) @ #vk.22 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_5
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_6
            by solve( Receivable( <'0', 
                                   aead(kdf1(kdf1(<
                                                   kdf1(<
                                                         kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^re0>), ~psk>), 
                                                               'g'^~e0>), 
                                                         'g'^(~e0*re0)>), 
                                                   'g'^inv(x)>)),
                                        '0', '0', msg)
                                  >
                      ) ▶₀ #vr.7 )
          next
            case channel_send_case_7
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case ephemeral_keygen_case_1
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case ephemeral_keygen_case_2
            by solve( Receivable( <'0', 
                                   aead(kdf1(kdf1(<
                                                   kdf1(<
                                                         kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^re0>), ~psk>), 
                                                               'g'^~e0>), 
                                                         'g'^(~e0*re0)>), 
                                                   'g'^inv(x)>)),
                                        '0', '0', msg)
                                  >
                      ) ▶₀ #vr.7 )
          next
            case ephemeral_keygen_case_3
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case static_keygen_case_1
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case static_keygen_case_2
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          qed
        next
          case split_case_12
          solve( !KU( 'g'^(~e0*re0) ) @ #vk.13 )
            case c_exp
            solve( !KU( ~e0 ) @ #vk.18 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_1
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_2
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_3
            solve( !KU( ~e0 ) @ #vk.18 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_4
            solve( !KU( ~e0 ) @ #vk.22 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_5
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_6
            solve( Receivable( <'0', 
                                aead(kdf1(kdf1(<
                                                kdf1(<
                                                      kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^re0>), ~psk>), 'g'^~e0
                                                           >), 
                                                      'g'^(~e0*re0)>), 
                                                'g'^x>)),
                                     '0', '0', msg)
                               >
                   ) ▶₀ #vr.7 )
              case channel_send
              by contradiction /* non-normal terms */
            qed
          next
            case channel_send_case_7
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case ephemeral_keygen_case_1
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case ephemeral_keygen_case_2
            solve( Receivable( <'0', 
                                aead(kdf1(kdf1(<
                                                kdf1(<
                                                      kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^re0>), ~psk>), 'g'^~e0
                                                           >), 
                                                      'g'^(~e0*re0)>), 
                                                'g'^x>)),
                                     '0', '0', msg)
                               >
                   ) ▶₀ #vr.7 )
              case channel_send
              by contradiction /* non-normal terms */
            qed
          next
            case ephemeral_keygen_case_3
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case static_keygen_case_1
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case static_keygen_case_2
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          qed
        next
          case split_case_13
          solve( !KU( kdf1(<'INpsk1', 'g'^inv(~e0)>) ) @ #vk.15 )
            case c_kdf1
            solve( !KU( 'g'^inv(~e0) ) @ #vk.18 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        next
          case split_case_14
          solve( !KU( kdf1(<'INpsk1', 'g'^inv((~e0*x))>) ) @ #vk.15 )
            case c_kdf1
            solve( !KU( 'g'^inv((~e0*x)) ) @ #vk.18 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        next
          case split_case_15
          solve( !KU( kdf1(<'INpsk1', 'g'^inv((~e0*x))>) ) @ #vk.15 )
            case c_kdf1
            solve( !KU( 'g'^inv((~e0*x)) ) @ #vk.18 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        next
          case split_case_16
          solve( !KU( kdf1(<'INpsk1', 'g'^(x*inv(~e0))>) ) @ #vk.15 )
            case c_kdf1
            solve( !KU( 'g'^(x*inv(~e0)) ) @ #vk.18 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.23 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_1
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_2
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_3
              solve( !KU( ~e0 ) @ #vk.24 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_4
              solve( !KU( ~e0 ) @ #vk.26 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_5
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_6
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        next
          case split_case_17
          solve( !KU( kdf1(<'INpsk1', 'g'^(x*inv(~e0))>) ) @ #vk.15 )
            case c_kdf1
            solve( !KU( 'g'^(x*inv(~e0)) ) @ #vk.18 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.23 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_1
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_2
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_3
              solve( !KU( ~e0 ) @ #vk.24 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_4
              solve( !KU( ~e0 ) @ #vk.26 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_5
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_6
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        next
          case split_case_18
          solve( !KU( kdf1(<'INpsk1', 'g'^(x*inv((~e0*x.1)))>) ) @ #vk.15 )
            case c_kdf1
            solve( !KU( 'g'^(~e0*rs4) ) @ #vk.13 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_1
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_2
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_3
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_4
              solve( !KU( ~e0 ) @ #vk.24 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_5
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_6
              solve( !KU( 'g'^(x*inv((~e0*x.1))) ) @ #vk.18 )
                case c_exp
                solve( !KU( ~e0 ) @ #vk.25 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case channel_send_case_1
                solve( !KU( ~e0 ) @ #vk.22 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case channel_send_case_2
                solve( !KU( ~e0 ) @ #vk.24 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case channel_send_case_3
                solve( !KU( ~e0 ) @ #vk.26 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case channel_send_case_4
                solve( !KU( ~e0 ) @ #vk.28 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case channel_send_case_5
                solve( !KU( ~e0 ) @ #vk.22 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case channel_send_case_6
                solve( !KU( ~e0 ) @ #vk.24 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case ephemeral_keygen_case_1
                solve( !KU( ~e0 ) @ #vk.22 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case ephemeral_keygen_case_2
                solve( !KU( ~e0 ) @ #vk.24 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case static_keygen_case_1
                solve( !KU( ~e0 ) @ #vk.22 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case static_keygen_case_2
                solve( !KU( ~e0 ) @ #vk.24 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              qed
            next
              case channel_send_case_7
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_2
              solve( !KU( 'g'^(x*inv((~e0*x.1))) ) @ #vk.18 )
                case c_exp
                solve( !KU( ~e0 ) @ #vk.25 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case channel_send_case_1
                solve( !KU( ~e0 ) @ #vk.22 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case channel_send_case_2
                solve( !KU( ~e0 ) @ #vk.24 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case channel_send_case_3
                solve( !KU( ~e0 ) @ #vk.26 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case channel_send_case_4
                solve( !KU( ~e0 ) @ #vk.28 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case channel_send_case_5
                solve( !KU( ~e0 ) @ #vk.22 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case channel_send_case_6
                solve( !KU( ~e0 ) @ #vk.24 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case ephemeral_keygen_case_1
                solve( !KU( ~e0 ) @ #vk.22 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case ephemeral_keygen_case_2
                solve( !KU( ~e0 ) @ #vk.24 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case static_keygen_case_1
                solve( !KU( ~e0 ) @ #vk.22 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case static_keygen_case_2
                solve( !KU( ~e0 ) @ #vk.24 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              qed
            next
              case ephemeral_keygen_case_3
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        next
          case split_case_19
          solve( !KU( kdf1(<'INpsk1', 'g'^(x*inv((~e0*x.1)))>) ) @ #vk.15 )
            case c_kdf1
            solve( !KU( 'g'^(x*inv((~e0*x.1))) ) @ #vk.18 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.23 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_1
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_2
              solve( !KU( ~e0 ) @ #vk.23 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_3
              solve( !KU( ~e0 ) @ #vk.25 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_4
              solve( !KU( ~e0 ) @ #vk.27 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_5
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_6
              solve( !KU( ~e0 ) @ #vk.23 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.23 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.23 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        next
          case split_case_20
          solve( !KU( 'g'^(~e0*re0) ) @ #vk.13 )
            case c_exp
            solve( !KU( ~e0 ) @ #vk.18 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_1
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_2
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_3
            solve( !KU( ~e0 ) @ #vk.18 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_4
            solve( !KU( ~e0 ) @ #vk.22 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_5
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_6
            by solve( Receivable( <'0', 
                                   aead(kdf1(kdf1(<
                                                   kdf1(<
                                                         kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^re0>), ~psk>), 
                                                               'g'^~e0>), 
                                                         'g'^(~e0*re0)>), 
                                                   'g'^(x*inv(x.1))>)),
                                        '0', '0', msg)
                                  >
                      ) ▶₀ #vr.7 )
          next
            case channel_send_case_7
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case ephemeral_keygen_case_1
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case ephemeral_keygen_case_2
            by solve( Receivable( <'0', 
                                   aead(kdf1(kdf1(<
                                                   kdf1(<
                                                         kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^re0>), ~psk>), 
                                                               'g'^~e0>), 
                                                         'g'^(~e0*re0)>), 
                                                   'g'^(x*inv(x.1))>)),
                                        '0', '0', msg)
                                  >
                      ) ▶₀ #vr.7 )
          next
            case ephemeral_keygen_case_3
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case static_keygen_case_1
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case static_keygen_case_2
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          qed
        next
          case split_case_21
          solve( !KU( kdf1(<'INpsk1', 'g'^inv((~e0*x))>) ) @ #vk.15 )
            case c_kdf1
            solve( !KU( 'g'^inv((~e0*x)) ) @ #vk.18 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        next
          case split_case_22
          solve( !KU( kdf1(<'INpsk1', 'g'^(x*inv(~e0))>) ) @ #vk.15 )
            case c_kdf1
            solve( !KU( 'g'^(x*inv(~e0)) ) @ #vk.18 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.23 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_1
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_2
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_3
              solve( !KU( ~e0 ) @ #vk.24 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_4
              solve( !KU( ~e0 ) @ #vk.26 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_5
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_6
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        next
          case split_case_23
          solve( !KU( kdf1(<'INpsk1', 'g'^(x*inv((~e0*x.1)))>) ) @ #vk.15 )
            case c_kdf1
            solve( !KU( 'g'^(x*inv((~e0*x.1))) ) @ #vk.18 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.24 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_1
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_2
              solve( !KU( ~e0 ) @ #vk.23 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_3
              solve( !KU( ~e0 ) @ #vk.25 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_4
              solve( !KU( ~e0 ) @ #vk.27 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_5
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_6
              solve( !KU( ~e0 ) @ #vk.23 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.23 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.23 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        next
          case split_case_24
          solve( !KU( kdf1(<'INpsk1', 'g'^(x*inv((~e0*x.1)))>) ) @ #vk.15 )
            case c_kdf1
            solve( !KU( 'g'^(x*inv((~e0*x.1))) ) @ #vk.18 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.24 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_1
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_2
              solve( !KU( ~e0 ) @ #vk.23 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_3
              solve( !KU( ~e0 ) @ #vk.25 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_4
              solve( !KU( ~e0 ) @ #vk.27 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_5
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_6
              solve( !KU( ~e0 ) @ #vk.23 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.23 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.23 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        next
          case split_case_25
          solve( !KU( kdf1(<'INpsk1', 'g'^(x*inv((~e0*x.1)))>) ) @ #vk.15 )
            case c_kdf1
            solve( !KU( 'g'^(x*inv((~e0*x.1))) ) @ #vk.18 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.24 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_1
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_2
              solve( !KU( ~e0 ) @ #vk.23 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_3
              solve( !KU( ~e0 ) @ #vk.25 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_4
              solve( !KU( ~e0 ) @ #vk.27 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_5
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_6
              solve( !KU( ~e0 ) @ #vk.23 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.23 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.23 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        qed
      qed
    qed
  qed
qed

lemma Secrecy_INpsk1_4_for_Responder_unless_active_or_reveal_e_AnyTime_or_reveal_re_AnyTime_or_reveal_rs_AnyTime_end:
  all-traces
  "∀ msg e re peer psk #claim.
    (Secret_INpsk1_4_Responder( e, re, peer, psk, msg ) @ #claim) ⇒
    ((¬(∃ #attack. K( msg ) @ #attack)) ∨
     (((∃ #reveal. RevealEk( e ) @ #reveal) ∨
       (∃ #reveal. RevealEk( re ) @ #reveal)) ∨
      (∃ #reveal. RevealLtk( peer ) @ #reveal)))"
/*
guarded formula characterizing all counter-examples:
"∃ msg e re peer psk #claim.
  (Secret_INpsk1_4_Responder( e, re, peer, psk, msg ) @ #claim)
 ∧
  (∃ #attack. (K( msg ) @ #attack)) ∧
  (∀ #reveal. (RevealEk( e ) @ #reveal) ⇒ ⊥) ∧
  (∀ #reveal. (RevealEk( re ) @ #reveal) ⇒ ⊥) ∧
  (∀ #reveal. (RevealLtk( peer ) @ #reveal) ⇒ ⊥)"
*/
simplify
solve( St_Responder_3( ~id, e, re, peer, psk ) ▶₀ #claim )
  case Instrumentation_Responder_3
  solve( !KU( ~n ) @ #vk )
    case channel_send
    solve( !KU( ~psk ) @ #vk.15 )
      case psk_reveal
      solve( splitEqs(1) )
        case split_case_1
        by solve( Receivable( <'0', 
                               aead(kdf1(kdf1(<
                                               kdf1(<kdf1(<kdf2(<kdf1(<'INpsk1', 'g'>), ~psk>), 'g'^~e0>), 
                                                     'g'^~e0>), 
                                               'g'^~e0>)),
                                    '0', '0', msg)
                              >
                  ) ▶₀ #vr.7 )
      next
        case split_case_2
        solve( splitEqs(4) )
          case split_case_1
          solve( !KU( kdf1(<'INpsk1', 'g'^inv(~e0)>) ) @ #vk.14 )
            case c_kdf1
            solve( !KU( 'g'^inv(~e0) ) @ #vk.17 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        next
          case split_case_2
          solve( !KU( 'g'^(~e0*re0) ) @ #vk.13 )
            case c_exp
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_1
            solve( !KU( ~e0 ) @ #vk.15 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_2
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_3
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_4
            solve( !KU( ~e0 ) @ #vk.21 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_5
            solve( !KU( ~e0 ) @ #vk.15 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_6
            by solve( Receivable( <'0', 
                                   aead(kdf1(kdf1(<
                                                   kdf1(<
                                                         kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^re0>), ~psk>), 
                                                               'g'^~e0>), 
                                                         'g'^(~e0*re0)>), 
                                                   'g'^~e0>)),
                                        '0', '0', msg)
                                  >
                      ) ▶₀ #vr.7 )
          next
            case channel_send_case_7
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case ephemeral_keygen_case_1
            solve( !KU( ~e0 ) @ #vk.15 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case ephemeral_keygen_case_2
            by solve( Receivable( <'0', 
                                   aead(kdf1(kdf1(<
                                                   kdf1(<
                                                         kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^re0>), ~psk>), 
                                                               'g'^~e0>), 
                                                         'g'^(~e0*re0)>), 
                                                   'g'^~e0>)),
                                        '0', '0', msg)
                                  >
                      ) ▶₀ #vr.7 )
          next
            case ephemeral_keygen_case_3
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case static_keygen_case_1
            solve( !KU( ~e0 ) @ #vk.15 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case static_keygen_case_2
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          qed
        next
          case split_case_3
          solve( !KU( kdf1(<'INpsk1', 'g'^inv((~e0*x))>) ) @ #vk.14 )
            case c_kdf1
            solve( !KU( 'g'^inv((~e0*x)) ) @ #vk.17 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        next
          case split_case_4
          solve( !KU( kdf1(<'INpsk1', 'g'^(x*inv(~e0))>) ) @ #vk.14 )
            case c_kdf1
            solve( !KU( 'g'^(x*inv(~e0)) ) @ #vk.17 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_1
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_2
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_3
              solve( !KU( ~e0 ) @ #vk.23 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_4
              solve( !KU( ~e0 ) @ #vk.25 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_5
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_6
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        next
          case split_case_5
          solve( !KU( kdf1(<'INpsk1', 'g'^(x*inv((~e0*x.1)))>) ) @ #vk.14 )
            case c_kdf1
            solve( !KU( 'g'^(x*inv((~e0*x.1))) ) @ #vk.17 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.23 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_1
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_2
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_3
              solve( !KU( ~e0 ) @ #vk.24 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_4
              solve( !KU( ~e0 ) @ #vk.26 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_5
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_6
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        qed
      next
        case split_case_3
        solve( splitEqs(4) )
          case split_case_1
          by solve( Receivable( <'0', 
                                 aead(kdf1(kdf1(<
                                                 kdf1(<kdf1(<kdf2(<kdf1(<'INpsk1', 'g'>), ~psk>), 'g'^~e0>), 
                                                       'g'^~e0>), 
                                                 'g'>)),
                                      '0', '0', msg)
                                >
                    ) ▶₀ #vr.7 )
        next
          case split_case_2
          solve( !KU( 'g'^(~e0*rs4) ) @ #vk.12 )
            case c_exp
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_1
            solve( !KU( ~e0 ) @ #vk.15 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_2
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_3
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_4
            solve( !KU( ~e0 ) @ #vk.21 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_5
            solve( !KU( ~e0 ) @ #vk.15 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_6
            by solve( Receivable( <'0', 
                                   aead(kdf1(kdf1(<
                                                   kdf1(<
                                                         kdf1(<kdf2(<kdf1(<'INpsk1', 'g'>), ~psk>), 'g'^~e0
                                                              >), 
                                                         'g'^~e0>), 
                                                   'g'^(~e0*rs4)>)),
                                        '0', '0', msg)
                                  >
                      ) ▶₀ #vr.7 )
          next
            case channel_send_case_7
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case ephemeral_keygen_case_1
            solve( !KU( ~e0 ) @ #vk.15 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case ephemeral_keygen_case_2
            by solve( Receivable( <'0', 
                                   aead(kdf1(kdf1(<
                                                   kdf1(<
                                                         kdf1(<kdf2(<kdf1(<'INpsk1', 'g'>), ~psk>), 'g'^~e0
                                                              >), 
                                                         'g'^~e0>), 
                                                   'g'^(~e0*rs4)>)),
                                        '0', '0', msg)
                                  >
                      ) ▶₀ #vr.7 )
          next
            case ephemeral_keygen_case_3
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case static_keygen_case_1
            solve( !KU( ~e0 ) @ #vk.15 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case static_keygen_case_2
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          qed
        next
          case split_case_3
          by solve( Receivable( <'0', 
                                 aead(kdf1(kdf1(<
                                                 kdf1(<kdf1(<kdf2(<kdf1(<'INpsk1', 'g'>), ~psk>), 'g'^~e0>), 
                                                       'g'^~e0>), 
                                                 'g'^inv(x)>)),
                                      '0', '0', msg)
                                >
                    ) ▶₀ #vr.7 )
        next
          case split_case_4
          by solve( Receivable( <'0', 
                                 aead(kdf1(kdf1(<
                                                 kdf1(<kdf1(<kdf2(<kdf1(<'INpsk1', 'g'>), ~psk>), 'g'^~e0>), 
                                                       'g'^~e0>), 
                                                 'g'^x>)),
                                      '0', '0', msg)
                                >
                    ) ▶₀ #vr.7 )
        next
          case split_case_5
          by solve( Receivable( <'0', 
                                 aead(kdf1(kdf1(<
                                                 kdf1(<kdf1(<kdf2(<kdf1(<'INpsk1', 'g'>), ~psk>), 'g'^~e0>), 
                                                       'g'^~e0>), 
                                                 'g'^(x*inv(x.1))>)),
                                      '0', '0', msg)
                                >
                    ) ▶₀ #vr.7 )
        qed
      next
        case split_case_4
        solve( splitEqs(4) )
          case split_case_01
          solve( !KU( kdf1(<'INpsk1', 'g'^inv(~e0)>) ) @ #vk.14 )
            case c_kdf1
            solve( !KU( 'g'^inv(~e0) ) @ #vk.17 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        next
          case split_case_02
          solve( !KU( kdf1(<'INpsk1', 'g'^inv(~e0)>) ) @ #vk.15 )
            case c_kdf1
            solve( !KU( 'g'^(~e0*rs4) ) @ #vk.13 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_1
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_2
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_3
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_4
              solve( !KU( ~e0 ) @ #vk.24 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_5
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_6
              solve( !KU( 'g'^inv(~e0) ) @ #vk.18 )
                case c_exp
                solve( !KU( ~e0 ) @ #vk.21 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              qed
            next
              case channel_send_case_7
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_2
              solve( !KU( 'g'^inv(~e0) ) @ #vk.18 )
                case c_exp
                solve( !KU( ~e0 ) @ #vk.21 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              qed
            next
              case ephemeral_keygen_case_3
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        next
          case split_case_03
          solve( !KU( 'g'^(~e0*rs4) ) @ #vk.12 )
            case c_exp
            solve( !KU( ~e0 ) @ #vk.18 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_1
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_2
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_3
            solve( !KU( ~e0 ) @ #vk.18 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_4
            solve( !KU( ~e0 ) @ #vk.22 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_5
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_6
            solve( !KU( 'g'^(~e0*re0) ) @ #vk.13 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_1
              solve( !KU( ~e0 ) @ #vk.17 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_2
              solve( !KU( ~e0 ) @ #vk.18 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_3
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_4
              solve( !KU( ~e0 ) @ #vk.23 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_5
              solve( !KU( ~e0 ) @ #vk.17 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_6
              solve( Receivable( <'0', 
                                  aead(kdf1(kdf1(<
                                                  kdf1(<
                                                        kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^re0>), ~psk>), 'g'^~e0
                                                             >), 
                                                        'g'^(~e0*re0)>), 
                                                  'g'^(~e0*rs4)>)),
                                       '0', '0', msg)
                                 >
                     ) ▶₀ #vr.7 )
                case channel_send
                solve( !KU( ~rs4 ) @ #vk.16 )
                  case static_reveal
                  by contradiction /* from formulas */
                qed
              qed
            next
              case channel_send_case_7
              solve( !KU( ~e0 ) @ #vk.18 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.17 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.18 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.17 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.18 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          next
            case channel_send_case_7
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case ephemeral_keygen_case_1
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case ephemeral_keygen_case_2
            solve( !KU( 'g'^(~e0*re0) ) @ #vk.13 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_1
              solve( !KU( ~e0 ) @ #vk.17 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_2
              solve( !KU( ~e0 ) @ #vk.18 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_3
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_4
              solve( !KU( ~e0 ) @ #vk.23 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_5
              solve( !KU( ~e0 ) @ #vk.17 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_6
              solve( !KU( ~e0 ) @ #vk.18 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.17 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_2
              solve( Receivable( <'0', 
                                  aead(kdf1(kdf1(<
                                                  kdf1(<
                                                        kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^re0>), ~psk>), 'g'^~e0
                                                             >), 
                                                        'g'^(~e0*re0)>), 
                                                  'g'^(~e0*rs4)>)),
                                       '0', '0', msg)
                                 >
                     ) ▶₀ #vr.7 )
                case channel_send
                solve( !KU( ~rs4 ) @ #vk.16 )
                  case static_reveal
                  by contradiction /* from formulas */
                qed
              qed
            next
              case ephemeral_keygen_case_3
              solve( !KU( ~e0 ) @ #vk.18 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.17 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.18 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          next
            case ephemeral_keygen_case_3
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case static_keygen_case_1
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case static_keygen_case_2
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          qed
        next
          case split_case_04
          solve( !KU( 'g'^(~e0*re0) ) @ #vk.13 )
            case c_exp
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_1
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_2
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_3
            solve( !KU( ~e0 ) @ #vk.18 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_4
            solve( !KU( ~e0 ) @ #vk.22 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_5
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_6
            by solve( Receivable( <'0', 
                                   aead(kdf1(kdf1(<
                                                   kdf1(<
                                                         kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^re0>), ~psk>), 
                                                               'g'^~e0>), 
                                                         'g'^(~e0*re0)>), 
                                                   'g'>)),
                                        '0', '0', msg)
                                  >
                      ) ▶₀ #vr.7 )
          next
            case channel_send_case_7
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case ephemeral_keygen_case_1
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case ephemeral_keygen_case_2
            by solve( Receivable( <'0', 
                                   aead(kdf1(kdf1(<
                                                   kdf1(<
                                                         kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^re0>), ~psk>), 
                                                               'g'^~e0>), 
                                                         'g'^(~e0*re0)>), 
                                                   'g'>)),
                                        '0', '0', msg)
                                  >
                      ) ▶₀ #vr.7 )
          next
            case ephemeral_keygen_case_3
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case static_keygen_case_1
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case static_keygen_case_2
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          qed
        next
          case split_case_05
          solve( !KU( kdf1(<'INpsk1', 'g'^inv(~e0)>) ) @ #vk.15 )
            case c_kdf1
            solve( !KU( 'g'^inv(~e0) ) @ #vk.18 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        next
          case split_case_06
          solve( !KU( kdf1(<'INpsk1', 'g'^inv(~e0)>) ) @ #vk.15 )
            case c_kdf1
            solve( !KU( 'g'^inv(~e0) ) @ #vk.18 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        next
          case split_case_07
          solve( !KU( kdf1(<'INpsk1', 'g'^inv((~e0*x))>) ) @ #vk.15 )
            case c_kdf1
            solve( !KU( 'g'^(~e0*rs4) ) @ #vk.13 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_1
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_2
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_3
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_4
              solve( !KU( ~e0 ) @ #vk.24 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_5
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_6
              solve( !KU( 'g'^inv((~e0*x)) ) @ #vk.18 )
                case c_exp
                solve( !KU( ~e0 ) @ #vk.23 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              qed
            next
              case channel_send_case_7
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_2
              solve( !KU( 'g'^inv((~e0*x)) ) @ #vk.18 )
                case c_exp
                solve( !KU( ~e0 ) @ #vk.23 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              qed
            next
              case ephemeral_keygen_case_3
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        next
          case split_case_08
          solve( !KU( kdf1(<'INpsk1', 'g'^inv((~e0*x))>) ) @ #vk.15 )
            case c_kdf1
            solve( !KU( 'g'^inv((~e0*x)) ) @ #vk.18 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        next
          case split_case_09
          solve( !KU( kdf1(<'INpsk1', 'g'^(x*inv(~e0))>) ) @ #vk.15 )
            case c_kdf1
            solve( !KU( 'g'^(~e0*rs4) ) @ #vk.13 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_1
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_2
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_3
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_4
              solve( !KU( ~e0 ) @ #vk.24 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_5
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_6
              solve( !KU( 'g'^(x*inv(~e0)) ) @ #vk.18 )
                case c_exp
                solve( !KU( ~e0 ) @ #vk.24 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case channel_send_case_1
                solve( !KU( ~e0 ) @ #vk.21 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case channel_send_case_2
                solve( !KU( ~e0 ) @ #vk.23 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case channel_send_case_3
                solve( !KU( ~e0 ) @ #vk.25 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case channel_send_case_4
                solve( !KU( ~e0 ) @ #vk.27 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case channel_send_case_5
                solve( !KU( ~e0 ) @ #vk.21 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case channel_send_case_6
                solve( !KU( ~e0 ) @ #vk.23 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case ephemeral_keygen_case_1
                solve( !KU( ~e0 ) @ #vk.21 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case ephemeral_keygen_case_2
                solve( !KU( ~e0 ) @ #vk.23 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case static_keygen_case_1
                solve( !KU( ~e0 ) @ #vk.21 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case static_keygen_case_2
                solve( !KU( ~e0 ) @ #vk.23 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              qed
            next
              case channel_send_case_7
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_2
              solve( !KU( 'g'^(x*inv(~e0)) ) @ #vk.18 )
                case c_exp
                solve( !KU( ~e0 ) @ #vk.24 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case channel_send_case_1
                solve( !KU( ~e0 ) @ #vk.21 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case channel_send_case_2
                solve( !KU( ~e0 ) @ #vk.23 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case channel_send_case_3
                solve( !KU( ~e0 ) @ #vk.25 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case channel_send_case_4
                solve( !KU( ~e0 ) @ #vk.27 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case channel_send_case_5
                solve( !KU( ~e0 ) @ #vk.21 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case channel_send_case_6
                solve( !KU( ~e0 ) @ #vk.23 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case ephemeral_keygen_case_1
                solve( !KU( ~e0 ) @ #vk.21 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case ephemeral_keygen_case_2
                solve( !KU( ~e0 ) @ #vk.23 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case static_keygen_case_1
                solve( !KU( ~e0 ) @ #vk.21 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case static_keygen_case_2
                solve( !KU( ~e0 ) @ #vk.23 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              qed
            next
              case ephemeral_keygen_case_3
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        next
          case split_case_10
          solve( !KU( kdf1(<'INpsk1', 'g'^(x*inv(~e0))>) ) @ #vk.15 )
            case c_kdf1
            solve( !KU( 'g'^(x*inv(~e0)) ) @ #vk.18 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_1
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_2
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_3
              solve( !KU( ~e0 ) @ #vk.24 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_4
              solve( !KU( ~e0 ) @ #vk.26 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_5
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_6
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        next
          case split_case_11
          solve( !KU( 'g'^(~e0*re0) ) @ #vk.13 )
            case c_exp
            solve( !KU( ~e0 ) @ #vk.18 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_1
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_2
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_3
            solve( !KU( ~e0 ) @ #vk.18 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_4
            solve( !KU( ~e0 ) @ #vk.22 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_5
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_6
            by solve( Receivable( <'0', 
                                   aead(kdf1(kdf1(<
                                                   kdf1(<
                                                         kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^re0>), ~psk>), 
                                                               'g'^~e0>), 
                                                         'g'^(~e0*re0)>), 
                                                   'g'^inv(x)>)),
                                        '0', '0', msg)
                                  >
                      ) ▶₀ #vr.7 )
          next
            case channel_send_case_7
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case ephemeral_keygen_case_1
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case ephemeral_keygen_case_2
            by solve( Receivable( <'0', 
                                   aead(kdf1(kdf1(<
                                                   kdf1(<
                                                         kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^re0>), ~psk>), 
                                                               'g'^~e0>), 
                                                         'g'^(~e0*re0)>), 
                                                   'g'^inv(x)>)),
                                        '0', '0', msg)
                                  >
                      ) ▶₀ #vr.7 )
          next
            case ephemeral_keygen_case_3
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case static_keygen_case_1
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case static_keygen_case_2
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          qed
        next
          case split_case_12
          solve( !KU( 'g'^(~e0*re0) ) @ #vk.13 )
            case c_exp
            solve( !KU( ~e0 ) @ #vk.18 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_1
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_2
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_3
            solve( !KU( ~e0 ) @ #vk.18 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_4
            solve( !KU( ~e0 ) @ #vk.22 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_5
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_6
            solve( Receivable( <'0', 
                                aead(kdf1(kdf1(<
                                                kdf1(<
                                                      kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^re0>), ~psk>), 'g'^~e0
                                                           >), 
                                                      'g'^(~e0*re0)>), 
                                                'g'^x>)),
                                     '0', '0', msg)
                               >
                   ) ▶₀ #vr.7 )
              case channel_send
              by contradiction /* non-normal terms */
            qed
          next
            case channel_send_case_7
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case ephemeral_keygen_case_1
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case ephemeral_keygen_case_2
            solve( Receivable( <'0', 
                                aead(kdf1(kdf1(<
                                                kdf1(<
                                                      kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^re0>), ~psk>), 'g'^~e0
                                                           >), 
                                                      'g'^(~e0*re0)>), 
                                                'g'^x>)),
                                     '0', '0', msg)
                               >
                   ) ▶₀ #vr.7 )
              case channel_send
              by contradiction /* non-normal terms */
            qed
          next
            case ephemeral_keygen_case_3
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case static_keygen_case_1
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case static_keygen_case_2
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          qed
        next
          case split_case_13
          solve( !KU( kdf1(<'INpsk1', 'g'^inv(~e0)>) ) @ #vk.15 )
            case c_kdf1
            solve( !KU( 'g'^inv(~e0) ) @ #vk.18 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        next
          case split_case_14
          solve( !KU( kdf1(<'INpsk1', 'g'^inv((~e0*x))>) ) @ #vk.15 )
            case c_kdf1
            solve( !KU( 'g'^inv((~e0*x)) ) @ #vk.18 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        next
          case split_case_15
          solve( !KU( kdf1(<'INpsk1', 'g'^inv((~e0*x))>) ) @ #vk.15 )
            case c_kdf1
            solve( !KU( 'g'^inv((~e0*x)) ) @ #vk.18 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        next
          case split_case_16
          solve( !KU( kdf1(<'INpsk1', 'g'^(x*inv(~e0))>) ) @ #vk.15 )
            case c_kdf1
            solve( !KU( 'g'^(x*inv(~e0)) ) @ #vk.18 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.23 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_1
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_2
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_3
              solve( !KU( ~e0 ) @ #vk.24 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_4
              solve( !KU( ~e0 ) @ #vk.26 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_5
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_6
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        next
          case split_case_17
          solve( !KU( kdf1(<'INpsk1', 'g'^(x*inv(~e0))>) ) @ #vk.15 )
            case c_kdf1
            solve( !KU( 'g'^(x*inv(~e0)) ) @ #vk.18 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.23 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_1
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_2
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_3
              solve( !KU( ~e0 ) @ #vk.24 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_4
              solve( !KU( ~e0 ) @ #vk.26 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_5
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_6
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        next
          case split_case_18
          solve( !KU( kdf1(<'INpsk1', 'g'^(x*inv((~e0*x.1)))>) ) @ #vk.15 )
            case c_kdf1
            solve( !KU( 'g'^(~e0*rs4) ) @ #vk.13 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_1
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_2
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_3
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_4
              solve( !KU( ~e0 ) @ #vk.24 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_5
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_6
              solve( !KU( 'g'^(x*inv((~e0*x.1))) ) @ #vk.18 )
                case c_exp
                solve( !KU( ~e0 ) @ #vk.25 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case channel_send_case_1
                solve( !KU( ~e0 ) @ #vk.22 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case channel_send_case_2
                solve( !KU( ~e0 ) @ #vk.24 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case channel_send_case_3
                solve( !KU( ~e0 ) @ #vk.26 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case channel_send_case_4
                solve( !KU( ~e0 ) @ #vk.28 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case channel_send_case_5
                solve( !KU( ~e0 ) @ #vk.22 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case channel_send_case_6
                solve( !KU( ~e0 ) @ #vk.24 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case ephemeral_keygen_case_1
                solve( !KU( ~e0 ) @ #vk.22 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case ephemeral_keygen_case_2
                solve( !KU( ~e0 ) @ #vk.24 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case static_keygen_case_1
                solve( !KU( ~e0 ) @ #vk.22 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case static_keygen_case_2
                solve( !KU( ~e0 ) @ #vk.24 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              qed
            next
              case channel_send_case_7
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_2
              solve( !KU( 'g'^(x*inv((~e0*x.1))) ) @ #vk.18 )
                case c_exp
                solve( !KU( ~e0 ) @ #vk.25 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case channel_send_case_1
                solve( !KU( ~e0 ) @ #vk.22 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case channel_send_case_2
                solve( !KU( ~e0 ) @ #vk.24 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case channel_send_case_3
                solve( !KU( ~e0 ) @ #vk.26 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case channel_send_case_4
                solve( !KU( ~e0 ) @ #vk.28 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case channel_send_case_5
                solve( !KU( ~e0 ) @ #vk.22 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case channel_send_case_6
                solve( !KU( ~e0 ) @ #vk.24 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case ephemeral_keygen_case_1
                solve( !KU( ~e0 ) @ #vk.22 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case ephemeral_keygen_case_2
                solve( !KU( ~e0 ) @ #vk.24 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case static_keygen_case_1
                solve( !KU( ~e0 ) @ #vk.22 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              next
                case static_keygen_case_2
                solve( !KU( ~e0 ) @ #vk.24 )
                  case ephemeral_reveal
                  by contradiction /* from formulas */
                qed
              qed
            next
              case ephemeral_keygen_case_3
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.19 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        next
          case split_case_19
          solve( !KU( kdf1(<'INpsk1', 'g'^(x*inv((~e0*x.1)))>) ) @ #vk.15 )
            case c_kdf1
            solve( !KU( 'g'^(x*inv((~e0*x.1))) ) @ #vk.18 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.23 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_1
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_2
              solve( !KU( ~e0 ) @ #vk.23 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_3
              solve( !KU( ~e0 ) @ #vk.25 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_4
              solve( !KU( ~e0 ) @ #vk.27 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_5
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_6
              solve( !KU( ~e0 ) @ #vk.23 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.23 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.23 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        next
          case split_case_20
          solve( !KU( 'g'^(~e0*re0) ) @ #vk.13 )
            case c_exp
            solve( !KU( ~e0 ) @ #vk.18 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_1
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_2
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_3
            solve( !KU( ~e0 ) @ #vk.18 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_4
            solve( !KU( ~e0 ) @ #vk.22 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_5
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case channel_send_case_6
            by solve( Receivable( <'0', 
                                   aead(kdf1(kdf1(<
                                                   kdf1(<
                                                         kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^re0>), ~psk>), 
                                                               'g'^~e0>), 
                                                         'g'^(~e0*re0)>), 
                                                   'g'^(x*inv(x.1))>)),
                                        '0', '0', msg)
                                  >
                      ) ▶₀ #vr.7 )
          next
            case channel_send_case_7
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case ephemeral_keygen_case_1
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case ephemeral_keygen_case_2
            by solve( Receivable( <'0', 
                                   aead(kdf1(kdf1(<
                                                   kdf1(<
                                                         kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^re0>), ~psk>), 
                                                               'g'^~e0>), 
                                                         'g'^(~e0*re0)>), 
                                                   'g'^(x*inv(x.1))>)),
                                        '0', '0', msg)
                                  >
                      ) ▶₀ #vr.7 )
          next
            case ephemeral_keygen_case_3
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case static_keygen_case_1
            solve( !KU( ~e0 ) @ #vk.16 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          next
            case static_keygen_case_2
            solve( !KU( ~e0 ) @ #vk.17 )
              case ephemeral_reveal
              by contradiction /* from formulas */
            qed
          qed
        next
          case split_case_21
          solve( !KU( kdf1(<'INpsk1', 'g'^inv((~e0*x))>) ) @ #vk.15 )
            case c_kdf1
            solve( !KU( 'g'^inv((~e0*x)) ) @ #vk.18 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        next
          case split_case_22
          solve( !KU( kdf1(<'INpsk1', 'g'^(x*inv(~e0))>) ) @ #vk.15 )
            case c_kdf1
            solve( !KU( 'g'^(x*inv(~e0)) ) @ #vk.18 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.23 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_1
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_2
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_3
              solve( !KU( ~e0 ) @ #vk.24 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_4
              solve( !KU( ~e0 ) @ #vk.26 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_5
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_6
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.20 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.22 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        next
          case split_case_23
          solve( !KU( kdf1(<'INpsk1', 'g'^(x*inv((~e0*x.1)))>) ) @ #vk.15 )
            case c_kdf1
            solve( !KU( 'g'^(x*inv((~e0*x.1))) ) @ #vk.18 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.24 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_1
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_2
              solve( !KU( ~e0 ) @ #vk.23 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_3
              solve( !KU( ~e0 ) @ #vk.25 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_4
              solve( !KU( ~e0 ) @ #vk.27 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_5
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_6
              solve( !KU( ~e0 ) @ #vk.23 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.23 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.23 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        next
          case split_case_24
          solve( !KU( kdf1(<'INpsk1', 'g'^(x*inv((~e0*x.1)))>) ) @ #vk.15 )
            case c_kdf1
            solve( !KU( 'g'^(x*inv((~e0*x.1))) ) @ #vk.18 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.24 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_1
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_2
              solve( !KU( ~e0 ) @ #vk.23 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_3
              solve( !KU( ~e0 ) @ #vk.25 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_4
              solve( !KU( ~e0 ) @ #vk.27 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_5
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_6
              solve( !KU( ~e0 ) @ #vk.23 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.23 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.23 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        next
          case split_case_25
          solve( !KU( kdf1(<'INpsk1', 'g'^(x*inv((~e0*x.1)))>) ) @ #vk.15 )
            case c_kdf1
            solve( !KU( 'g'^(x*inv((~e0*x.1))) ) @ #vk.18 )
              case c_exp
              solve( !KU( ~e0 ) @ #vk.24 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_1
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_2
              solve( !KU( ~e0 ) @ #vk.23 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_3
              solve( !KU( ~e0 ) @ #vk.25 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_4
              solve( !KU( ~e0 ) @ #vk.27 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_5
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case channel_send_case_6
              solve( !KU( ~e0 ) @ #vk.23 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case ephemeral_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.23 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_1
              solve( !KU( ~e0 ) @ #vk.21 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            next
              case static_keygen_case_2
              solve( !KU( ~e0 ) @ #vk.23 )
                case ephemeral_reveal
                by contradiction /* from formulas */
              qed
            qed
          qed
        qed
      qed
    qed
  qed
qed

rule (modulo E) Instrumentation_Responder_4:
   [ St_Responder_3( ~id, e, re, peer, psk ), Fr( msg ) ]
  --[ Secret_INpsk1_4_Responder( e, re, peer, psk, msg ) ]->
   [ St_Responder_4( ~id, e, re, peer, psk ), R_Snd( ~id, '1', msg ) ]

  /* has exactly the trivial AC variant */

lemma executabilityPassiveAdv:
  exists-trace
  "(((∃ #i. Finish( ) @ #i) ∧
     ((∀ id m #j.
        (RawRecv( id, m ) @ #j) ⇒ (∃ #k. (RawSnd( id, m ) @ #k) ∧ (#k < #j))) ∧
      ((∀ id m m2 #a #b.
         ((RawSnd( id, m ) @ #a) ∧ (RawSnd( id, m2 ) @ #b)) ⇒ (#a = #b)) ∧
       ((∀ #a #b.
          ((Create_Initiator( ) @ #a) ∧ (Create_Initiator( ) @ #b)) ⇒ (#a = #b)) ∧
        (∀ #a #b.
          ((Create_Responder( ) @ #a) ∧ (Create_Responder( ) @ #b)) ⇒
          (#a = #b)))))) ∧
    ((¬(∃ key #k. RevealLtk( key ) @ #k)) ∧
     (¬(∃ key #k. RevealEk( key ) @ #k)))) ∧
   (¬(∃ key #k. RevealPsk( key ) @ #k))"
/*
guarded formula characterizing all satisfying traces:
"(∃ #i. (Finish( ) @ #i)) ∧
 (∀ id m #j.
   (RawRecv( id, m ) @ #j) ⇒ ∃ #k. (RawSnd( id, m ) @ #k) ∧ #k < #j) ∧
 (∀ id m m2 #a #b.
   (RawSnd( id, m ) @ #a) ∧ (RawSnd( id, m2 ) @ #b) ⇒ #a = #b) ∧
 (∀ #a #b.
   (Create_Initiator( ) @ #a) ∧ (Create_Initiator( ) @ #b) ⇒ #a = #b) ∧
 (∀ #a #b.
   (Create_Responder( ) @ #a) ∧ (Create_Responder( ) @ #b) ⇒ #a = #b) ∧
 (∀ key #k. (RevealLtk( key ) @ #k) ⇒ ⊥) ∧
 (∀ key #k. (RevealEk( key ) @ #k) ⇒ ⊥) ∧
 (∀ key #k. (RevealPsk( key ) @ #k) ⇒ ⊥)"
*/
simplify
solve( St_Initiator_3( ~id, e, me, re, psk ) ▶₀ #i )
  case Instrumentation_Initiator_3
  solve( I_Recv( ~id, '1', msg ) ▶₁ #i )
    case I_Recv_from_R
    solve( RawSnd( 'Responder2',
                   <re, 
                    aead(kdf2(<
                               kdf1(<kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), re>), z>), z.1>),
                         '0',
                         h(<
                            h(<
                               h(<
                                  h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                     aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                          h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                    >), 
                                  kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                               aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                    h(<
                                       h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                          aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                               h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                         >), 
                                       kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                    $msg.3)
                              >), 
                            re>),
                         msg.2)
                   >
           ) @ #k )
      case Handshake_Responder_Snd_2
      solve( HandshakeState_Responder_1( id.1,
                                         h(<
                                            h(<
                                               h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                  aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                       h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                 >), 
                                               kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                            aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                                 h(<
                                                    h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                       aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                            h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                                      >), 
                                                    kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                                 $msg.1)
                                           >),
                                         kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), k.1, 'g'^~e, 'g'^~s, psk.1
             ) ▶₀ #k )
        case Handshake_Responder_Recv_1
        solve( Handshake_Snd_2( ~id.1, msg.2 ) ▶₁ #k )
          case Instrumentation_Responder_2
          solve( Ek( ~e0 ) ▶₂ #k )
            case ephemeral_keygen
            solve( RawSnd( <'R', '1'>,
                           <'1', 
                            aead(kdf2(kdf1(<
                                            kdf1(<kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 'g'^~e0>), 
                                                  'g'^(~e*~e0)>), 
                                            'g'^(~e0*~s)>)),
                                 '1', '0', msg)
                           >
                   ) @ #k.1 )
              case R_Snd_to_I
              solve( R_Snd( id.2, '1', msg ) ▶₀ #k.1 )
                case Instrumentation_Responder_4
                solve( !Transport_Responder( ~id.1, ki2r,
                                             kdf2(kdf1(<
                                                        kdf1(<
                                                              kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 
                                                                    'g'^~e0>), 
                                                              'g'^(~e*~e0)>), 
                                                        'g'^(~e0*~s)>))
                       ) ▶₁ #k.1 )
                  case Responder_to_transport_mode
                  solve( RawSnd( 'Initiator1',
                                 <'g'^~e, 
                                  aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                       h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s), 
                                  aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                       h(<
                                          h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                             aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                  h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s)
                                            >), 
                                          kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                       $msg)
                                 >
                         ) @ #vr.4 )
                    case Handshake_Initiator_Snd_1
                    solve( RawSnd( <'I', '0'>,
                                   <'0', 
                                    aead(kdf1(kdf1(<
                                                    kdf1(<
                                                          kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 
                                                                'g'^~e0>), 
                                                          'g'^(~e*~e0)>), 
                                                    'g'^(~e0*~s)>)),
                                         '0', '0', msg.3)
                                   >
                           ) @ #k.2 )
                      case I_Snd_to_R
                      solve( I_Snd( id.2, '0', msg.3 ) ▶₀ #k.2 )
                        case Instrumentation_Initiator_3
                        solve( !Transport_Initiator( ~id,
                                                     kdf1(kdf1(<
                                                                kdf1(<
                                                                      kdf1(<
                                                                            kdf2(<kdf1(<'INpsk1', 'g'^~e>), 
                                                                                  ~psk>), 
                                                                            'g'^~e0>), 
                                                                      'g'^(~e*~e0)>), 
                                                                'g'^(~e0*~s)>)),
                                                     kr2i
                               ) ▶₁ #k.2 )
                          case Initiator_to_transport_mode
                          solve( Receivable( <'g'^~e0, 
                                              aead(kdf2(<
                                                         kdf1(<
                                                               kdf1(<kdf2(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), 
                                                                     'g'^~e0>), 
                                                               'g'^(~e*~e0)>), 
                                                         'g'^(~e0*~s)>),
                                                   '0',
                                                   h(<
                                                      h(<
                                                         h(<
                                                            h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                               aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                                    h(<h(<'INpsk1', 'prologue'>), 'g'^~e>),
                                                                    'g'^~s)
                                                              >), 
                                                            kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>), 
                                                         aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                                              h(<
                                                                 h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                                    aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                                         h(<h(<'INpsk1', 'prologue'>), 'g'^~e
                                                                           >),
                                                                         'g'^~s)
                                                                   >), 
                                                                 kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                                              $msg)
                                                        >), 
                                                      'g'^~e0>),
                                                   $msg.1)
                                             >
                                 ) ▶₀ #vr.5 )
                            case channel_send
                            solve( Receivable( <'1', 
                                                aead(kdf2(kdf1(<
                                                                kdf1(<
                                                                      kdf1(<
                                                                            kdf2(<kdf1(<'INpsk1', 'g'^~e>), 
                                                                                  ~psk>), 
                                                                            'g'^~e0>), 
                                                                      'g'^(~e*~e0)>), 
                                                                'g'^(~e0*~s)>)),
                                                     '1', '0', ~n)
                                               >
                                   ) ▶₀ #vr.12 )
                              case channel_send
                              solve( Receivable( <'g'^~e, 
                                                  aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                       h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 'g'^~s), 
                                                  aead(kdf3(<kdf1(<'INpsk1', 'g'^~e>), ~psk>), '0',
                                                       h(<
                                                          h(<h(<h(<'INpsk1', 'prologue'>), 'g'^~e>), 
                                                             aead(kdf2(<'INpsk1', 'g'^~e>), '0',
                                                                  h(<h(<'INpsk1', 'prologue'>), 'g'^~e>),
                                                                  'g'^~s)
                                                            >), 
                                                          kdf1(<kdf1(<'INpsk1', 'g'^~e>), ~psk>)>),
                                                       $msg)
                                                 >
                                     ) ▶₀ #vr.16 )
                                case channel_send
                                solve( Receivable( <'0', 
                                                    aead(kdf1(kdf1(<
                                                                    kdf1(<
                                                                          kdf1(<
                                                                                kdf2(<
                                                                                      kdf1(<'INpsk1', 'g'^~e
                                                                                           >), 
                                                                                      ~psk>), 
                                                                                'g'^~e0>), 
                                                                          'g'^(~e*~e0)>), 
                                                                    'g'^(~e0*~s)>)),
                                                         '0', '0', $msg.2)
                                                   >
                                       ) ▶₀ #vr.25 )
                                  case channel_send
                                  SOLVED // trace found
                                qed
                              qed
                            qed
                          qed
                        qed
                      qed
                    qed
                  qed
                qed
              qed
            qed
          qed
        qed
      qed
    qed
  qed
qed















/* All wellformedness checks were successful. */

/*
Generated from:
Tamarin version 1.7.1
Maude version 2.7.1
Git revision: 3cb7de8d32abb28af2c15661792ee709093dfac5 (with uncommited changes), branch: tacticParser
Compiled at: 2023-01-23 09:28:22.913257386 UTC
*/

end